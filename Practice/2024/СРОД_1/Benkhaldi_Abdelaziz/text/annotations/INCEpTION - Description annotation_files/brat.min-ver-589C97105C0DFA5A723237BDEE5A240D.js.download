var Brat=(()=>{var zr=Object.defineProperty;var no=Object.getOwnPropertyDescriptor;var io=Object.getOwnPropertyNames;var oo=Object.prototype.hasOwnProperty;var ao=(r,t,e)=>t in r?zr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Is=(r,t)=>{for(var e in t)zr(r,e,{get:t[e],enumerable:!0})},lo=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of io(t))!oo.call(r,n)&&n!==e&&zr(r,n,{get:()=>t[n],enumerable:!(s=no(t,n))||s.enumerable});return r};var go=r=>lo(zr({},"__esModule",{value:!0}),r);var c=(r,t,e)=>(ao(r,typeof t!="symbol"?t+"":t,e),e);var Vg={};Is(Vg,{factory:()=>jg});var $r=class{constructor(t,e,s){c(this,"pending",0);c(this,"count",0);c(this,"pendingList",{});c(this,"dispatcher");c(this,"ajaxUrl");c(this,"wicketId");console.debug("Setting up brat ajax module..."),this.dispatcher=t,this.ajaxUrl=s,this.wicketId=e,t.on("isReloadOkay",this,this.isReloadOkay).on("ajax",this,this.ajaxCall)}ajaxCall(t,e,s){s=s||{},this.pending++;let n=this.count++;return this.pendingList[n]=s.keep||!1,delete s.keep,t.protocol===void 0&&(t.protocol=1),Wicket.Ajax.ajax({m:"POST",c:this.wicketId,u:this.ajaxUrl,ep:t,sh:[()=>{let i;if(Wicket.$(this.wicketId)!==null&&(i=Wicket.$(this.wicketId).temp,delete Wicket.$(this.wicketId).temp),i===void 0){console.log("Server response did not contain brat data - ignoring");return}this.pending--,i.exception===void 0&&i.action!==t.action&&(console.error(`Action ${t.action} returned the results of action ${i.action}`),i.exception=!0,this.dispatcher.post("messages",[[[`Protocol error: Action ${t.action} returned the results of action ${i.action} maybe the server is unable to run, please run tools/troubleshooting.sh from your installation to diagnose it`,"error",-1]]])),Object.prototype.hasOwnProperty.call(this.pendingList,n)&&(this.dispatcher.post("messages",[i.messages]),delete this.pendingList[n],i.exception===!0||e&&($.extend(i,s),this.dispatcher.postAsync(e,[i])))}],fh:[()=>{this.pending--}]}),n}isReloadOkay(){return this.pending===0}};var Cs=class{constructor(){c(this,"abbrevsOn",!0);c(this,"textBackgrounds","striped");c(this,"svgWidth","100%");c(this,"singleClickEdit",!1);c(this,"visual",{margin:{x:2,y:1},arcTextMargin:1,boxSpacing:1,curlyHeight:4,arcSpacing:9,arcStartHeight:19})}},y=new Cs;var Se=class{constructor(){c(this,"table",{});c(this,"inAsynchError",!1)}on(t,e,s){return this.table[t]===void 0&&(this.table[t]=[]),this.table[t].push([e,s]),this}handleAsynchError(t){this.inAsynchError?console.warn("Dropped asynch error:",t):(this.inAsynchError=!0,console.warn("Handled async error:",t),this.post("dispatchAsynchError",[t]),this.inAsynchError=!1)}postAsync(t,e){e===void 0&&(e=[]),setTimeout(()=>{try{typeof t=="function"?t(...e):this.post(t,e)}catch(s){this.handleAsynchError(s)}},0)}post(t,e,s){e===void 0&&(e=[]);let n=[],i=this.table[t];if(i!==void 0)for(let[o,a]of i)n.push(a.apply(o,e));if(s==="any"){let o=n.length;for(;o--;)if(n[o]!==!1)return n[o];return!1}if(s==="all"){let o=n.length;for(;o--;)if(n[o]===!1)return n[o]}return n}};var jr=class{constructor(t,e,s){c(this,"texts");c(this,"fragments");c(this,"arcs");this.texts=t,this.arcs=e,this.fragments=s,Object.seal(this)}};var Vr=class{constructor(t,e,s){c(this,"widths");c(this,"height");c(this,"y");this.widths=t,this.height=e,this.y=s,Object.seal(this)}};var Wr=class{constructor(t){c(this,"text");c(this,"chunks",[]);c(this,"spans",{});c(this,"arcById",{});c(this,"arcs",[]);c(this,"eventDescs",{});c(this,"sentComment",{});c(this,"markedSent",{});c(this,"spanAnnTexts",{});c(this,"towers",{});c(this,"spanDrawOrderPermutation",[]);c(this,"sizes");c(this,"exception",!1);this.text=t}};var At=class{constructor(t,e,s,n){c(this,"id");c(this,"span");c(this,"from");c(this,"to");c(this,"rectBox");c(this,"text");c(this,"chunk");c(this,"indexNumber");c(this,"drawOrder");c(this,"towerId");c(this,"curly");c(this,"drawCurly",!1);c(this,"labelText");c(this,"glyphedLabelText");c(this,"group");c(this,"rect");c(this,"left");c(this,"right");c(this,"width");c(this,"height");c(this,"nestingHeight");c(this,"nestingHeightLR");c(this,"nestingHeightRL");c(this,"nestingDepth");c(this,"nestingDepthLR");c(this,"nestingDepthRL");c(this,"highlightPos");this.id=t,this.span=e,this.from=s,this.to=n}rowBBox(){let t=Object.assign({},this.rectBox),e=this.chunk.translation;return t.x+=e.x,t.y+=e.y,t}static compare(t,e){let s=t.span,n=e.span,i=s.fragments.length-n.fragments.length;if(i)return i<0?1:-1;if(i=s.avgDist-n.avgDist,i||(i=s.numArcs-n.numArcs,i))return i<0?-1:1;let o=t.to-t.from,a=e.to-e.from;return i=o-a,s.numArcs===0&&n.numArcs===0&&(i=-i),i?i<0?1:-1:(i=s.refedIndexSum-n.refedIndexSum,i?i<0?-1:1:s.type<n.type?-1:s.type>n.type?1:0)}};c(At,"midpointComparator",(t,e)=>{let s=t.from+t.to-e.from-e.to;return s?s<0?-1:1:0});var In="trigger",Cn="entity",Re=class r{constructor(t,e,s,n){c(this,"id");c(this,"type");c(this,"totalDist",0);c(this,"numArcs",0);c(this,"generalType");c(this,"headFragment");c(this,"unsegmentedOffsets",[]);c(this,"offsets",[]);c(this,"segmentedOffsetsMap",{});c(this,"hidden",!1);c(this,"clippedAtStart",!1);c(this,"clippedAtEnd",!1);c(this,"incoming",[]);c(this,"outgoing",[]);c(this,"attributes",{});c(this,"attributeText",[]);c(this,"attributeCues",{});c(this,"attributeCueFor",{});c(this,"annotatorNotes");c(this,"attributeMerge",{});c(this,"fragments",[]);c(this,"wholeFrom");c(this,"wholeTo");c(this,"comment");c(this,"drawCurly",!1);c(this,"labelText");c(this,"refedIndexSum");c(this,"color");c(this,"shadowClass");c(this,"floor");c(this,"marked");c(this,"avgDist");c(this,"text");c(this,"cue");c(this,"hovertext");c(this,"actionButtons");this.id=t,this.type=e,this.unsegmentedOffsets=s,this.generalType=n,this.initContainers()}static compare(t,e,s){let n=t[e],i=t[s],o=n.headFragment.from+n.headFragment.to-i.headFragment.from-i.headFragment.to;return o?o<0?-1:1:0}initContainers(){this.incoming=[],this.outgoing=[],this.attributes={},this.attributeText=[],this.attributeCues={},this.attributeCueFor={},this.attributeMerge={},this.fragments=[]}splitMultilineOffsets(t){this.segmentedOffsetsMap={};for(let e=0,s=0;e<this.unsegmentedOffsets.length;e++){let n=this.unsegmentedOffsets[e][0],i=this.unsegmentedOffsets[e][1];for(let o=n;o<i;o++){let a=t.charAt(o);a===`
`||a==="\r"?n!==null&&(this.offsets.push([n,o]),this.segmentedOffsetsMap[s++]=e,n=null):n===null&&(n=o)}n!==null&&(this.offsets.push([n,i]),this.segmentedOffsetsMap[s++]=e)}}copy(t){let e=Object.assign((new r(t,void 0,this.unsegmentedOffsets.slice(),void 0),this));return e.offsets=this.offsets,e.segmentedOffsetsMap=this.segmentedOffsetsMap,e}buildFragments(){for(let[t,e]of this.offsets.entries()){let s=e[0],n=e[1],i=new At(t,this,s,n);this.fragments.push(i)}this.fragments.sort(At.midpointComparator),this.wholeFrom=this.fragments[0].from,this.wholeTo=this.fragments[this.fragments.length-1].to,this.headFragment=this.fragments[this.fragments.length-1]}get fragmentOffsets(){return this.fragments.map(t=>[t.from,t.to])}};var Ts="equiv",Fs="relation",Ee=class{constructor(t,e,s,n){c(this,"id");c(this,"triggerId");c(this,"roles",[]);c(this,"equivArc");c(this,"equiv",!1);c(this,"relation",!1);c(this,"leftSpans");c(this,"rightSpans");c(this,"annotatorNotes");c(this,"comment");c(this,"labelText");c(this,"color");c(this,"shadowClass");this.id=t,this.triggerId=e,this.equiv=n===Ts,this.relation=n===Fs,s.map(i=>this.roles.push({type:i[0],targetId:i[1]}))}};var Xr=class{constructor(t,e,s,n,i){c(this,"index");c(this,"text");c(this,"from");c(this,"to");c(this,"space");c(this,"fragments",[]);c(this,"lastSpace");c(this,"nextSpace");c(this,"sentence");c(this,"group");c(this,"highlightGroup");c(this,"markedTextStart",[]);c(this,"markedTextEnd",[]);c(this,"right");c(this,"row");c(this,"textX");c(this,"translation",{x:0,y:0});c(this,"firstFragmentIndex");c(this,"lastFragmentIndex");c(this,"rtlsizes");this.index=t,this.text=e,this.from=s,this.to=n,this.space=i}renderText(t,e){t.plain(this.text).attr({x:this.textX,y:this.row.textY,"data-chunk-id":this.index}).addTo(e)}};var Lr=class{constructor(t,e,s,n){c(this,"annotatorNotes");c(this,"comment");c(this,"origin");c(this,"target");c(this,"dist");c(this,"type");c(this,"shadowClass");c(this,"jumpHeight",0);c(this,"equiv",!1);c(this,"eventDescId");c(this,"relation",!1);c(this,"marked");c(this,"hidden",!1);this.origin=t.id,this.target=e.targetId,this.dist=s,this.type=e.type,this.shadowClass=t.shadowClass,t.equiv?(this.equiv=!0,this.eventDescId=n,t.equivArc=this):t.relation&&(this.relation=!0,this.eventDescId=n)}};var le=class{constructor(t){c(this,"group");c(this,"background");c(this,"arcs");c(this,"chunks",[]);c(this,"hasAnnotations",!1);c(this,"maxArcHeight",0);c(this,"maxSpanHeight",0);c(this,"boxHeight",0);c(this,"sentence");c(this,"index");c(this,"backgroundIndex");c(this,"heightsStart");c(this,"heightsEnd");c(this,"heightsAdjust");c(this,"textY");c(this,"translation",{x:0,y:0});this.group=t.group().addClass("row"),this.background=t.group().addTo(this.group)}updateFragmentHeight(){for(let t of this.chunks)for(let e of t.fragments)this.maxSpanHeight<e.height&&(this.maxSpanHeight=e.height)}updateRowBoxHeight(t,e){this.boxHeight=Math.max(this.maxArcHeight+5,this.maxSpanHeight+1.5),this.hasAnnotations?this.boxHeight+=t+1.5:this.boxHeight-=5,this.boxHeight+=e}};var Ur=class{constructor(t,e,s,n){c(this,"x");c(this,"y");c(this,"width");c(this,"height");this.x=t,this.y=e,this.width=s,this.height=n,Object.seal(this)}};var Tn="edited",Fn="focus",Sn="matchfocus",Rn="match";var Ss={};Is(Ss,{JsonPatchError:()=>q,_areEquals:()=>or,applyOperation:()=>ge,applyPatch:()=>De,applyReducer:()=>uo,deepClone:()=>po,getValueByPointer:()=>Pr,validate:()=>On,validator:()=>Jr});var vo=function(){var r=function(t,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,n){s.__proto__=n}||function(s,n){for(var i in n)n.hasOwnProperty(i)&&(s[i]=n[i])},r(t,e)};return function(t,e){r(t,e);function s(){this.constructor=t}t.prototype=e===null?Object.create(e):(s.prototype=e.prototype,new s)}}(),co=Object.prototype.hasOwnProperty;function Zr(r,t){return co.call(r,t)}function Qr(r){if(Array.isArray(r)){for(var t=new Array(r.length),e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(r);var s=[];for(var n in r)Zr(r,n)&&s.push(n);return s}function it(r){switch(typeof r){case"object":return JSON.parse(JSON.stringify(r));case"undefined":return null;default:return r}}function Yr(r){for(var t=0,e=r.length,s;t<e;){if(s=r.charCodeAt(t),s>=48&&s<=57){t++;continue}return!1}return!0}function Rt(r){return r.indexOf("/")===-1&&r.indexOf("~")===-1?r:r.replace(/~/g,"~0").replace(/\//g,"~1")}function nr(r){return r.replace(/~1/g,"/").replace(/~0/g,"~")}function Hr(r){if(r===void 0)return!0;if(r){if(Array.isArray(r)){for(var t=0,e=r.length;t<e;t++)if(Hr(r[t]))return!0}else if(typeof r=="object"){for(var s=Qr(r),n=s.length,i=0;i<n;i++)if(Hr(r[s[i]]))return!0}}return!1}function En(r,t){var e=[r];for(var s in t){var n=typeof t[s]=="object"?JSON.stringify(t[s],null,2):t[s];typeof n!="undefined"&&e.push(s+": "+n)}return e.join(`
`)}var ir=function(r){vo(t,r);function t(e,s,n,i,o){var a=this.constructor,l=r.call(this,En(e,{name:s,index:n,operation:i,tree:o}))||this;return l.name=s,l.index=n,l.operation=i,l.tree=o,Object.setPrototypeOf(l,a.prototype),l.message=En(e,{name:s,index:n,operation:i,tree:o}),l}return t}(Error);var q=ir,po=it,Oe={add:function(r,t,e){return r[t]=this.value,{newDocument:e}},remove:function(r,t,e){var s=r[t];return delete r[t],{newDocument:e,removed:s}},replace:function(r,t,e){var s=r[t];return r[t]=this.value,{newDocument:e,removed:s}},move:function(r,t,e){var s=Pr(e,this.path);s&&(s=it(s));var n=ge(e,{op:"remove",path:this.from}).removed;return ge(e,{op:"add",path:this.path,value:n}),{newDocument:e,removed:s}},copy:function(r,t,e){var s=Pr(e,this.from);return ge(e,{op:"add",path:this.path,value:it(s)}),{newDocument:e}},test:function(r,t,e){return{newDocument:e,test:or(r[t],this.value)}},_get:function(r,t,e){return this.value=r[t],{newDocument:e}}},mo={add:function(r,t,e){return Yr(t)?r.splice(t,0,this.value):r[t]=this.value,{newDocument:e,index:t}},remove:function(r,t,e){var s=r.splice(t,1);return{newDocument:e,removed:s[0]}},replace:function(r,t,e){var s=r[t];return r[t]=this.value,{newDocument:e,removed:s}},move:Oe.move,copy:Oe.copy,test:Oe.test,_get:Oe._get};function Pr(r,t){if(t=="")return r;var e={op:"_get",path:t};return ge(r,e),e.value}function ge(r,t,e,s,n,i){if(e===void 0&&(e=!1),s===void 0&&(s=!0),n===void 0&&(n=!0),i===void 0&&(i=0),e&&(typeof e=="function"?e(t,0,r,t.path):Jr(t,0)),t.path===""){var o={newDocument:r};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=r,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Pr(r,t.from),t.op==="move"&&(o.removed=r),o;if(t.op==="test"){if(o.test=or(r,t.value),o.test===!1)throw new q("Test operation failed","TEST_OPERATION_FAILED",i,t,r);return o.newDocument=r,o}else{if(t.op==="remove")return o.removed=r,o.newDocument=null,o;if(t.op==="_get")return t.value=r,o;if(e)throw new q("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,r);return o}}else{s||(r=it(r));var a=t.path||"",l=a.split("/"),g=r,v=1,d=l.length,p=void 0,u=void 0,m=void 0;for(typeof e=="function"?m=e:m=Jr;;){if(u=l[v],u&&u.indexOf("~")!=-1&&(u=nr(u)),n&&(u=="__proto__"||u=="prototype"&&v>0&&l[v-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(e&&p===void 0&&(g[u]===void 0?p=l.slice(0,v).join("/"):v==d-1&&(p=t.path),p!==void 0&&m(t,0,r,p)),v++,Array.isArray(g)){if(u==="-")u=g.length;else{if(e&&!Yr(u))throw new q("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,r);Yr(u)&&(u=~~u)}if(v>=d){if(e&&t.op==="add"&&u>g.length)throw new q("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,r);var o=mo[t.op].call(t,g,u,r);if(o.test===!1)throw new q("Test operation failed","TEST_OPERATION_FAILED",i,t,r);return o}}else if(v>=d){var o=Oe[t.op].call(t,g,u,r);if(o.test===!1)throw new q("Test operation failed","TEST_OPERATION_FAILED",i,t,r);return o}if(g=g[u],e&&v<d&&(!g||typeof g!="object"))throw new q("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,t,r)}}}function De(r,t,e,s,n){if(s===void 0&&(s=!0),n===void 0&&(n=!0),e&&!Array.isArray(t))throw new q("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");s||(r=it(r));for(var i=new Array(t.length),o=0,a=t.length;o<a;o++)i[o]=ge(r,t[o],e,!0,n,o),r=i[o].newDocument;return i.newDocument=r,i}function uo(r,t,e){var s=ge(r,t);if(s.test===!1)throw new q("Test operation failed","TEST_OPERATION_FAILED",e,t,r);return s.newDocument}function Jr(r,t,e,s){if(typeof r!="object"||r===null||Array.isArray(r))throw new q("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,r,e);if(Oe[r.op]){if(typeof r.path!="string")throw new q("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,r,e);if(r.path.indexOf("/")!==0&&r.path.length>0)throw new q('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,r,e);if((r.op==="move"||r.op==="copy")&&typeof r.from!="string")throw new q("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,r,e);if((r.op==="add"||r.op==="replace"||r.op==="test")&&r.value===void 0)throw new q("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,r,e);if((r.op==="add"||r.op==="replace"||r.op==="test")&&Hr(r.value))throw new q("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,r,e);if(e){if(r.op=="add"){var n=r.path.split("/").length,i=s.split("/").length;if(n!==i+1&&n!==i)throw new q("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,r,e)}else if(r.op==="replace"||r.op==="remove"||r.op==="_get"){if(r.path!==s)throw new q("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,r,e)}else if(r.op==="move"||r.op==="copy"){var o={op:"_get",path:r.from,value:void 0},a=On([o],e);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new q("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,r,e)}}}else throw new q("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,r,e)}function On(r,t,e){try{if(!Array.isArray(r))throw new q("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)De(it(t),it(r),e||!0);else{e=e||Jr;for(var s=0;s<r.length;s++)e(r[s],s,t,void 0)}}catch(n){if(n instanceof q)return n;throw n}}function or(r,t){if(r===t)return!0;if(r&&t&&typeof r=="object"&&typeof t=="object"){var e=Array.isArray(r),s=Array.isArray(t),n,i,o;if(e&&s){if(i=r.length,i!=t.length)return!1;for(n=i;n--!==0;)if(!or(r[n],t[n]))return!1;return!0}if(e!=s)return!1;var a=Object.keys(r);if(i=a.length,i!==Object.keys(t).length)return!1;for(n=i;n--!==0;)if(!t.hasOwnProperty(a[n]))return!1;for(n=i;n--!==0;)if(o=a[n],!or(r[o],t[o]))return!1;return!0}return r!==r&&t!==t}var Ds={};Is(Ds,{compare:()=>ko,generate:()=>Rs,observe:()=>_o,unobserve:()=>wo});var Es=new WeakMap,fo=function(){function r(t){this.observers=new Map,this.obj=t}return r}(),ho=function(){function r(t,e){this.callback=t,this.observer=e}return r}();function bo(r){return Es.get(r)}function xo(r,t){return r.observers.get(t)}function yo(r,t){r.observers.delete(t.callback)}function wo(r,t){t.unobserve()}function _o(r,t){var e=[],s,n=bo(r);if(!n)n=new fo(r),Es.set(r,n);else{var i=xo(n,t);s=i&&i.observer}if(s)return s;if(s={},n.value=it(r),t){s.callback=t,s.next=null;var o=function(){Rs(s)},a=function(){clearTimeout(s.next),s.next=setTimeout(o)};typeof window!="undefined"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return s.patches=e,s.object=r,s.unobserve=function(){Rs(s),clearTimeout(s.next),yo(n,s),typeof window!="undefined"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},n.observers.set(t,new ho(t,s)),s}function Rs(r,t){t===void 0&&(t=!1);var e=Es.get(r.object);Os(e.value,r.object,r.patches,"",t),r.patches.length&&De(e.value,r.patches);var s=r.patches;return s.length>0&&(r.patches=[],r.callback&&r.callback(s)),s}function Os(r,t,e,s,n){if(t!==r){typeof t.toJSON=="function"&&(t=t.toJSON());for(var i=Qr(t),o=Qr(r),a=!1,l=!1,g=o.length-1;g>=0;g--){var v=o[g],d=r[v];if(Zr(t,v)&&!(t[v]===void 0&&d!==void 0&&Array.isArray(t)===!1)){var p=t[v];typeof d=="object"&&d!=null&&typeof p=="object"&&p!=null&&Array.isArray(d)===Array.isArray(p)?Os(d,p,e,s+"/"+Rt(v),n):d!==p&&(a=!0,n&&e.push({op:"test",path:s+"/"+Rt(v),value:it(d)}),e.push({op:"replace",path:s+"/"+Rt(v),value:it(p)}))}else Array.isArray(r)===Array.isArray(t)?(n&&e.push({op:"test",path:s+"/"+Rt(v),value:it(d)}),e.push({op:"remove",path:s+"/"+Rt(v)}),l=!0):(n&&e.push({op:"test",path:s,value:r}),e.push({op:"replace",path:s,value:t}),a=!0)}if(!(!l&&i.length==o.length))for(var g=0;g<i.length;g++){var v=i[g];!Zr(r,v)&&t[v]!==void 0&&e.push({op:"add",path:s+"/"+Rt(v),value:it(t[v])})}}}function ko(r,t,e){e===void 0&&(e=!1);var s=[];return Os(r,t,s,"",e),s}var _v=Object.assign({},Ss,Ds,{JsonPatchError:ir,deepClone:it,escapePathComponent:Rt,unescapePathComponent:nr});var qr;function Dn(){if(qr!==void 0)return qr;let r=$('<div style="position: absolute; top: -200px; width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=r.children();return qr=t.innerWidth()-t.height(99).innerWidth(),r.remove(),qr}var Ns={},jn=[];function B(r,t){if(Array.isArray(r)){for(let e of r)B(e,t);return}if(typeof r=="object"){for(let e in r)B(e,r[e]);return}Vn(Object.getOwnPropertyNames(t)),Ns[r]=Object.assign(Ns[r]||{},t)}function ft(r){return Ns[r]||{}}function Io(){return[...new Set(jn)]}function Vn(r){jn.push(...r)}function os(r,t){let e,s=r.length,n=[];for(e=0;e<s;e++)n.push(t(r[e]));return n}function Wn(r,t){let e,s=r.length,n=[];for(e=0;e<s;e++)t(r[e])&&n.push(r[e]);return n}function Kr(r){return r%360*Math.PI/180}function Co(r){return r*180/Math.PI%360}function lr(r){return r.toLowerCase().replace(/-(.)/g,function(t,e){return e.toUpperCase()})}function Xn(r){return r.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()})}function Us(r){return r.charAt(0).toUpperCase()+r.slice(1)}function ye(r,t,e,s){return(t==null||e==null)&&(s=s||r.bbox(),t==null?t=s.width/s.height*e:e==null&&(e=s.height/s.width*t)),{width:t,height:e}}function ts(r,t){let e=r.origin,s=r.ox!=null?r.ox:r.originX!=null?r.originX:"center",n=r.oy!=null?r.oy:r.originY!=null?r.originY:"center";e!=null&&([s,n]=Array.isArray(e)?e:typeof e=="object"?[e.x,e.y]:[e,e]);let i=typeof s=="string",o=typeof n=="string";if(i||o){let{height:a,width:l,x:g,y:v}=t.bbox();i&&(s=s.includes("left")?g:s.includes("right")?g+l:g+l/2),o&&(n=n.includes("top")?v:n.includes("bottom")?v+a:v+a/2)}return[s,n]}var Cr={__proto__:null,map:os,filter:Wn,radians:Kr,degrees:Co,camelCase:lr,unCamelCase:Xn,capitalize:Us,proportionalSize:ye,getOrigin:ts},as="http://www.w3.org/2000/svg",Ln="http://www.w3.org/1999/xhtml",gr="http://www.w3.org/2000/xmlns/",He="http://www.w3.org/1999/xlink",Un="http://svgjs.dev/svgjs",Hn={__proto__:null,svg:as,html:Ln,xmlns:gr,xlink:He,svgjs:Un},X={window:typeof window=="undefined"?null:window,document:typeof document=="undefined"?null:document};var dr=class{},ce={},Hs="___SYMBOL___ROOT___";function pr(r,t=as){return X.document.createElementNS(t,r)}function ct(r,t=!1){if(r instanceof dr)return r;if(typeof r=="object")return Gs(r);if(r==null)return new ce[Hs];if(typeof r=="string"&&r.charAt(0)!=="<")return Gs(X.document.querySelector(r));let e=t?X.document.createElement("div"):pr("svg");return e.innerHTML=r,r=Gs(e.firstChild),e.removeChild(e.firstChild),r}function H(r,t){return t&&t.ownerDocument&&t instanceof t.ownerDocument.defaultView.Node?t:pr(r)}function wt(r){if(!r)return null;if(r.instance instanceof dr)return r.instance;if(r.nodeName==="#document-fragment")return new ce.Fragment(r);let t=Us(r.nodeName||"Dom");return t==="LinearGradient"||t==="RadialGradient"?t="Gradient":ce[t]||(t="Dom"),new ce[t](r)}var Gs=wt;function V(r,t=r.name,e=!1){return ce[t]=r,e&&(ce[Hs]=r),Vn(Object.getOwnPropertyNames(r.prototype)),r}function To(r){return ce[r]}var Fo=1e3;function Zn(r){return"Svgjs"+Us(r)+Fo++}function Qn(r){for(let t=r.children.length-1;t>=0;t--)Qn(r.children[t]);return r.id&&(r.id=Zn(r.nodeName)),r}function O(r,t){let e,s;for(r=Array.isArray(r)?r:[r],s=r.length-1;s>=0;s--)for(e in t)r[s].prototype[e]=t[e]}function U(r){return function(...t){let e=t[t.length-1];return e&&e.constructor===Object&&!(e instanceof Array)?r.apply(this,t.slice(0,-1)).attr(e):r.apply(this,t)}}function So(){return this.parent().children()}function Ro(){return this.parent().index(this)}function Eo(){return this.siblings()[this.position()+1]}function Oo(){return this.siblings()[this.position()-1]}function Do(){let r=this.position();return this.parent().add(this.remove(),r+1),this}function Go(){let r=this.position();return this.parent().add(this.remove(),r?r-1:0),this}function Bo(){return this.parent().add(this.remove()),this}function Mo(){return this.parent().add(this.remove(),0),this}function No(r){r=ct(r),r.remove();let t=this.position();return this.parent().add(r,t),this}function zo(r){r=ct(r),r.remove();let t=this.position();return this.parent().add(r,t+1),this}function $o(r){return r=ct(r),r.before(this),this}function jo(r){return r=ct(r),r.after(this),this}B("Dom",{siblings:So,position:Ro,next:Eo,prev:Oo,forward:Do,backward:Go,front:Bo,back:Mo,before:No,after:zo,insertBefore:$o,insertAfter:jo});var Yn=/^([+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?)([a-z%]*)$/i,Vo=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,Wo=/rgb\((\d+),(\d+),(\d+)\)/,Xo=/(#[a-z_][a-z0-9\-_]*)/i,Lo=/\)\s*,?\s*/,Uo=/\s/g,Gn=/^#[a-f0-9]{3}$|^#[a-f0-9]{6}$/i,Bn=/^rgb\(/,Mn=/^(\s+)?$/,Nn=/^[+-]?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ho=/\.(jpg|jpeg|png|gif|svg)(\?[^=]+.*)?/i,Ut=/[\s,]+/,Zs=/[MLHVCSQTAZ]/i;function Zo(){let r=this.attr("class");return r==null?[]:r.trim().split(Ut)}function Qo(r){return this.classes().indexOf(r)!==-1}function Yo(r){if(!this.hasClass(r)){let t=this.classes();t.push(r),this.attr("class",t.join(" "))}return this}function Po(r){return this.hasClass(r)&&this.attr("class",this.classes().filter(function(t){return t!==r}).join(" ")),this}function Jo(r){return this.hasClass(r)?this.removeClass(r):this.addClass(r)}B("Dom",{classes:Zo,hasClass:Qo,addClass:Yo,removeClass:Po,toggleClass:Jo});function qo(r,t){let e={};if(arguments.length===0)return this.node.style.cssText.split(/\s*;\s*/).filter(function(s){return!!s.length}).forEach(function(s){let n=s.split(/\s*:\s*/);e[n[0]]=n[1]}),e;if(arguments.length<2){if(Array.isArray(r)){for(let s of r){let n=lr(s);e[s]=this.node.style[n]}return e}if(typeof r=="string")return this.node.style[lr(r)];if(typeof r=="object")for(let s in r)this.node.style[lr(s)]=r[s]==null||Mn.test(r[s])?"":r[s]}return arguments.length===2&&(this.node.style[lr(r)]=t==null||Mn.test(t)?"":t),this}function Ko(){return this.css("display","")}function ta(){return this.css("display","none")}function ea(){return this.css("display")!=="none"}B("Dom",{css:qo,show:Ko,hide:ta,visible:ea});function ra(r,t,e){if(r==null)return this.data(os(Wn(this.node.attributes,s=>s.nodeName.indexOf("data-")===0),s=>s.nodeName.slice(5)));if(r instanceof Array){let s={};for(let n of r)s[n]=this.data(n);return s}else if(typeof r=="object")for(t in r)this.data(t,r[t]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+r))}catch(s){return this.attr("data-"+r)}else this.attr("data-"+r,t===null?null:e===!0||typeof t=="string"||typeof t=="number"?t:JSON.stringify(t));return this}B("Dom",{data:ra});function sa(r,t){if(typeof arguments[0]=="object")for(let e in r)this.remember(e,r[e]);else{if(arguments.length===1)return this.memory()[r];this.memory()[r]=t}return this}function na(){if(arguments.length===0)this._memory={};else for(let r=arguments.length-1;r>=0;r--)delete this.memory()[arguments[r]];return this}function ia(){return this._memory=this._memory||{}}B("Dom",{remember:sa,forget:na,memory:ia});function oa(r){return r.length===4?["#",r.substring(1,2),r.substring(1,2),r.substring(2,3),r.substring(2,3),r.substring(3,4),r.substring(3,4)].join(""):r}function aa(r){let t=Math.round(r),s=Math.max(0,Math.min(255,t)).toString(16);return s.length===1?"0"+s:s}function Ge(r,t){for(let e=t.length;e--;)if(r[t[e]]==null)return!1;return!0}function la(r,t){let e=Ge(r,"rgb")?{_a:r.r,_b:r.g,_c:r.b,_d:0,space:"rgb"}:Ge(r,"xyz")?{_a:r.x,_b:r.y,_c:r.z,_d:0,space:"xyz"}:Ge(r,"hsl")?{_a:r.h,_b:r.s,_c:r.l,_d:0,space:"hsl"}:Ge(r,"lab")?{_a:r.l,_b:r.a,_c:r.b,_d:0,space:"lab"}:Ge(r,"lch")?{_a:r.l,_b:r.c,_c:r.h,_d:0,space:"lch"}:Ge(r,"cmyk")?{_a:r.c,_b:r.m,_c:r.y,_d:r.k,space:"cmyk"}:{_a:0,_b:0,_c:0,space:"rgb"};return e.space=t||e.space,e}function ga(r){return r==="lab"||r==="xyz"||r==="lch"}function Bs(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*(2/3-e)*6:r}var _t=class r{constructor(...t){this.init(...t)}static isColor(t){return t&&(t instanceof r||this.isRgb(t)||this.test(t))}static isRgb(t){return t&&typeof t.r=="number"&&typeof t.g=="number"&&typeof t.b=="number"}static random(t="vibrant",e,s){let{random:n,round:i,sin:o,PI:a}=Math;if(t==="vibrant"){let l=24*n()+57,g=38*n()+45,v=360*n();return new r(l,g,v,"lch")}else if(t==="sine"){e=e==null?n():e;let l=i(80*o(2*a*e/.5+.01)+150),g=i(50*o(2*a*e/.5+4.6)+200),v=i(100*o(2*a*e/.5+2.3)+150);return new r(l,g,v)}else if(t==="pastel"){let l=8*n()+86,g=17*n()+9,v=360*n();return new r(l,g,v,"lch")}else if(t==="dark"){let l=10+10*n(),g=50*n()+86,v=360*n();return new r(l,g,v,"lch")}else if(t==="rgb"){let l=255*n(),g=255*n(),v=255*n();return new r(l,g,v)}else if(t==="lab"){let l=100*n(),g=256*n()-128,v=256*n()-128;return new r(l,g,v,"lab")}else if(t==="grey"){let l=255*n();return new r(l,l,l)}else throw new Error("Unsupported random color mode")}static test(t){return typeof t=="string"&&(Gn.test(t)||Bn.test(t))}cmyk(){let{_a:t,_b:e,_c:s}=this.rgb(),[n,i,o]=[t,e,s].map(p=>p/255),a=Math.min(1-n,1-i,1-o);if(a===1)return new r(0,0,0,1,"cmyk");let l=(1-n-a)/(1-a),g=(1-i-a)/(1-a),v=(1-o-a)/(1-a);return new r(l,g,v,a,"cmyk")}hsl(){let{_a:t,_b:e,_c:s}=this.rgb(),[n,i,o]=[t,e,s].map(f=>f/255),a=Math.max(n,i,o),l=Math.min(n,i,o),g=(a+l)/2,v=a===l,d=a-l,p=v?0:g>.5?d/(2-a-l):d/(a+l),u=v?0:a===n?((i-o)/d+(i<o?6:0))/6:a===i?((o-n)/d+2)/6:a===o?((n-i)/d+4)/6:0;return new r(360*u,100*p,100*g,"hsl")}init(t=0,e=0,s=0,n=0,i="rgb"){if(t=t||0,this.space)for(let d in this.space)delete this[this.space[d]];if(typeof t=="number")i=typeof n=="string"?n:i,n=typeof n=="string"?0:n,Object.assign(this,{_a:t,_b:e,_c:s,_d:n,space:i});else if(t instanceof Array)this.space=e||(typeof t[3]=="string"?t[3]:t[4])||"rgb",Object.assign(this,{_a:t[0],_b:t[1],_c:t[2],_d:t[3]||0});else if(t instanceof Object){let d=la(t,e);Object.assign(this,d)}else if(typeof t=="string")if(Bn.test(t)){let d=t.replace(Uo,""),[p,u,m]=Wo.exec(d).slice(1,4).map(f=>parseInt(f));Object.assign(this,{_a:p,_b:u,_c:m,_d:0,space:"rgb"})}else if(Gn.test(t)){let d=f=>parseInt(f,16),[,p,u,m]=Vo.exec(oa(t)).map(d);Object.assign(this,{_a:p,_b:u,_c:m,_d:0,space:"rgb"})}else throw Error("Unsupported string format, can't construct Color");let{_a:o,_b:a,_c:l,_d:g}=this,v=this.space==="rgb"?{r:o,g:a,b:l}:this.space==="xyz"?{x:o,y:a,z:l}:this.space==="hsl"?{h:o,s:a,l}:this.space==="lab"?{l:o,a,b:l}:this.space==="lch"?{l:o,c:a,h:l}:this.space==="cmyk"?{c:o,m:a,y:l,k:g}:{};Object.assign(this,v)}lab(){let{x:t,y:e,z:s}=this.xyz(),n=116*e-16,i=500*(t-e),o=200*(e-s);return new r(n,i,o,"lab")}lch(){let{l:t,a:e,b:s}=this.lab(),n=Math.sqrt(e**2+s**2),i=180*Math.atan2(s,e)/Math.PI;return i<0&&(i*=-1,i=360-i),new r(t,n,i,"lch")}rgb(){if(this.space==="rgb")return this;if(ga(this.space)){let{x:t,y:e,z:s}=this;if(this.space==="lab"||this.space==="lch"){let{l:u,a:m,b:f}=this;if(this.space==="lch"){let{c:_,h:T}=this,D=Math.PI/180;m=_*Math.cos(D*T),f=_*Math.sin(D*T)}let b=(u+16)/116,x=m/500+b,k=b-f/200,h=16/116,S=.008856,w=7.787;t=.95047*(x**3>S?x**3:(x-h)/w),e=1*(b**3>S?b**3:(b-h)/w),s=1.08883*(k**3>S?k**3:(k-h)/w)}let n=t*3.2406+e*-1.5372+s*-.4986,i=t*-.9689+e*1.8758+s*.0415,o=t*.0557+e*-.204+s*1.057,a=Math.pow,l=.0031308,g=n>l?1.055*a(n,1/2.4)-.055:12.92*n,v=i>l?1.055*a(i,1/2.4)-.055:12.92*i,d=o>l?1.055*a(o,1/2.4)-.055:12.92*o;return new r(255*g,255*v,255*d)}else if(this.space==="hsl"){let{h:t,s:e,l:s}=this;if(t/=360,e/=100,s/=100,e===0)return s*=255,new r(s,s,s);let n=s<.5?s*(1+e):s+e-s*e,i=2*s-n,o=255*Bs(i,n,t+1/3),a=255*Bs(i,n,t),l=255*Bs(i,n,t-1/3);return new r(o,a,l)}else if(this.space==="cmyk"){let{c:t,m:e,y:s,k:n}=this,i=255*(1-Math.min(1,t*(1-n)+n)),o=255*(1-Math.min(1,e*(1-n)+n)),a=255*(1-Math.min(1,s*(1-n)+n));return new r(i,o,a)}else return this}toArray(){let{_a:t,_b:e,_c:s,_d:n,space:i}=this;return[t,e,s,n,i]}toHex(){let[t,e,s]=this._clamped().map(aa);return`#${t}${e}${s}`}toRgb(){let[t,e,s]=this._clamped();return`rgb(${t},${e},${s})`}toString(){return this.toHex()}xyz(){let{_a:t,_b:e,_c:s}=this.rgb(),[n,i,o]=[t,e,s].map(x=>x/255),a=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,l=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,g=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,v=(a*.4124+l*.3576+g*.1805)/.95047,d=(a*.2126+l*.7152+g*.0722)/1,p=(a*.0193+l*.1192+g*.9505)/1.08883,u=v>.008856?Math.pow(v,1/3):7.787*v+16/116,m=d>.008856?Math.pow(d,1/3):7.787*d+16/116,f=p>.008856?Math.pow(p,1/3):7.787*p+16/116;return new r(u,m,f,"xyz")}_clamped(){let{_a:t,_b:e,_c:s}=this.rgb(),{max:n,min:i,round:o}=Math,a=l=>n(0,i(o(l),255));return[t,e,s].map(a)}},K=class r{constructor(...t){this.init(...t)}clone(){return new r(this)}init(t,e){let s={x:0,y:0},n=Array.isArray(t)?{x:t[0],y:t[1]}:typeof t=="object"?{x:t.x,y:t.y}:{x:t,y:e};return this.x=n.x==null?s.x:n.x,this.y=n.y==null?s.y:n.y,this}toArray(){return[this.x,this.y]}transform(t){return this.clone().transformO(t)}transformO(t){z.isMatrixLike(t)||(t=new z(t));let{x:e,y:s}=this;return this.x=t.a*e+t.c*s+t.e,this.y=t.b*e+t.d*s+t.f,this}};function va(r,t){return new K(r,t).transformO(this.screenCTM().inverseO())}function Be(r,t,e){return Math.abs(t-r)<(e||1e-6)}var z=class r{constructor(...t){this.init(...t)}static formatTransforms(t){let e=t.flip==="both"||t.flip===!0,s=t.flip&&(e||t.flip==="x")?-1:1,n=t.flip&&(e||t.flip==="y")?-1:1,i=t.skew&&t.skew.length?t.skew[0]:isFinite(t.skew)?t.skew:isFinite(t.skewX)?t.skewX:0,o=t.skew&&t.skew.length?t.skew[1]:isFinite(t.skew)?t.skew:isFinite(t.skewY)?t.skewY:0,a=t.scale&&t.scale.length?t.scale[0]*s:isFinite(t.scale)?t.scale*s:isFinite(t.scaleX)?t.scaleX*s:s,l=t.scale&&t.scale.length?t.scale[1]*n:isFinite(t.scale)?t.scale*n:isFinite(t.scaleY)?t.scaleY*n:n,g=t.shear||0,v=t.rotate||t.theta||0,d=new K(t.origin||t.around||t.ox||t.originX,t.oy||t.originY),p=d.x,u=d.y,m=new K(t.position||t.px||t.positionX||NaN,t.py||t.positionY||NaN),f=m.x,b=m.y,x=new K(t.translate||t.tx||t.translateX,t.ty||t.translateY),k=x.x,h=x.y,S=new K(t.relative||t.rx||t.relativeX,t.ry||t.relativeY),w=S.x,_=S.y;return{scaleX:a,scaleY:l,skewX:i,skewY:o,shear:g,theta:v,rx:w,ry:_,tx:k,ty:h,ox:p,oy:u,px:f,py:b}}static fromArray(t){return{a:t[0],b:t[1],c:t[2],d:t[3],e:t[4],f:t[5]}}static isMatrixLike(t){return t.a!=null||t.b!=null||t.c!=null||t.d!=null||t.e!=null||t.f!=null}static matrixMultiply(t,e,s){let n=t.a*e.a+t.c*e.b,i=t.b*e.a+t.d*e.b,o=t.a*e.c+t.c*e.d,a=t.b*e.c+t.d*e.d,l=t.e+t.a*e.e+t.c*e.f,g=t.f+t.b*e.e+t.d*e.f;return s.a=n,s.b=i,s.c=o,s.d=a,s.e=l,s.f=g,s}around(t,e,s){return this.clone().aroundO(t,e,s)}aroundO(t,e,s){let n=t||0,i=e||0;return this.translateO(-n,-i).lmultiplyO(s).translateO(n,i)}clone(){return new r(this)}decompose(t=0,e=0){let s=this.a,n=this.b,i=this.c,o=this.d,a=this.e,l=this.f,g=s*o-n*i,v=g>0?1:-1,d=v*Math.sqrt(s*s+n*n),p=Math.atan2(v*n,v*s),u=180/Math.PI*p,m=Math.cos(p),f=Math.sin(p),b=(s*i+n*o)/g,x=i*d/(b*s-n)||o*d/(b*n+s),k=a-t+t*m*d+e*(b*m*d-f*x),h=l-e+t*f*d+e*(b*f*d+m*x);return{scaleX:d,scaleY:x,shear:b,rotate:u,translateX:k,translateY:h,originX:t,originY:e,a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}equals(t){if(t===this)return!0;let e=new r(t);return Be(this.a,e.a)&&Be(this.b,e.b)&&Be(this.c,e.c)&&Be(this.d,e.d)&&Be(this.e,e.e)&&Be(this.f,e.f)}flip(t,e){return this.clone().flipO(t,e)}flipO(t,e){return t==="x"?this.scaleO(-1,1,e,0):t==="y"?this.scaleO(1,-1,0,e):this.scaleO(-1,-1,t,e||t)}init(t){let e=r.fromArray([1,0,0,1,0,0]);return t=t instanceof ot?t.matrixify():typeof t=="string"?r.fromArray(t.split(Ut).map(parseFloat)):Array.isArray(t)?r.fromArray(t):typeof t=="object"&&r.isMatrixLike(t)?t:typeof t=="object"?new r().transform(t):arguments.length===6?r.fromArray([].slice.call(arguments)):e,this.a=t.a!=null?t.a:e.a,this.b=t.b!=null?t.b:e.b,this.c=t.c!=null?t.c:e.c,this.d=t.d!=null?t.d:e.d,this.e=t.e!=null?t.e:e.e,this.f=t.f!=null?t.f:e.f,this}inverse(){return this.clone().inverseO()}inverseO(){let t=this.a,e=this.b,s=this.c,n=this.d,i=this.e,o=this.f,a=t*n-e*s;if(!a)throw new Error("Cannot invert "+this);let l=n/a,g=-e/a,v=-s/a,d=t/a,p=-(l*i+v*o),u=-(g*i+d*o);return this.a=l,this.b=g,this.c=v,this.d=d,this.e=p,this.f=u,this}lmultiply(t){return this.clone().lmultiplyO(t)}lmultiplyO(t){let e=this,s=t instanceof r?t:new r(t);return r.matrixMultiply(s,e,this)}multiply(t){return this.clone().multiplyO(t)}multiplyO(t){let e=this,s=t instanceof r?t:new r(t);return r.matrixMultiply(e,s,this)}rotate(t,e,s){return this.clone().rotateO(t,e,s)}rotateO(t,e=0,s=0){t=Kr(t);let n=Math.cos(t),i=Math.sin(t),{a:o,b:a,c:l,d:g,e:v,f:d}=this;return this.a=o*n-a*i,this.b=a*n+o*i,this.c=l*n-g*i,this.d=g*n+l*i,this.e=v*n-d*i+s*i-e*n+e,this.f=d*n+v*i-e*i-s*n+s,this}scale(t,e,s,n){return this.clone().scaleO(...arguments)}scaleO(t,e=t,s=0,n=0){arguments.length===3&&(n=s,s=e,e=t);let{a:i,b:o,c:a,d:l,e:g,f:v}=this;return this.a=i*t,this.b=o*e,this.c=a*t,this.d=l*e,this.e=g*t-s*t+s,this.f=v*e-n*e+n,this}shear(t,e,s){return this.clone().shearO(t,e,s)}shearO(t,e=0,s=0){let{a:n,b:i,c:o,d:a,e:l,f:g}=this;return this.a=n+i*t,this.c=o+a*t,this.e=l+g*t-s*t,this}skew(t,e,s,n){return this.clone().skewO(...arguments)}skewO(t,e=t,s=0,n=0){arguments.length===3&&(n=s,s=e,e=t),t=Kr(t),e=Kr(e);let i=Math.tan(t),o=Math.tan(e),{a,b:l,c:g,d:v,e:d,f:p}=this;return this.a=a+l*i,this.b=l+a*o,this.c=g+v*i,this.d=v+g*o,this.e=d+p*i-n*i,this.f=p+d*o-s*o,this}skewX(t,e,s){return this.skew(t,0,e,s)}skewY(t,e,s){return this.skew(0,t,e,s)}toArray(){return[this.a,this.b,this.c,this.d,this.e,this.f]}toString(){return"matrix("+this.a+","+this.b+","+this.c+","+this.d+","+this.e+","+this.f+")"}transform(t){if(r.isMatrixLike(t))return new r(t).multiplyO(this);let e=r.formatTransforms(t),s=this,{x:n,y:i}=new K(e.ox,e.oy).transform(s),o=new r().translateO(e.rx,e.ry).lmultiplyO(s).translateO(-n,-i).scaleO(e.scaleX,e.scaleY).skewO(e.skewX,e.skewY).shearO(e.shear).rotateO(e.theta).translateO(n,i);if(isFinite(e.px)||isFinite(e.py)){let a=new K(n,i).transform(o),l=isFinite(e.px)?e.px-a.x:0,g=isFinite(e.py)?e.py-a.y:0;o.translateO(l,g)}return o.translateO(e.tx,e.ty),o}translate(t,e){return this.clone().translateO(t,e)}translateO(t,e){return this.e+=t||0,this.f+=e||0,this}valueOf(){return{a:this.a,b:this.b,c:this.c,d:this.d,e:this.e,f:this.f}}};function ca(){return new z(this.node.getCTM())}function da(){if(typeof this.isRoot=="function"&&!this.isRoot()){let r=this.rect(1,1),t=r.node.getScreenCTM();return r.remove(),new z(t)}return new z(this.node.getScreenCTM())}V(z,"Matrix");function ee(){if(!ee.nodes){let r=ct().size(2,0);r.node.style.cssText=["opacity: 0","position: absolute","left: -100%","top: -100%","overflow: hidden"].join(";"),r.attr("focusable","false"),r.attr("aria-hidden","true");let t=r.path().node;ee.nodes={svg:r,path:t}}if(!ee.nodes.svg.node.parentNode){let r=X.document.body||X.document.documentElement;ee.nodes.svg.addTo(r)}return ee.nodes}function Pn(r){return!r.width&&!r.height&&!r.x&&!r.y}function pa(r){return r===X.document||(X.document.documentElement.contains||function(t){for(;t.parentNode;)t=t.parentNode;return t===X.document}).call(X.document.documentElement,r)}var ut=class r{constructor(...t){this.init(...t)}addOffset(){return this.x+=X.window.pageXOffset,this.y+=X.window.pageYOffset,new r(this)}init(t){let e=[0,0,0,0];return t=typeof t=="string"?t.split(Ut).map(parseFloat):Array.isArray(t)?t:typeof t=="object"?[t.left!=null?t.left:t.x,t.top!=null?t.top:t.y,t.width,t.height]:arguments.length===4?[].slice.call(arguments):e,this.x=t[0]||0,this.y=t[1]||0,this.width=this.w=t[2]||0,this.height=this.h=t[3]||0,this.x2=this.x+this.w,this.y2=this.y+this.h,this.cx=this.x+this.w/2,this.cy=this.y+this.h/2,this}isNulled(){return Pn(this)}merge(t){let e=Math.min(this.x,t.x),s=Math.min(this.y,t.y),n=Math.max(this.x+this.width,t.x+t.width)-e,i=Math.max(this.y+this.height,t.y+t.height)-s;return new r(e,s,n,i)}toArray(){return[this.x,this.y,this.width,this.height]}toString(){return this.x+" "+this.y+" "+this.width+" "+this.height}transform(t){t instanceof z||(t=new z(t));let e=1/0,s=-1/0,n=1/0,i=-1/0;return[new K(this.x,this.y),new K(this.x2,this.y),new K(this.x,this.y2),new K(this.x2,this.y2)].forEach(function(a){a=a.transform(t),e=Math.min(e,a.x),s=Math.max(s,a.x),n=Math.min(n,a.y),i=Math.max(i,a.y)}),new r(e,n,s-e,i-n)}};function Jn(r,t,e){let s;try{if(s=t(r.node),Pn(s)&&!pa(r.node))throw new Error("Element not in the dom")}catch(n){s=e(r)}return s}function ma(){let e=Jn(this,n=>n.getBBox(),n=>{try{let i=n.clone().addTo(ee().svg).show(),o=i.node.getBBox();return i.remove(),o}catch(i){throw new Error(`Getting bbox of element "${n.node.nodeName}" is not possible: ${i.toString()}`)}});return new ut(e)}function ua(r){let s=Jn(this,i=>i.getBoundingClientRect(),i=>{throw new Error(`Getting rbox of element "${i.node.nodeName}" is not possible`)}),n=new ut(s);return r?n.transform(r.screenCTM().inverseO()):n.addOffset()}function fa(r,t){let e=this.bbox();return r>e.x&&t>e.y&&r<e.x+e.width&&t<e.y+e.height}B({viewbox:{viewbox(r,t,e,s){return r==null?new ut(this.attr("viewBox")):this.attr("viewBox",new ut(r,t,e,s))},zoom(r,t){let{width:e,height:s}=this.attr(["width","height"]);if((!e&&!s||typeof e=="string"||typeof s=="string")&&(e=this.node.clientWidth,s=this.node.clientHeight),!e||!s)throw new Error("Impossible to get absolute width and height. Please provide an absolute width and height attribute on the zooming element");let n=this.viewbox(),i=e/n.width,o=s/n.height,a=Math.min(i,o);if(r==null)return a;let l=a/r;l===1/0&&(l=Number.MAX_SAFE_INTEGER/100),t=t||new K(e/2/i+n.x,s/2/o+n.y);let g=new ut(n).transform(new z({scale:l,origin:t}));return this.viewbox(g)}}});V(ut,"Box");var Xt=class extends Array{constructor(t=[],...e){if(super(t,...e),typeof t=="number")return this;this.length=0,this.push(...t)}};O([Xt],{each(r,...t){return typeof r=="function"?this.map((e,s,n)=>r.call(e,e,s,n)):this.map(e=>e[r](...t))},toArray(){return Array.prototype.concat.apply([],this)}});var ha=["toArray","constructor","each"];Xt.extend=function(r){r=r.reduce((t,e)=>(ha.includes(e)||e[0]==="_"||(t[e]=function(...s){return this.each(e,...s)}),t),{}),O([Xt],r)};function ne(r,t){return new Xt(os((t||X.document).querySelectorAll(r),function(e){return wt(e)}))}function ba(r){return ne(r,this.node)}function xa(r){return wt(this.node.querySelector(r))}var ya=0,qn={};function Kn(r){let t=r.getEventHolder();return t===X.window&&(t=qn),t.events||(t.events={}),t.events}function Qs(r){return r.getEventTarget()}function wa(r){let t=r.getEventHolder();t===X.window&&(t=qn),t.events&&(t.events={})}function zs(r,t,e,s,n){let i=e.bind(s||r),o=ct(r),a=Kn(o),l=Qs(o);t=Array.isArray(t)?t:t.split(Ut),e._svgjsListenerId||(e._svgjsListenerId=++ya),t.forEach(function(g){let v=g.split(".")[0],d=g.split(".")[1]||"*";a[v]=a[v]||{},a[v][d]=a[v][d]||{},a[v][d][e._svgjsListenerId]=i,l.addEventListener(v,i,n||!1)})}function Me(r,t,e,s){let n=ct(r),i=Kn(n),o=Qs(n);typeof e=="function"&&(e=e._svgjsListenerId,!e)||(t=Array.isArray(t)?t:(t||"").split(Ut),t.forEach(function(a){let l=a&&a.split(".")[0],g=a&&a.split(".")[1],v,d;if(e)i[l]&&i[l][g||"*"]&&(o.removeEventListener(l,i[l][g||"*"][e],s||!1),delete i[l][g||"*"][e]);else if(l&&g){if(i[l]&&i[l][g]){for(d in i[l][g])Me(o,[l,g].join("."),d);delete i[l][g]}}else if(g)for(a in i)for(v in i[a])g===v&&Me(o,[a,g].join("."));else if(l){if(i[l]){for(v in i[l])Me(o,[l,v].join("."));delete i[l]}}else{for(a in i)Me(o,a);wa(n)}}))}function _a(r,t,e,s){let n=Qs(r);return t instanceof X.window.Event||(t=new X.window.CustomEvent(t,{detail:e,cancelable:!0,...s})),n.dispatchEvent(t),t}var de=class extends dr{addEventListener(){}dispatch(t,e,s){return _a(this,t,e,s)}dispatchEvent(t){let e=this.getEventHolder().events;if(!e)return!0;let s=e[t.type];for(let n in s)for(let i in s[n])s[n][i](t);return!t.defaultPrevented}fire(t,e,s){return this.dispatch(t,e,s),this}getEventHolder(){return this}getEventTarget(){return this}off(t,e,s){return Me(this,t,e,s),this}on(t,e,s,n){return zs(this,t,e,s,n),this}removeEventListener(){}};V(de,"EventTarget");function zn(){}var vr={duration:400,ease:">",delay:0},ka={"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","text-anchor":"start"};var Et=class extends Array{constructor(...t){super(...t),this.init(...t)}clone(){return new this.constructor(this)}init(t){return typeof t=="number"?this:(this.length=0,this.push(...this.parse(t)),this)}parse(t=[]){return t instanceof Array?t:t.trim().split(Ut).map(parseFloat)}toArray(){return Array.prototype.concat.apply([],this)}toSet(){return new Set(this)}toString(){return this.join(" ")}valueOf(){let t=[];return t.push(...this),t}},j=class r{constructor(...t){this.init(...t)}convert(t){return new r(this.value,t)}divide(t){return t=new r(t),new r(this/t,this.unit||t.unit)}init(t,e){return e=Array.isArray(t)?t[1]:e,t=Array.isArray(t)?t[0]:t,this.value=0,this.unit=e||"",typeof t=="number"?this.value=isNaN(t)?0:isFinite(t)?t:t<0?-34e37:34e37:typeof t=="string"?(e=t.match(Yn),e&&(this.value=parseFloat(e[1]),e[5]==="%"?this.value/=100:e[5]==="s"&&(this.value*=1e3),this.unit=e[5])):t instanceof r&&(this.value=t.valueOf(),this.unit=t.unit),this}minus(t){return t=new r(t),new r(this-t,this.unit||t.unit)}plus(t){return t=new r(t),new r(this+t,this.unit||t.unit)}times(t){return t=new r(t),new r(this*t,this.unit||t.unit)}toArray(){return[this.value,this.unit]}toJSON(){return this.toString()}toString(){return(this.unit==="%"?~~(this.value*1e8)/1e6:this.unit==="s"?this.value/1e3:this.value)+this.unit}valueOf(){return this.value}},ti=[];function Aa(r){ti.push(r)}function Ia(r,t,e){if(r==null){r={},t=this.node.attributes;for(let s of t)r[s.nodeName]=Nn.test(s.nodeValue)?parseFloat(s.nodeValue):s.nodeValue;return r}else{if(r instanceof Array)return r.reduce((s,n)=>(s[n]=this.attr(n),s),{});if(typeof r=="object"&&r.constructor===Object)for(t in r)this.attr(t,r[t]);else if(t===null)this.node.removeAttribute(r);else{if(t==null)return t=this.node.getAttribute(r),t==null?ka[r]:Nn.test(t)?parseFloat(t):t;t=ti.reduce((s,n)=>n(r,s,this),t),typeof t=="number"?t=new j(t):_t.isColor(t)?t=new _t(t):t.constructor===Array&&(t=new Et(t)),r==="leading"?this.leading&&this.leading(t):typeof e=="string"?this.node.setAttributeNS(e,r,t.toString()):this.node.setAttribute(r,t.toString()),this.rebuild&&(r==="font-size"||r==="x")&&this.rebuild()}}return this}var re=class r extends de{constructor(t,e){super(),this.node=t,this.type=t.nodeName,e&&t!==e&&this.attr(e)}add(t,e){return t=ct(t),t.removeNamespace&&this.node instanceof X.window.SVGElement&&t.removeNamespace(),e==null?this.node.appendChild(t.node):t.node!==this.node.childNodes[e]&&this.node.insertBefore(t.node,this.node.childNodes[e]),this}addTo(t,e){return ct(t).put(this,e)}children(){return new Xt(os(this.node.children,function(t){return wt(t)}))}clear(){for(;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);return this}clone(t=!0,e=!0){this.writeDataToDom();let s=this.node.cloneNode(t);return e&&(s=Qn(s)),new this.constructor(s)}each(t,e){let s=this.children(),n,i;for(n=0,i=s.length;n<i;n++)t.apply(s[n],[n,s]),e&&s[n].each(t,e);return this}element(t,e){return this.put(new r(pr(t),e))}first(){return wt(this.node.firstChild)}get(t){return wt(this.node.childNodes[t])}getEventHolder(){return this.node}getEventTarget(){return this.node}has(t){return this.index(t)>=0}html(t,e){return this.xml(t,e,Ln)}id(t){return typeof t=="undefined"&&!this.node.id&&(this.node.id=Zn(this.type)),this.attr("id",t)}index(t){return[].slice.call(this.node.childNodes).indexOf(t.node)}last(){return wt(this.node.lastChild)}matches(t){let e=this.node,s=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector||null;return s&&s.call(e,t)}parent(t){let e=this;if(!e.node.parentNode)return null;if(e=wt(e.node.parentNode),!t)return e;do if(typeof t=="string"?e.matches(t):e instanceof t)return e;while(e=wt(e.node.parentNode));return e}put(t,e){return t=ct(t),this.add(t,e),t}putIn(t,e){return ct(t).add(this,e)}remove(){return this.parent()&&this.parent().removeElement(this),this}removeElement(t){return this.node.removeChild(t.node),this}replace(t){return t=ct(t),this.node.parentNode&&this.node.parentNode.replaceChild(t.node,this.node),t}round(t=2,e=null){let s=10**t,n=this.attr(e);for(let i in n)typeof n[i]=="number"&&(n[i]=Math.round(n[i]*s)/s);return this.attr(n),this}svg(t,e){return this.xml(t,e,as)}toString(){return this.id()}words(t){return this.node.textContent=t,this}wrap(t){let e=this.parent();if(!e)return this.addTo(t);let s=e.index(this);return e.put(t,s).put(this)}writeDataToDom(){return this.each(function(){this.writeDataToDom()}),this}xml(t,e,s){if(typeof t=="boolean"&&(s=e,e=t,t=null),t==null||typeof t=="function"){e=e==null?!0:e,this.writeDataToDom();let a=this;if(t!=null){if(a=wt(a.node.cloneNode(!0)),e){let l=t(a);if(a=l||a,l===!1)return""}a.each(function(){let l=t(this),g=l||this;l===!1?this.remove():l&&this!==g&&this.replace(g)},!0)}return e?a.node.outerHTML:a.node.innerHTML}e=e==null?!1:e;let n=pr("wrapper",s),i=X.document.createDocumentFragment();n.innerHTML=t;for(let a=n.children.length;a--;)i.appendChild(n.firstElementChild);let o=this.parent();return e?this.replace(i)&&o:this.add(i)}};O(re,{attr:Ia,find:ba,findOne:xa});V(re,"Dom");var ot=class extends re{constructor(t,e){super(t,e),this.dom={},this.node.instance=this,t.hasAttribute("svgjs:data")&&this.setData(JSON.parse(t.getAttribute("svgjs:data"))||{})}center(t,e){return this.cx(t).cy(e)}cx(t){return t==null?this.x()+this.width()/2:this.x(t-this.width()/2)}cy(t){return t==null?this.y()+this.height()/2:this.y(t-this.height()/2)}defs(){let t=this.root();return t&&t.defs()}dmove(t,e){return this.dx(t).dy(e)}dx(t=0){return this.x(new j(t).plus(this.x()))}dy(t=0){return this.y(new j(t).plus(this.y()))}getEventHolder(){return this}height(t){return this.attr("height",t)}move(t,e){return this.x(t).y(e)}parents(t=this.root()){let e=typeof t=="string";e||(t=ct(t));let s=new Xt,n=this;for(;(n=n.parent())&&n.node!==X.document&&n.nodeName!=="#document-fragment"&&(s.push(n),!(!e&&n.node===t.node||e&&n.matches(t)));)if(n.node===this.root().node)return null;return s}reference(t){if(t=this.attr(t),!t)return null;let e=(t+"").match(Xo);return e?ct(e[1]):null}root(){let t=this.parent(To(Hs));return t&&t.root()}setData(t){return this.dom=t,this}size(t,e){let s=ye(this,t,e);return this.width(new j(s.width)).height(new j(s.height))}width(t){return this.attr("width",t)}writeDataToDom(){return this.node.removeAttribute("svgjs:data"),Object.keys(this.dom).length&&this.node.setAttribute("svgjs:data",JSON.stringify(this.dom)),super.writeDataToDom()}x(t){return this.attr("x",t)}y(t){return this.attr("y",t)}};O(ot,{bbox:ma,rbox:ua,inside:fa,point:va,ctm:ca,screenCTM:da});V(ot,"Element");var ar={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(r,t){return t==="color"?r:r+"-"+t}};["fill","stroke"].forEach(function(r){let t={},e;t[r]=function(s){if(typeof s=="undefined")return this.attr(r);if(typeof s=="string"||s instanceof _t||_t.isRgb(s)||s instanceof ot)this.attr(r,s);else for(e=ar[r].length-1;e>=0;e--)s[ar[r][e]]!=null&&this.attr(ar.prefix(r,ar[r][e]),s[ar[r][e]]);return this},B(["Element","Runner"],t)});B(["Element","Runner"],{matrix:function(r,t,e,s,n,i){return r==null?new z(this):this.attr("transform",new z(r,t,e,s,n,i))},rotate:function(r,t,e){return this.transform({rotate:r,ox:t,oy:e},!0)},skew:function(r,t,e,s){return arguments.length===1||arguments.length===3?this.transform({skew:r,ox:t,oy:e},!0):this.transform({skew:[r,t],ox:e,oy:s},!0)},shear:function(r,t,e){return this.transform({shear:r,ox:t,oy:e},!0)},scale:function(r,t,e,s){return arguments.length===1||arguments.length===3?this.transform({scale:r,ox:t,oy:e},!0):this.transform({scale:[r,t],ox:e,oy:s},!0)},translate:function(r,t){return this.transform({translate:[r,t]},!0)},relative:function(r,t){return this.transform({relative:[r,t]},!0)},flip:function(r="both",t="center"){return"xybothtrue".indexOf(r)===-1&&(t=r,r="both"),this.transform({flip:r,origin:t},!0)},opacity:function(r){return this.attr("opacity",r)}});B("radius",{radius:function(r,t=r){return(this._element||this).type==="radialGradient"?this.attr("r",new j(r)):this.rx(r).ry(t)}});B("Path",{length:function(){return this.node.getTotalLength()},pointAt:function(r){return new K(this.node.getPointAtLength(r))}});B(["Element","Runner"],{font:function(r,t){if(typeof r=="object"){for(t in r)this.font(t,r[t]);return this}return r==="leading"?this.leading(t):r==="anchor"?this.attr("text-anchor",t):r==="size"||r==="family"||r==="weight"||r==="stretch"||r==="variant"||r==="style"?this.attr("font-"+r,t):this.attr(r,t)}});var Ca=["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","mouseenter","mouseleave","touchstart","touchmove","touchleave","touchend","touchcancel"].reduce(function(r,t){let e=function(s){return s===null?this.off(t):this.on(t,s),this};return r[t]=e,r},{});B("Element",Ca);function Ta(){return this.attr("transform",null)}function Fa(){return(this.attr("transform")||"").split(Lo).slice(0,-1).map(function(t){let e=t.trim().split("(");return[e[0],e[1].split(Ut).map(function(s){return parseFloat(s)})]}).reverse().reduce(function(t,e){return e[0]==="matrix"?t.lmultiply(z.fromArray(e[1])):t[e[0]].apply(t,e[1])},new z)}function Sa(r,t){if(this===r)return this;let e=this.screenCTM(),s=r.screenCTM().inverse();return this.addTo(r,t).untransform().transform(s.multiply(e)),this}function Ra(r){return this.toParent(this.root(),r)}function Ea(r,t){if(r==null||typeof r=="string"){let n=new z(this).decompose();return r==null?n:n[r]}z.isMatrixLike(r)||(r={...r,origin:ts(r,this)});let e=t===!0?this:t||!1,s=new z(e).transform(r);return this.attr("transform",s)}B("Element",{untransform:Ta,matrixify:Fa,toParent:Sa,toRoot:Ra,transform:Ea});var at=class r extends ot{flatten(t=this,e){return this.each(function(){if(this instanceof r)return this.flatten().ungroup()}),this}ungroup(t=this.parent(),e=t.index(this)){return e=e===-1?t.children().length:e,this.each(function(s,n){return n[n.length-s-1].toParent(t,e)}),this.remove()}};V(at,"Container");var pe=class extends at{constructor(t,e=t){super(H("defs",t),e)}flatten(){return this}ungroup(){return this}};V(pe,"Defs");var dt=class extends ot{};V(dt,"Shape");function Ys(r){return this.attr("rx",r)}function Ps(r){return this.attr("ry",r)}function ei(r){return r==null?this.cx()-this.rx():this.cx(r+this.rx())}function ri(r){return r==null?this.cy()-this.ry():this.cy(r+this.ry())}function si(r){return this.attr("cx",r)}function ni(r){return this.attr("cy",r)}function ii(r){return r==null?this.rx()*2:this.rx(new j(r).divide(2))}function oi(r){return r==null?this.ry()*2:this.ry(new j(r).divide(2))}var Oa={__proto__:null,rx:Ys,ry:Ps,x:ei,y:ri,cx:si,cy:ni,width:ii,height:oi},ze=class extends dt{constructor(t,e=t){super(H("ellipse",t),e)}size(t,e){let s=ye(this,t,e);return this.rx(new j(s.width).divide(2)).ry(new j(s.height).divide(2))}};O(ze,Oa);B("Container",{ellipse:U(function(r=0,t=r){return this.put(new ze).size(r,t).move(0,0)})});V(ze,"Ellipse");var es=class extends re{constructor(t=X.document.createDocumentFragment()){super(t)}xml(t,e,s){if(typeof t=="boolean"&&(s=e,e=t,t=null),t==null||typeof t=="function"){let n=new re(pr("wrapper",s));return n.add(this.node.cloneNode(!0)),n.xml(!1,s)}return super.xml(t,!1,s)}};V(es,"Fragment");function ai(r,t){return(this._element||this).type==="radialGradient"?this.attr({fx:new j(r),fy:new j(t)}):this.attr({x1:new j(r),y1:new j(t)})}function li(r,t){return(this._element||this).type==="radialGradient"?this.attr({cx:new j(r),cy:new j(t)}):this.attr({x2:new j(r),y2:new j(t)})}var Da={__proto__:null,from:ai,to:li},me=class extends at{constructor(t,e){super(H(t+"Gradient",typeof t=="string"?null:t),e)}attr(t,e,s){return t==="transform"&&(t="gradientTransform"),super.attr(t,e,s)}bbox(){return new ut}targets(){return ne("svg [fill*="+this.id()+"]")}toString(){return this.url()}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}url(){return"url(#"+this.id()+")"}};O(me,Da);B({Container:{gradient(...r){return this.defs().gradient(...r)}},Defs:{gradient:U(function(r,t){return this.put(new me(r)).update(t)})}});V(me,"Gradient");var ue=class extends at{constructor(t,e=t){super(H("pattern",t),e)}attr(t,e,s){return t==="transform"&&(t="patternTransform"),super.attr(t,e,s)}bbox(){return new ut}targets(){return ne("svg [fill*="+this.id()+"]")}toString(){return this.url()}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}url(){return"url(#"+this.id()+")"}};B({Container:{pattern(...r){return this.defs().pattern(...r)}},Defs:{pattern:U(function(r,t,e){return this.put(new ue).update(e).attr({x:0,y:0,width:r,height:t,patternUnits:"userSpaceOnUse"})})}});V(ue,"Pattern");var $e=class extends dt{constructor(t,e=t){super(H("image",t),e)}load(t,e){if(!t)return this;let s=new X.window.Image;return zs(s,"load",function(n){let i=this.parent(ue);this.width()===0&&this.height()===0&&this.size(s.width,s.height),i instanceof ue&&i.width()===0&&i.height()===0&&i.size(this.width(),this.height()),typeof e=="function"&&e.call(this,n)},this),zs(s,"load error",function(){Me(s)}),this.attr("href",s.src=t,He)}};Aa(function(r,t,e){return(r==="fill"||r==="stroke")&&Ho.test(t)&&(t=e.root().defs().image(t)),t instanceof $e&&(t=e.root().defs().pattern(0,0,s=>{s.add(t)})),t});B({Container:{image:U(function(r,t){return this.put(new $e).size(0,0).load(r,t)})}});V($e,"Image");var Ot=class extends Et{bbox(){let t=-1/0,e=-1/0,s=1/0,n=1/0;return this.forEach(function(i){t=Math.max(i[0],t),e=Math.max(i[1],e),s=Math.min(i[0],s),n=Math.min(i[1],n)}),new ut(s,n,t-s,e-n)}move(t,e){let s=this.bbox();if(t-=s.x,e-=s.y,!isNaN(t)&&!isNaN(e))for(let n=this.length-1;n>=0;n--)this[n]=[this[n][0]+t,this[n][1]+e];return this}parse(t=[0,0]){let e=[];t instanceof Array?t=Array.prototype.concat.apply([],t):t=t.trim().split(Ut).map(parseFloat),t.length%2!==0&&t.pop();for(let s=0,n=t.length;s<n;s=s+2)e.push([t[s],t[s+1]]);return e}size(t,e){let s,n=this.bbox();for(s=this.length-1;s>=0;s--)n.width&&(this[s][0]=(this[s][0]-n.x)*t/n.width+n.x),n.height&&(this[s][1]=(this[s][1]-n.y)*e/n.height+n.y);return this}toLine(){return{x1:this[0][0],y1:this[0][1],x2:this[1][0],y2:this[1][1]}}toString(){let t=[];for(let e=0,s=this.length;e<s;e++)t.push(this[e].join(","));return t.join(" ")}transform(t){return this.clone().transformO(t)}transformO(t){z.isMatrixLike(t)||(t=new z(t));for(let e=this.length;e--;){let[s,n]=this[e];this[e][0]=t.a*s+t.c*n+t.e,this[e][1]=t.b*s+t.d*n+t.f}return this}},Ga=Ot;function Ba(r){return r==null?this.bbox().x:this.move(r,this.bbox().y)}function Ma(r){return r==null?this.bbox().y:this.move(this.bbox().x,r)}function Na(r){let t=this.bbox();return r==null?t.width:this.size(r,t.height)}function za(r){let t=this.bbox();return r==null?t.height:this.size(t.width,r)}var Js={__proto__:null,MorphArray:Ga,x:Ba,y:Ma,width:Na,height:za},fe=class extends dt{constructor(t,e=t){super(H("line",t),e)}array(){return new Ot([[this.attr("x1"),this.attr("y1")],[this.attr("x2"),this.attr("y2")]])}move(t,e){return this.attr(this.array().move(t,e).toLine())}plot(t,e,s,n){return t==null?this.array():(typeof e!="undefined"?t={x1:t,y1:e,x2:s,y2:n}:t=new Ot(t).toLine(),this.attr(t))}size(t,e){let s=ye(this,t,e);return this.attr(this.array().size(s.width,s.height).toLine())}};O(fe,Js);B({Container:{line:U(function(...r){return fe.prototype.plot.apply(this.put(new fe),r[0]!=null?r:[0,0,0,0])})}});V(fe,"Line");var je=class extends at{constructor(t,e=t){super(H("marker",t),e)}height(t){return this.attr("markerHeight",t)}orient(t){return this.attr("orient",t)}ref(t,e){return this.attr("refX",t).attr("refY",e)}toString(){return"url(#"+this.id()+")"}update(t){return this.clear(),typeof t=="function"&&t.call(this,this),this}width(t){return this.attr("markerWidth",t)}};B({Container:{marker(...r){return this.defs().marker(...r)}},Defs:{marker:U(function(r,t,e){return this.put(new je).size(r,t).ref(r/2,t/2).viewbox(0,0,r,t).attr("orient","auto").update(e)})},marker:{marker(r,t,e,s){let n=["marker"];return r!=="all"&&n.push(r),n=n.join("-"),r=arguments[1]instanceof je?arguments[1]:this.defs().marker(t,e,s),this.attr(n,r)}}});V(je,"Marker");function Ne(r,t){return function(e){return e==null?this[r]:(this[r]=e,t&&t.call(this),this)}}var $a={"-":function(r){return r},"<>":function(r){return-Math.cos(r*Math.PI)/2+.5},">":function(r){return Math.sin(r*Math.PI/2)},"<":function(r){return-Math.cos(r*Math.PI/2)+1},bezier:function(r,t,e,s){return function(n){return n<0?r>0?t/r*n:e>0?s/e*n:0:n>1?e<1?(1-s)/(1-e)*n+(s-e)/(1-e):r<1?(1-t)/(1-r)*n+(t-r)/(1-r):1:3*n*(1-n)**2*t+3*n**2*(1-n)*s+n**3}},steps:function(r,t="end"){t=t.split("-").reverse()[0];let e=r;return t==="none"?--e:t==="both"&&++e,(s,n=!1)=>{let i=Math.floor(s*r),o=s*i%1===0;return(t==="start"||t==="both")&&++i,n&&o&&--i,s>=0&&i<0&&(i=0),s<=1&&i>e&&(i=e),i/e}}},mr=class{done(){return!1}},ur=class extends mr{constructor(t=vr.ease){super(),this.ease=$a[t]||t}step(t,e,s){return typeof t!="number"?s<1?t:e:t+(e-t)*this.ease(s)}},Ve=class extends mr{constructor(t){super(),this.stepper=t}done(t){return t.done}step(t,e,s,n){return this.stepper(t,e,s,n)}};function $n(){let r=(this._duration||500)/1e3,t=this._overshoot||0,e=1e-10,s=Math.PI,n=Math.log(t/100+e),i=-n/Math.sqrt(s*s+n*n),o=3.9/(i*r);this.d=2*i*o,this.k=o*o}var $s=class extends Ve{constructor(t=500,e=0){super(),this.duration(t).overshoot(e)}step(t,e,s,n){if(typeof t=="string")return t;if(n.done=s===1/0,s===1/0)return e;if(s===0)return t;s>100&&(s=16),s/=1e3;let i=n.velocity||0,o=-this.d*i-this.k*(t-e),a=t+i*s+o*s*s/2;return n.velocity=i+o*s,n.done=Math.abs(e-a)+Math.abs(i)<.002,n.done?e:a}};O($s,{duration:Ne("_duration",$n),overshoot:Ne("_overshoot",$n)});var js=class extends Ve{constructor(t=.1,e=.01,s=0,n=1e3){super(),this.p(t).i(e).d(s).windup(n)}step(t,e,s,n){if(typeof t=="string")return t;if(n.done=s===1/0,s===1/0)return e;if(s===0)return t;let i=e-t,o=(n.integral||0)+i*s,a=(i-(n.error||0))/s,l=this._windup;return l!==!1&&(o=Math.max(-l,Math.min(o,l))),n.error=i,n.integral=o,n.done=Math.abs(i)<.001,n.done?e:t+(this.P*i+this.I*o+this.D*a)}};O(js,{windup:Ne("_windup"),p:Ne("P"),i:Ne("I"),d:Ne("D")});var ja={M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7,Z:0},Vs={M:function(r,t,e){return t.x=e.x=r[0],t.y=e.y=r[1],["M",t.x,t.y]},L:function(r,t){return t.x=r[0],t.y=r[1],["L",r[0],r[1]]},H:function(r,t){return t.x=r[0],["H",r[0]]},V:function(r,t){return t.y=r[0],["V",r[0]]},C:function(r,t){return t.x=r[4],t.y=r[5],["C",r[0],r[1],r[2],r[3],r[4],r[5]]},S:function(r,t){return t.x=r[2],t.y=r[3],["S",r[0],r[1],r[2],r[3]]},Q:function(r,t){return t.x=r[2],t.y=r[3],["Q",r[0],r[1],r[2],r[3]]},T:function(r,t){return t.x=r[0],t.y=r[1],["T",r[0],r[1]]},Z:function(r,t,e){return t.x=e.x,t.y=e.y,["Z"]},A:function(r,t){return t.x=r[5],t.y=r[6],["A",r[0],r[1],r[2],r[3],r[4],r[5],r[6]]}},Ms="mlhvqtcsaz".split("");for(let r=0,t=Ms.length;r<t;++r)Vs[Ms[r]]=function(e){return function(s,n,i){if(e==="H")s[0]=s[0]+n.x;else if(e==="V")s[0]=s[0]+n.y;else if(e==="A")s[5]=s[5]+n.x,s[6]=s[6]+n.y;else for(let o=0,a=s.length;o<a;++o)s[o]=s[o]+(o%2?n.y:n.x);return Vs[e](s,n,i)}}(Ms[r].toUpperCase());function Va(r){let t=r.segment[0];return Vs[t](r.segment.slice(1),r.p,r.p0)}function Ws(r){return r.segment.length&&r.segment.length-1===ja[r.segment[0].toUpperCase()]}function Wa(r,t){r.inNumber&&ve(r,!1);let e=Zs.test(t);if(e)r.segment=[t];else{let s=r.lastCommand,n=s.toLowerCase(),i=s===n;r.segment=[n==="m"?i?"l":"L":s]}return r.inSegment=!0,r.lastCommand=r.segment[0],e}function ve(r,t){if(!r.inNumber)throw new Error("Parser Error");r.number&&r.segment.push(parseFloat(r.number)),r.inNumber=t,r.number="",r.pointSeen=!1,r.hasExponent=!1,Ws(r)&&Xs(r)}function Xs(r){r.inSegment=!1,r.absolute&&(r.segment=Va(r)),r.segments.push(r.segment)}function Xa(r){if(!r.segment.length)return!1;let t=r.segment[0].toUpperCase()==="A",e=r.segment.length;return t&&(e===4||e===5)}function La(r){return r.lastToken.toUpperCase()==="E"}function Ua(r,t=!0){let e=0,s="",n={segment:[],inNumber:!1,number:"",lastToken:"",inSegment:!1,segments:[],pointSeen:!1,hasExponent:!1,absolute:t,p0:new K,p:new K};for(;n.lastToken=s,s=r.charAt(e++);)if(!(!n.inSegment&&Wa(n,s))){if(s==="."){if(n.pointSeen||n.hasExponent){ve(n,!1),--e;continue}n.inNumber=!0,n.pointSeen=!0,n.number+=s;continue}if(!isNaN(parseInt(s))){if(n.number==="0"||Xa(n)){n.inNumber=!0,n.number=s,ve(n,!0);continue}n.inNumber=!0,n.number+=s;continue}if(s===" "||s===","){n.inNumber&&ve(n,!1);continue}if(s==="-"){if(n.inNumber&&!La(n)){ve(n,!1),--e;continue}n.number+=s,n.inNumber=!0;continue}if(s.toUpperCase()==="E"){n.number+=s,n.hasExponent=!0;continue}if(Zs.test(s)){if(n.inNumber)ve(n,!1);else if(Ws(n))Xs(n);else throw new Error("parser Error");--e}}return n.inNumber&&ve(n,!1),n.inSegment&&Ws(n)&&Xs(n),n.segments}function Ha(r){let t="";for(let e=0,s=r.length;e<s;e++)t+=r[e][0],r[e][1]!=null&&(t+=r[e][1],r[e][2]!=null&&(t+=" ",t+=r[e][2],r[e][3]!=null&&(t+=" ",t+=r[e][3],t+=" ",t+=r[e][4],r[e][5]!=null&&(t+=" ",t+=r[e][5],t+=" ",t+=r[e][6],r[e][7]!=null&&(t+=" ",t+=r[e][7])))));return t+" "}var Lt=class extends Et{bbox(){return ee().path.setAttribute("d",this.toString()),new ut(ee.nodes.path.getBBox())}move(t,e){let s=this.bbox();if(t-=s.x,e-=s.y,!isNaN(t)&&!isNaN(e))for(let n,i=this.length-1;i>=0;i--)n=this[i][0],n==="M"||n==="L"||n==="T"?(this[i][1]+=t,this[i][2]+=e):n==="H"?this[i][1]+=t:n==="V"?this[i][1]+=e:n==="C"||n==="S"||n==="Q"?(this[i][1]+=t,this[i][2]+=e,this[i][3]+=t,this[i][4]+=e,n==="C"&&(this[i][5]+=t,this[i][6]+=e)):n==="A"&&(this[i][6]+=t,this[i][7]+=e);return this}parse(t="M0 0"){return Array.isArray(t)&&(t=Array.prototype.concat.apply([],t).toString()),Ua(t)}size(t,e){let s=this.bbox(),n,i;for(s.width=s.width===0?1:s.width,s.height=s.height===0?1:s.height,n=this.length-1;n>=0;n--)i=this[n][0],i==="M"||i==="L"||i==="T"?(this[n][1]=(this[n][1]-s.x)*t/s.width+s.x,this[n][2]=(this[n][2]-s.y)*e/s.height+s.y):i==="H"?this[n][1]=(this[n][1]-s.x)*t/s.width+s.x:i==="V"?this[n][1]=(this[n][1]-s.y)*e/s.height+s.y:i==="C"||i==="S"||i==="Q"?(this[n][1]=(this[n][1]-s.x)*t/s.width+s.x,this[n][2]=(this[n][2]-s.y)*e/s.height+s.y,this[n][3]=(this[n][3]-s.x)*t/s.width+s.x,this[n][4]=(this[n][4]-s.y)*e/s.height+s.y,i==="C"&&(this[n][5]=(this[n][5]-s.x)*t/s.width+s.x,this[n][6]=(this[n][6]-s.y)*e/s.height+s.y)):i==="A"&&(this[n][1]=this[n][1]*t/s.width,this[n][2]=this[n][2]*e/s.height,this[n][6]=(this[n][6]-s.x)*t/s.width+s.x,this[n][7]=(this[n][7]-s.y)*e/s.height+s.y);return this}toString(){return Ha(this)}},gi=r=>{let t=typeof r;return t==="number"?j:t==="string"?_t.isColor(r)?_t:Ut.test(r)?Zs.test(r)?Lt:Et:Yn.test(r)?j:fr:qs.indexOf(r.constructor)>-1?r.constructor:Array.isArray(r)?Et:t==="object"?he:fr},Wt=class{constructor(t){this._stepper=t||new ur("-"),this._from=null,this._to=null,this._type=null,this._context=null,this._morphObj=null}at(t){return this._morphObj.morph(this._from,this._to,t,this._stepper,this._context)}done(){return this._context.map(this._stepper.done).reduce(function(e,s){return e&&s},!0)}from(t){return t==null?this._from:(this._from=this._set(t),this)}stepper(t){return t==null?this._stepper:(this._stepper=t,this)}to(t){return t==null?this._to:(this._to=this._set(t),this)}type(t){return t==null?this._type:(this._type=t,this)}_set(t){this._type||this.type(gi(t));let e=new this._type(t);return this._type===_t&&(e=this._to?e[this._to[4]]():this._from?e[this._from[4]]():e),this._type===he&&(e=this._to?e.align(this._to):this._from?e.align(this._from):e),e=e.toConsumable(),this._morphObj=this._morphObj||new this._type,this._context=this._context||Array.apply(null,Array(e.length)).map(Object).map(function(s){return s.done=!0,s}),e}},fr=class{constructor(...t){this.init(...t)}init(t){return t=Array.isArray(t)?t[0]:t,this.value=t,this}toArray(){return[this.value]}valueOf(){return this.value}},hr=class r{constructor(...t){this.init(...t)}init(t){return Array.isArray(t)&&(t={scaleX:t[0],scaleY:t[1],shear:t[2],rotate:t[3],translateX:t[4],translateY:t[5],originX:t[6],originY:t[7]}),Object.assign(this,r.defaults,t),this}toArray(){let t=this;return[t.scaleX,t.scaleY,t.shear,t.rotate,t.translateX,t.translateY,t.originX,t.originY]}};hr.defaults={scaleX:1,scaleY:1,shear:0,rotate:0,translateX:0,translateY:0,originX:0,originY:0};var Za=(r,t)=>r[0]<t[0]?-1:r[0]>t[0]?1:0,he=class{constructor(...t){this.init(...t)}align(t){let e=this.values;for(let s=0,n=e.length;s<n;++s){if(e[s+1]===t[s+1]){if(e[s+1]===_t&&t[s+7]!==e[s+7]){let a=t[s+7],l=new _t(this.values.splice(s+3,5))[a]().toArray();this.values.splice(s+3,0,...l)}s+=e[s+2]+2;continue}if(!t[s+1])return this;let i=new t[s+1]().toArray(),o=e[s+2]+3;e.splice(s,o,t[s],t[s+1],t[s+2],...i),s+=e[s+2]+2}return this}init(t){if(this.values=[],Array.isArray(t)){this.values=t.slice();return}t=t||{};let e=[];for(let s in t){let n=gi(t[s]),i=new n(t[s]).toArray();e.push([s,n,i.length,...i])}return e.sort(Za),this.values=e.reduce((s,n)=>s.concat(n),[]),this}toArray(){return this.values}valueOf(){let t={},e=this.values;for(;e.length;){let s=e.shift(),n=e.shift(),i=e.shift(),o=e.splice(0,i);t[s]=new n(o)}return t}},qs=[fr,hr,he];function Qa(r=[]){qs.push(...[].concat(r))}function Ya(){O(qs,{to(r){return new Wt().type(this.constructor).from(this.toArray()).to(r)},fromArray(r){return this.init(r),this},toConsumable(){return this.toArray()},morph(r,t,e,s,n){let i=function(o,a){return s.step(o,t[a],e,n[a],n)};return this.fromArray(r.map(i))}})}var se=class extends dt{constructor(t,e=t){super(H("path",t),e)}array(){return this._array||(this._array=new Lt(this.attr("d")))}clear(){return delete this._array,this}height(t){return t==null?this.bbox().height:this.size(this.bbox().width,t)}move(t,e){return this.attr("d",this.array().move(t,e))}plot(t){return t==null?this.array():this.clear().attr("d",typeof t=="string"?t:this._array=new Lt(t))}size(t,e){let s=ye(this,t,e);return this.attr("d",this.array().size(s.width,s.height))}width(t){return t==null?this.bbox().width:this.size(t,this.bbox().height)}x(t){return t==null?this.bbox().x:this.move(t,this.bbox().y)}y(t){return t==null?this.bbox().y:this.move(this.bbox().x,t)}};se.prototype.MorphArray=Lt;B({Container:{path:U(function(r){return this.put(new se).plot(r||new Lt)})}});V(se,"Path");function Pa(){return this._array||(this._array=new Ot(this.attr("points")))}function Ja(){return delete this._array,this}function qa(r,t){return this.attr("points",this.array().move(r,t))}function Ka(r){return r==null?this.array():this.clear().attr("points",typeof r=="string"?r:this._array=new Ot(r))}function tl(r,t){let e=ye(this,r,t);return this.attr("points",this.array().size(e.width,e.height))}var vi={__proto__:null,array:Pa,clear:Ja,move:qa,plot:Ka,size:tl},be=class extends dt{constructor(t,e=t){super(H("polygon",t),e)}};B({Container:{polygon:U(function(r){return this.put(new be).plot(r||new Ot)})}});O(be,Js);O(be,vi);V(be,"Polygon");var xe=class extends dt{constructor(t,e=t){super(H("polyline",t),e)}};B({Container:{polyline:U(function(r){return this.put(new xe).plot(r||new Ot)})}});O(xe,Js);O(xe,vi);V(xe,"Polyline");var We=class extends dt{constructor(t,e=t){super(H("rect",t),e)}};O(We,{rx:Ys,ry:Ps});B({Container:{rect:U(function(r,t){return this.put(new We).size(r,t)})}});V(We,"Rect");var cr=class{constructor(){this._first=null,this._last=null}first(){return this._first&&this._first.value}last(){return this._last&&this._last.value}push(t){let e=typeof t.next!="undefined"?t:{value:t,next:null,prev:null};return this._last?(e.prev=this._last,this._last.next=e,this._last=e):(this._last=e,this._first=e),e}remove(t){t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t===this._last&&(this._last=t.prev),t===this._first&&(this._first=t.next),t.prev=null,t.next=null}shift(){let t=this._first;return t?(this._first=t.next,this._first&&(this._first.prev=null),this._last=this._first?this._last:null,t.value):null}},L={nextDraw:null,frames:new cr,timeouts:new cr,immediates:new cr,timer:()=>X.window.performance||X.window.Date,transforms:[],frame(r){let t=L.frames.push({run:r});return L.nextDraw===null&&(L.nextDraw=X.window.requestAnimationFrame(L._draw)),t},timeout(r,t){t=t||0;let e=L.timer().now()+t,s=L.timeouts.push({run:r,time:e});return L.nextDraw===null&&(L.nextDraw=X.window.requestAnimationFrame(L._draw)),s},immediate(r){let t=L.immediates.push(r);return L.nextDraw===null&&(L.nextDraw=X.window.requestAnimationFrame(L._draw)),t},cancelFrame(r){r!=null&&L.frames.remove(r)},clearTimeout(r){r!=null&&L.timeouts.remove(r)},cancelImmediate(r){r!=null&&L.immediates.remove(r)},_draw(r){let t=null,e=L.timeouts.last();for(;(t=L.timeouts.shift())&&(r>=t.time?t.run():L.timeouts.push(t),t!==e););let s=null,n=L.frames.last();for(;s!==n&&(s=L.frames.shift());)s.run(r);let i=null;for(;i=L.immediates.shift();)i();L.nextDraw=L.timeouts.first()||L.frames.first()?X.window.requestAnimationFrame(L._draw):null}},el=function(r){let t=r.start,e=r.runner.duration(),s=t+e;return{start:t,duration:e,end:s,runner:r.runner}},rl=function(){let r=X.window;return(r.performance||r.Date).now()},rs=class extends de{constructor(t=rl){super(),this._timeSource=t,this._startTime=0,this._speed=1,this._persist=0,this._nextFrame=null,this._paused=!0,this._runners=[],this._runnerIds=[],this._lastRunnerId=-1,this._time=0,this._lastSourceTime=0,this._lastStepTime=0,this._step=this._stepFn.bind(this,!1),this._stepImmediate=this._stepFn.bind(this,!0)}active(){return!!this._nextFrame}finish(){return this.time(this.getEndTimeOfTimeline()+1),this.pause()}getEndTime(){let t=this.getLastRunnerInfo(),e=t?t.runner.duration():0;return(t?t.start:this._time)+e}getEndTimeOfTimeline(){let t=this._runners.map(e=>e.start+e.runner.duration());return Math.max(0,...t)}getLastRunnerInfo(){return this.getRunnerInfoById(this._lastRunnerId)}getRunnerInfoById(t){return this._runners[this._runnerIds.indexOf(t)]||null}pause(){return this._paused=!0,this._continue()}persist(t){return t==null?this._persist:(this._persist=t,this)}play(){return this._paused=!1,this.updateTime()._continue()}reverse(t){let e=this.speed();if(t==null)return this.speed(-e);let s=Math.abs(e);return this.speed(t?-s:s)}schedule(t,e,s){if(t==null)return this._runners.map(el);let n=0,i=this.getEndTime();if(e=e||0,s==null||s==="last"||s==="after")n=i;else if(s==="absolute"||s==="start")n=e,e=0;else if(s==="now")n=this._time;else if(s==="relative"){let l=this.getRunnerInfoById(t.id);l&&(n=l.start+e,e=0)}else if(s==="with-last"){let l=this.getLastRunnerInfo();n=l?l.start:this._time}else throw new Error('Invalid value for the "when" parameter');t.unschedule(),t.timeline(this);let o=t.persist(),a={persist:o===null?this._persist:o,start:n+e,runner:t};return this._lastRunnerId=t.id,this._runners.push(a),this._runners.sort((l,g)=>l.start-g.start),this._runnerIds=this._runners.map(l=>l.runner.id),this.updateTime()._continue(),this}seek(t){return this.time(this._time+t)}source(t){return t==null?this._timeSource:(this._timeSource=t,this)}speed(t){return t==null?this._speed:(this._speed=t,this)}stop(){return this.time(0),this.pause()}time(t){return t==null?this._time:(this._time=t,this._continue(!0))}unschedule(t){let e=this._runnerIds.indexOf(t.id);return e<0?this:(this._runners.splice(e,1),this._runnerIds.splice(e,1),t.timeline(null),this)}updateTime(){return this.active()||(this._lastSourceTime=this._timeSource()),this}_continue(t=!1){return L.cancelFrame(this._nextFrame),this._nextFrame=null,t?this._stepImmediate():this._paused?this:(this._nextFrame=L.frame(this._step),this)}_stepFn(t=!1){let e=this._timeSource(),s=e-this._lastSourceTime;t&&(s=0);let n=this._speed*s+(this._time-this._lastStepTime);this._lastSourceTime=e,t||(this._time+=n,this._time=this._time<0?0:this._time),this._lastStepTime=this._time,this.fire("time",this._time);for(let o=this._runners.length;o--;){let a=this._runners[o],l=a.runner;this._time-a.start<=0&&l.reset()}let i=!1;for(let o=0,a=this._runners.length;o<a;o++){let l=this._runners[o],g=l.runner,v=n,d=this._time-l.start;if(d<=0){i=!0;continue}else d<v&&(v=d);if(!g.active())continue;g.step(v).done?l.persist!==!0&&g.duration()-g.time()+this._time+l.persist<this._time&&(g.unschedule(),--o,--a):i=!0}return i&&!(this._speed<0&&this._time===0)||this._runnerIds.length&&this._speed<0&&this._time>0?this._continue():(this.pause(),this.fire("finished")),this}};B({Element:{timeline:function(r){return r==null?(this._timeline=this._timeline||new rs,this._timeline):(this._timeline=r,this)}}});var It=class r extends de{constructor(t){super(),this.id=r.id++,t=t==null?vr.duration:t,t=typeof t=="function"?new Ve(t):t,this._element=null,this._timeline=null,this.done=!1,this._queue=[],this._duration=typeof t=="number"&&t,this._isDeclarative=t instanceof Ve,this._stepper=this._isDeclarative?t:new ur,this._history={},this.enabled=!0,this._time=0,this._lastTime=0,this._reseted=!0,this.transforms=new z,this.transformId=1,this._haveReversed=!1,this._reverse=!1,this._loopsDone=0,this._swing=!1,this._wait=0,this._times=1,this._frameId=null,this._persist=this._isDeclarative?!0:null}static sanitise(t,e,s){let n=1,i=!1,o=0;return t=t||vr.duration,e=e||vr.delay,s=s||"last",typeof t=="object"&&!(t instanceof mr)&&(e=t.delay||e,s=t.when||s,i=t.swing||i,n=t.times||n,o=t.wait||o,t=t.duration||vr.duration),{duration:t,delay:e,swing:i,times:n,wait:o,when:s}}active(t){return t==null?this.enabled:(this.enabled=t,this)}addTransform(t,e){return this.transforms.lmultiplyO(t),this}after(t){return this.on("finished",t)}animate(t,e,s){let n=r.sanitise(t,e,s),i=new r(n.duration);return this._timeline&&i.timeline(this._timeline),this._element&&i.element(this._element),i.loop(n).schedule(n.delay,n.when)}clearTransform(){return this.transforms=new z,this}clearTransformsFromQueue(){(!this.done||!this._timeline||!this._timeline._runnerIds.includes(this.id))&&(this._queue=this._queue.filter(t=>!t.isTransform))}delay(t){return this.animate(0,t)}duration(){return this._times*(this._wait+this._duration)-this._wait}during(t){return this.queue(null,t)}ease(t){return this._stepper=new ur(t),this}element(t){return t==null?this._element:(this._element=t,t._prepareRunner(),this)}finish(){return this.step(1/0)}loop(t,e,s){return typeof t=="object"&&(e=t.swing,s=t.wait,t=t.times),this._times=t||1/0,this._swing=e||!1,this._wait=s||0,this._times===!0&&(this._times=1/0),this}loops(t){let e=this._duration+this._wait;if(t==null){let o=Math.floor(this._time/e),l=(this._time-o*e)/this._duration;return Math.min(o+l,this._times)}let s=Math.floor(t),n=t%1,i=e*s+this._duration*n;return this.time(i)}persist(t){return t==null?this._persist:(this._persist=t,this)}position(t){let e=this._time,s=this._duration,n=this._wait,i=this._times,o=this._swing,a=this._reverse,l;if(t==null){let p=function(m){let f=o*Math.floor(m%(2*(n+s))/(n+s)),b=f&&!a||!f&&a,x=Math.pow(-1,b)*(m%(n+s))/s+b;return Math.max(Math.min(x,1),0)},u=i*(n+s)-n;return l=e<=0?Math.round(p(1e-5)):e<u?p(e):Math.round(p(u-1e-5)),l}let g=Math.floor(this.loops()),v=o&&g%2===0;return l=g+(v&&!a||a&&v?t:1-t),this.loops(l)}progress(t){return t==null?Math.min(1,this._time/this.duration()):this.time(t*this.duration())}queue(t,e,s,n){return this._queue.push({initialiser:t||zn,runner:e||zn,retarget:s,isTransform:n,initialised:!1,finished:!1}),this.timeline()&&this.timeline()._continue(),this}reset(){return this._reseted?this:(this.time(0),this._reseted=!0,this)}reverse(t){return this._reverse=t==null?!this._reverse:t,this}schedule(t,e,s){if(t instanceof rs||(s=e,e=t,t=this.timeline()),!t)throw Error("Runner cannot be scheduled without timeline");return t.schedule(this,e,s),this}step(t){if(!this.enabled)return this;t=t==null?16:t,this._time+=t;let e=this.position(),s=this._lastPosition!==e&&this._time>=0;this._lastPosition=e;let n=this.duration(),i=this._lastTime<=0&&this._time>0,o=this._lastTime<n&&this._time>=n;this._lastTime=this._time,i&&this.fire("start",this);let a=this._isDeclarative;this.done=!a&&!o&&this._time>=n,this._reseted=!1;let l=!1;return(s||a)&&(this._initialise(s),this.transforms=new z,l=this._run(a?t:e),this.fire("step",this)),this.done=this.done||l&&a,o&&this.fire("finished",this),this}time(t){if(t==null)return this._time;let e=t-this._time;return this.step(e),this}timeline(t){return typeof t=="undefined"?this._timeline:(this._timeline=t,this)}unschedule(){let t=this.timeline();return t&&t.unschedule(this),this}_initialise(t){if(!(!t&&!this._isDeclarative))for(let e=0,s=this._queue.length;e<s;++e){let n=this._queue[e],i=this._isDeclarative||!n.initialised&&t;t=!n.finished,i&&t&&(n.initialiser.call(this),n.initialised=!0)}}_rememberMorpher(t,e){if(this._history[t]={morpher:e,caller:this._queue[this._queue.length-1]},this._isDeclarative){let s=this.timeline();s&&s.play()}}_run(t){let e=!0;for(let s=0,n=this._queue.length;s<n;++s){let i=this._queue[s],o=i.runner.call(this,t);i.finished=i.finished||o===!0,e=e&&i.finished}return e}_tryRetarget(t,e,s){if(this._history[t]){if(!this._history[t].caller.initialised){let i=this._queue.indexOf(this._history[t].caller);return this._queue.splice(i,1),!1}this._history[t].caller.retarget?this._history[t].caller.retarget.call(this,e,s):this._history[t].morpher.to(e),this._history[t].caller.finished=!1;let n=this.timeline();return n&&n.play(),!0}return!1}};It.id=0;var Xe=class{constructor(t=new z,e=-1,s=!0){this.transforms=t,this.id=e,this.done=s}clearTransformsFromQueue(){}};O([It,Xe],{mergeWith(r){return new Xe(r.transforms.lmultiply(this.transforms),r.id)}});var ci=(r,t)=>r.lmultiplyO(t),di=r=>r.transforms;function sl(){let t=this._transformationRunners.runners.map(di).reduce(ci,new z);this.transform(t),this._transformationRunners.merge(),this._transformationRunners.length()===1&&(this._frameId=null)}var Ls=class{constructor(){this.runners=[],this.ids=[]}add(t){if(this.runners.includes(t))return;let e=t.id+1;return this.runners.push(t),this.ids.push(e),this}clearBefore(t){let e=this.ids.indexOf(t+1)||1;return this.ids.splice(0,e,0),this.runners.splice(0,e,new Xe).forEach(s=>s.clearTransformsFromQueue()),this}edit(t,e){let s=this.ids.indexOf(t+1);return this.ids.splice(s,1,t+1),this.runners.splice(s,1,e),this}getByID(t){return this.runners[this.ids.indexOf(t+1)]}length(){return this.ids.length}merge(){let t=null;for(let e=0;e<this.runners.length;++e){let s=this.runners[e];if(t&&s.done&&t.done&&(!s._timeline||!s._timeline._runnerIds.includes(s.id))&&(!t._timeline||!t._timeline._runnerIds.includes(t.id))){this.remove(s.id);let i=s.mergeWith(t);this.edit(t.id,i),t=i,--e}else t=s}return this}remove(t){let e=this.ids.indexOf(t+1);return this.ids.splice(e,1),this.runners.splice(e,1),this}};B({Element:{animate(r,t,e){let s=It.sanitise(r,t,e),n=this.timeline();return new It(s.duration).loop(s).element(this).timeline(n.play()).schedule(s.delay,s.when)},delay(r,t){return this.animate(0,r,t)},_clearTransformRunnersBefore(r){this._transformationRunners.clearBefore(r.id)},_currentTransform(r){return this._transformationRunners.runners.filter(t=>t.id<=r.id).map(di).reduce(ci,new z)},_addRunner(r){this._transformationRunners.add(r),L.cancelImmediate(this._frameId),this._frameId=L.immediate(sl.bind(this))},_prepareRunner(){this._frameId==null&&(this._transformationRunners=new Ls().add(new Xe(new z(this))))}}});var nl=(r,t)=>r.filter(e=>!t.includes(e));O(It,{attr(r,t){return this.styleAttr("attr",r,t)},css(r,t){return this.styleAttr("css",r,t)},styleAttr(r,t,e){if(typeof t=="string")return this.styleAttr(r,{[t]:e});let s=t;if(this._tryRetarget(r,s))return this;let n=new Wt(this._stepper).to(s),i=Object.keys(s);return this.queue(function(){n=n.from(this.element()[r](i))},function(o){return this.element()[r](n.at(o).valueOf()),n.done()},function(o){let a=Object.keys(o),l=nl(a,i);if(l.length){let v=this.element()[r](l),d=new he(n.from()).valueOf();Object.assign(d,v),n.from(d)}let g=new he(n.to()).valueOf();Object.assign(g,o),n.to(g),i=a,s=o}),this._rememberMorpher(r,n),this},zoom(r,t){if(this._tryRetarget("zoom",r,t))return this;let e=new Wt(this._stepper).to(new j(r));return this.queue(function(){e=e.from(this.element().zoom())},function(s){return this.element().zoom(e.at(s),t),e.done()},function(s,n){t=n,e.to(s)}),this._rememberMorpher("zoom",e),this},transform(r,t,e){if(t=r.relative||t,this._isDeclarative&&!t&&this._tryRetarget("transform",r))return this;let s=z.isMatrixLike(r);e=r.affine!=null?r.affine:e!=null?e:!s;let n=new Wt(this._stepper).type(e?hr:z),i,o,a,l,g;function v(){o=o||this.element(),i=i||ts(r,o),g=new z(t?void 0:o),o._addRunner(this),t||o._clearTransformRunnersBefore(this)}function d(u){t||this.clearTransform();let{x:m,y:f}=new K(i).transform(o._currentTransform(this)),b=new z({...r,origin:[m,f]}),x=this._isDeclarative&&a?a:g;if(e){b=b.decompose(m,f),x=x.decompose(m,f);let h=b.rotate,S=x.rotate,w=[h-360,h,h+360],_=w.map(E=>Math.abs(E-S)),T=Math.min(..._),D=_.indexOf(T);b.rotate=w[D]}t&&(s||(b.rotate=r.rotate||0),this._isDeclarative&&l&&(x.rotate=l)),n.from(x),n.to(b);let k=n.at(u);return l=k.rotate,a=new z(k),this.addTransform(a),o._addRunner(this),n.done()}function p(u){(u.origin||"center").toString()!==(r.origin||"center").toString()&&(i=ts(u,o)),r={...u,origin:i}}return this.queue(v,d,p,!0),this._isDeclarative&&this._rememberMorpher("transform",n),this},x(r,t){return this._queueNumber("x",r)},y(r){return this._queueNumber("y",r)},dx(r=0){return this._queueNumberDelta("x",r)},dy(r=0){return this._queueNumberDelta("y",r)},dmove(r,t){return this.dx(r).dy(t)},_queueNumberDelta(r,t){if(t=new j(t),this._tryRetarget(r,t))return this;let e=new Wt(this._stepper).to(t),s=null;return this.queue(function(){s=this.element()[r](),e.from(s),e.to(s+t)},function(n){return this.element()[r](e.at(n)),e.done()},function(n){e.to(s+new j(n))}),this._rememberMorpher(r,e),this},_queueObject(r,t){if(this._tryRetarget(r,t))return this;let e=new Wt(this._stepper).to(t);return this.queue(function(){e.from(this.element()[r]())},function(s){return this.element()[r](e.at(s)),e.done()}),this._rememberMorpher(r,e),this},_queueNumber(r,t){return this._queueObject(r,new j(t))},cx(r){return this._queueNumber("cx",r)},cy(r){return this._queueNumber("cy",r)},move(r,t){return this.x(r).y(t)},center(r,t){return this.cx(r).cy(t)},size(r,t){let e;return(!r||!t)&&(e=this._element.bbox()),r||(r=e.width/e.height*t),t||(t=e.height/e.width*r),this.width(r).height(t)},width(r){return this._queueNumber("width",r)},height(r){return this._queueNumber("height",r)},plot(r,t,e,s){if(arguments.length===4)return this.plot([r,t,e,s]);if(this._tryRetarget("plot",r))return this;let n=new Wt(this._stepper).type(this._element.MorphArray).to(r);return this.queue(function(){n.from(this._element.array())},function(i){return this._element.plot(n.at(i)),n.done()}),this._rememberMorpher("plot",n),this},leading(r){return this._queueNumber("leading",r)},viewbox(r,t,e,s){return this._queueObject("viewbox",new ut(r,t,e,s))},update(r){return typeof r!="object"?this.update({offset:arguments[0],color:arguments[1],opacity:arguments[2]}):(r.opacity!=null&&this.attr("stop-opacity",r.opacity),r.color!=null&&this.attr("stop-color",r.color),r.offset!=null&&this.attr("offset",r.offset),this)}});O(It,{rx:Ys,ry:Ps,from:ai,to:li});V(It,"Runner");var br=class extends at{constructor(t,e=t){super(H("svg",t),e),this.namespace()}defs(){return this.isRoot()?wt(this.node.querySelector("defs"))||this.put(new pe):this.root().defs()}isRoot(){return!this.node.parentNode||!(this.node.parentNode instanceof X.window.SVGElement)&&this.node.parentNode.nodeName!=="#document-fragment"}namespace(){return this.isRoot()?this.attr({xmlns:as,version:"1.1"}).attr("xmlns:xlink",He,gr).attr("xmlns:svgjs",Un,gr):this.root().namespace()}removeNamespace(){return this.attr({xmlns:null,version:null}).attr("xmlns:xlink",null,gr).attr("xmlns:svgjs",null,gr)}root(){return this.isRoot()?this:super.root()}};B({Container:{nested:U(function(){return this.put(new br)})}});V(br,"Svg",!0);var xr=class extends at{constructor(t,e=t){super(H("symbol",t),e)}};B({Container:{symbol:U(function(){return this.put(new xr)})}});V(xr,"Symbol");function il(r){return this._build===!1&&this.clear(),this.node.appendChild(X.document.createTextNode(r)),this}function ol(){return this.node.getComputedTextLength()}function al(r,t=this.bbox()){return r==null?t.x:this.attr("x",this.attr("x")+r-t.x)}function ll(r,t=this.bbox()){return r==null?t.y:this.attr("y",this.attr("y")+r-t.y)}function gl(r,t,e=this.bbox()){return this.x(r,e).y(t,e)}function vl(r,t=this.bbox()){return r==null?t.cx:this.attr("x",this.attr("x")+r-t.cx)}function cl(r,t=this.bbox()){return r==null?t.cy:this.attr("y",this.attr("y")+r-t.cy)}function dl(r,t,e=this.bbox()){return this.cx(r,e).cy(t,e)}function pl(r){return this.attr("x",r)}function ml(r){return this.attr("y",r)}function ul(r,t){return this.ax(r).ay(t)}function fl(r){return this._build=!!r,this}var pi={__proto__:null,plain:il,length:ol,x:al,y:ll,move:gl,cx:vl,cy:cl,center:dl,ax:pl,ay:ml,amove:ul,build:fl},bt=class extends dt{constructor(t,e=t){super(H("text",t),e),this.dom.leading=new j(1.3),this._rebuild=!0,this._build=!1}leading(t){return t==null?this.dom.leading:(this.dom.leading=new j(t),this.rebuild())}rebuild(t){if(typeof t=="boolean"&&(this._rebuild=t),this._rebuild){let e=this,s=0,n=this.dom.leading;this.each(function(i){let o=X.window.getComputedStyle(this.node).getPropertyValue("font-size"),a=n*new j(o);this.dom.newLined&&(this.attr("x",e.attr("x")),this.text()===`
`?s+=a:(this.attr("dy",i?a+s:0),s=0))}),this.fire("rebuild")}return this}setData(t){return this.dom=t,this.dom.leading=new j(t.leading||1.3),this}text(t){if(t===void 0){let e=this.node.childNodes,s=0;t="";for(let n=0,i=e.length;n<i;++n){if(e[n].nodeName==="textPath"){n===0&&(s=1);continue}n!==s&&e[n].nodeType!==3&&wt(e[n]).dom.newLined===!0&&(t+=`
`),t+=e[n].textContent}return t}if(this.clear().build(!0),typeof t=="function")t.call(this,this);else{t=(t+"").split(`
`);for(let e=0,s=t.length;e<s;e++)this.newLine(t[e])}return this.build(!1).rebuild()}};O(bt,pi);B({Container:{text:U(function(r=""){return this.put(new bt).text(r)}),plain:U(function(r=""){return this.put(new bt).plain(r)})}});V(bt,"Text");var Le=class extends dt{constructor(t,e=t){super(H("tspan",t),e),this._build=!1}dx(t){return this.attr("dx",t)}dy(t){return this.attr("dy",t)}newLine(){this.dom.newLined=!0;let t=this.parent();if(!(t instanceof bt))return this;let e=t.index(this),s=X.window.getComputedStyle(this.node).getPropertyValue("font-size"),n=t.dom.leading*new j(s);return this.dy(e?n:0).attr("x",t.x())}text(t){return t==null?this.node.textContent+(this.dom.newLined?`
`:""):(typeof t=="function"?(this.clear().build(!0),t.call(this,this),this.build(!1)):this.plain(t),this)}};O(Le,pi);B({Tspan:{tspan:U(function(r=""){let t=new Le;return this._build||this.clear(),this.put(t).text(r)})},Text:{newLine:function(r=""){return this.tspan(r).newLine()}}});V(Le,"Tspan");var yr=class extends dt{constructor(t,e=t){super(H("circle",t),e)}radius(t){return this.attr("r",t)}rx(t){return this.attr("r",t)}ry(t){return this.rx(t)}size(t){return this.radius(new j(t).divide(2))}};O(yr,{x:ei,y:ri,cx:si,cy:ni,width:ii,height:oi});B({Container:{circle:U(function(r=0){return this.put(new yr).size(r).move(0,0)})}});V(yr,"Circle");var wr=class extends at{constructor(t,e=t){super(H("clipPath",t),e)}remove(){return this.targets().forEach(function(t){t.unclip()}),super.remove()}targets(){return ne("svg [clip-path*="+this.id()+"]")}};B({Container:{clip:U(function(){return this.defs().put(new wr)})},Element:{clipper(){return this.reference("clip-path")},clipWith(r){let t=r instanceof wr?r:this.parent().clip().add(r);return this.attr("clip-path","url(#"+t.id()+")")},unclip(){return this.attr("clip-path",null)}}});V(wr,"ClipPath");var ss=class extends ot{constructor(t,e=t){super(H("foreignObject",t),e)}};B({Container:{foreignObject:U(function(r,t){return this.put(new ss).size(r,t)})}});V(ss,"ForeignObject");function hl(r,t){return this.children().forEach((e,s)=>{let n;try{n=e.bbox()}catch(l){return}let i=new z(e),o=i.translate(r,t).transform(i.inverse()),a=new K(n.x,n.y).transform(o);e.move(a.x,a.y)}),this}function bl(r){return this.dmove(r,0)}function xl(r){return this.dmove(0,r)}function yl(r,t=this.bbox()){return r==null?t.height:this.size(t.width,r,t)}function wl(r=0,t=0,e=this.bbox()){let s=r-e.x,n=t-e.y;return this.dmove(s,n)}function _l(r,t,e=this.bbox()){let s=ye(this,r,t,e),n=s.width/e.width,i=s.height/e.height;return this.children().forEach((o,a)=>{let l=new K(e).transform(new z(o).inverse());o.scale(n,i,l.x,l.y)}),this}function kl(r,t=this.bbox()){return r==null?t.width:this.size(r,t.height,t)}function Al(r,t=this.bbox()){return r==null?t.x:this.move(r,t.y,t)}function Il(r,t=this.bbox()){return r==null?t.y:this.move(t.x,r,t)}var mi={__proto__:null,dmove:hl,dx:bl,dy:xl,height:yl,move:wl,size:_l,width:kl,x:Al,y:Il},_r=class extends at{constructor(t,e=t){super(H("g",t),e)}};O(_r,mi);B({Container:{group:U(function(){return this.put(new _r)})}});V(_r,"G");var Ue=class extends at{constructor(t,e=t){super(H("a",t),e)}target(t){return this.attr("target",t)}to(t){return this.attr("href",t,He)}};O(Ue,mi);B({Container:{link:U(function(r){return this.put(new Ue).to(r)})},Element:{unlink(){let r=this.linker();if(!r)return this;let t=r.parent();if(!t)return this.remove();let e=t.index(r);return t.add(this,e),r.remove(),this},linkTo(r){let t=this.linker();return t||(t=new Ue,this.wrap(t)),typeof r=="function"?r.call(t,t):t.to(r),this},linker(){let r=this.parent();return r&&r.node.nodeName.toLowerCase()==="a"?r:null}}});V(Ue,"A");var kr=class extends at{constructor(t,e=t){super(H("mask",t),e)}remove(){return this.targets().forEach(function(t){t.unmask()}),super.remove()}targets(){return ne("svg [mask*="+this.id()+"]")}};B({Container:{mask:U(function(){return this.defs().put(new kr)})},Element:{masker(){return this.reference("mask")},maskWith(r){let t=r instanceof kr?r:this.parent().mask().add(r);return this.attr("mask","url(#"+t.id()+")")},unmask(){return this.attr("mask",null)}}});V(kr,"Mask");var ns=class extends ot{constructor(t,e=t){super(H("stop",t),e)}update(t){return(typeof t=="number"||t instanceof j)&&(t={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),t.opacity!=null&&this.attr("stop-opacity",t.opacity),t.color!=null&&this.attr("stop-color",t.color),t.offset!=null&&this.attr("offset",new j(t.offset)),this}};B({Gradient:{stop:function(r,t,e){return this.put(new ns).update(r,t,e)}}});V(ns,"Stop");function Cl(r,t){if(!r)return"";if(!t)return r;let e=r+"{";for(let s in t)e+=Xn(s)+":"+t[s]+";";return e+="}",e}var Ar=class extends ot{constructor(t,e=t){super(H("style",t),e)}addText(t=""){return this.node.textContent+=t,this}font(t,e,s={}){return this.rule("@font-face",{fontFamily:t,src:e,...s})}rule(t,e){return this.addText(Cl(t,e))}};B("Dom",{style(r,t){return this.put(new Ar).rule(r,t)},fontface(r,t,e){return this.put(new Ar).font(r,t,e)}});V(Ar,"Style");var Ir=class extends bt{constructor(t,e=t){super(H("textPath",t),e)}array(){let t=this.track();return t?t.array():null}plot(t){let e=this.track(),s=null;return e&&(s=e.plot(t)),t==null?s:this}track(){return this.reference("href")}};B({Container:{textPath:U(function(r,t){return r instanceof bt||(r=this.text(r)),r.path(t)})},Text:{path:U(function(r,t=!0){let e=new Ir;r instanceof se||(r=this.defs().path(r)),e.attr("href","#"+r,He);let s;if(t)for(;s=this.node.firstChild;)e.node.appendChild(s);return this.put(e)}),textPath(){return this.findOne("textPath")}},Path:{text:U(function(r){return r instanceof bt||(r=new bt().addTo(this.parent()).text(r)),r.path(this)}),targets(){return ne("svg textPath").filter(r=>(r.attr("href")||"").includes(this.id()))}}});Ir.prototype.MorphArray=Lt;V(Ir,"TextPath");var is=class extends dt{constructor(t,e=t){super(H("use",t),e)}use(t,e){return this.attr("href",(e||"")+"#"+t,He)}};B({Container:{use:U(function(r,t){return this.put(new is).use(r,t)})}});V(is,"Use");var Tr=ct;O([br,xr,$e,ue,je],ft("viewbox"));O([fe,xe,be,se],ft("marker"));O(bt,ft("Text"));O(se,ft("Path"));O(pe,ft("Defs"));O([bt,Le],ft("Tspan"));O([We,ze,me,It],ft("radius"));O(de,ft("EventTarget"));O(re,ft("Dom"));O(ot,ft("Element"));O(dt,ft("Shape"));O([at,es],ft("Container"));O(me,ft("Gradient"));O(It,ft("Runner"));Xt.extend(Io());Qa([j,_t,ut,z,Et,Ot,Lt,K]);Ya();var Z=class extends ot{constructor(t){super(H("filter",t),t),this.$source="SourceGraphic",this.$sourceAlpha="SourceAlpha",this.$background="BackgroundImage",this.$backgroundAlpha="BackgroundAlpha",this.$fill="FillPaint",this.$stroke="StrokePaint",this.$autoSetIn=!0}put(t,e){return t=super.put(t,e),!t.attr("in")&&this.$autoSetIn&&t.attr("in",this.$source),t.attr("result")||t.attr("result",t.id()),t}remove(){return this.targets().each("unfilter"),super.remove()}targets(){return ne('svg [filter*="'+this.id()+'"]')}toString(){return"url(#"+this.id()+")"}},Fr=class extends ot{constructor(t,e){super(t,e),this.result(this.id())}in(t){if(t==null){let e=this.attr("in");return this.parent()&&this.parent().find(`[result="${e}"]`)[0]||e}return this.attr("in",t)}result(t){return this.attr("result",t)}toString(){return this.result()}},kt=r=>function(...t){for(let e=r.length;e--;)t[e]!=null&&this.attr(r[e],t[e])},Tl={blend:kt(["in","in2","mode"]),colorMatrix:kt(["type","values"]),composite:kt(["in","in2","operator"]),convolveMatrix:function(r){r=new Et(r).toString(),this.attr({order:Math.sqrt(r.split(" ").length),kernelMatrix:r})},diffuseLighting:kt(["surfaceScale","lightingColor","diffuseConstant","kernelUnitLength"]),displacementMap:kt(["in","in2","scale","xChannelSelector","yChannelSelector"]),dropShadow:kt(["in","dx","dy","stdDeviation"]),flood:kt(["flood-color","flood-opacity"]),gaussianBlur:function(r=0,t=r){this.attr("stdDeviation",r+" "+t)},image:function(r){this.attr("href",r,Hn.xlink)},morphology:kt(["operator","radius"]),offset:kt(["dx","dy"]),specularLighting:kt(["surfaceScale","lightingColor","diffuseConstant","specularExponent","kernelUnitLength"]),tile:kt([]),turbulence:kt(["baseFrequency","numOctaves","seed","stitchTiles","type"])},Fl=["blend","colorMatrix","componentTransfer","composite","convolveMatrix","diffuseLighting","displacementMap","dropShadow","flood","gaussianBlur","image","merge","morphology","offset","specularLighting","tile","turbulence"];Fl.forEach(r=>{let t=Cr.capitalize(r),e=Tl[r];Z[t+"Effect"]=class extends Fr{constructor(s){super(H("fe"+t,s),s)}update(s){return e.apply(this,s),this}},Z.prototype[r]=U(function(s,...n){let i=new Z[t+"Effect"];return s==null?this.put(i):(typeof s=="function"?s.call(i,i):n.unshift(s),this.put(i).update(n))})});O(Z,{merge(r){let t=this.put(new Z.MergeEffect);return typeof r=="function"?(r.call(t,t),t):((r instanceof Array?r:[...arguments]).forEach(s=>{s instanceof Z.MergeNode?t.put(s):t.mergeNode(s)}),t)},componentTransfer(r={}){let t=this.put(new Z.ComponentTransferEffect);if(typeof r=="function")return r.call(t,t),t;if(!r.r&&!r.g&&!r.b&&!r.a){let e=r;r={r:e,g:e,b:e,a:e}}for(let e in r)t.add(new Z["Func"+e.toUpperCase()](r[e]));return t}});var Sl=["distantLight","pointLight","spotLight","mergeNode","FuncR","FuncG","FuncB","FuncA"];Sl.forEach(r=>{let t=Cr.capitalize(r);Z[t]=class extends Fr{constructor(e){super(H("fe"+t,e),e)}}});var Rl=["funcR","funcG","funcB","funcA"];Rl.forEach(function(r){let t=Z[Cr.capitalize(r)],e=U(function(){return this.put(new t)});Z.ComponentTransferEffect.prototype[r]=e});var El=["distantLight","pointLight","spotLight"];El.forEach(r=>{let t=Z[Cr.capitalize(r)],e=U(function(){return this.put(new t)});Z.DiffuseLightingEffect.prototype[r]=e,Z.SpecularLightingEffect.prototype[r]=e});O(Z.MergeEffect,{mergeNode(r){return this.put(new Z.MergeNode).attr("in",r)}});O(pe,{filter:function(r){let t=this.put(new Z);return typeof r=="function"&&r.call(t,t),t}});O(at,{filter:function(r){return this.defs().filter(r)}});O(ot,{filterWith:function(r){let t=r instanceof Z?r:this.defs().filter(r);return this.attr("filter",t)},unfilter:function(r){return this.attr("filter",null)},filterer(){return this.reference("filter")}});var Ol={blend:function(r,t){return this.parent()&&this.parent().blend(this,r,t)},colorMatrix:function(r,t){return this.parent()&&this.parent().colorMatrix(r,t).in(this)},componentTransfer:function(r){return this.parent()&&this.parent().componentTransfer(r).in(this)},composite:function(r,t){return this.parent()&&this.parent().composite(this,r,t)},convolveMatrix:function(r){return this.parent()&&this.parent().convolveMatrix(r).in(this)},diffuseLighting:function(r,t,e,s){return this.parent()&&this.parent().diffuseLighting(r,e,s).in(this)},displacementMap:function(r,t,e,s){return this.parent()&&this.parent().displacementMap(this,r,t,e,s)},dropShadow:function(r,t,e){return this.parent()&&this.parent().dropShadow(this,r,t,e).in(this)},flood:function(r,t){return this.parent()&&this.parent().flood(r,t)},gaussianBlur:function(r,t){return this.parent()&&this.parent().gaussianBlur(r,t).in(this)},image:function(r){return this.parent()&&this.parent().image(r)},merge:function(r){return r=r instanceof Array?r:[...r],this.parent()&&this.parent().merge(this,...r)},morphology:function(r,t){return this.parent()&&this.parent().morphology(r,t).in(this)},offset:function(r,t){return this.parent()&&this.parent().offset(r,t).in(this)},specularLighting:function(r,t,e,s,n){return this.parent()&&this.parent().specularLighting(r,e,s,n).in(this)},tile:function(){return this.parent()&&this.parent().tile().in(this)},turbulence:function(r,t,e,s,n){return this.parent()&&this.parent().turbulence(r,t,e,s,n).in(this)}};O(Fr,Ol);O(Z.MergeEffect,{in:function(r){return r instanceof Z.MergeNode?this.add(r,0):this.add(new Z.MergeNode().in(r),0),this}});O([Z.CompositeEffect,Z.BlendEffect,Z.DisplacementMapEffect],{in2:function(r){if(r==null){let t=this.attr("in2");return this.parent()&&this.parent().find(`[result="${t}"]`)[0]||t}return this.attr("in2",r)}});Z.filter={sepiatone:[.343,.669,.119,0,0,.249,.626,.13,0,0,.172,.334,.111,0,0,0,0,0,1,0]};var Dt=class{constructor(t){t&&(this.document=t.document,this.layer=t.layer,this.vid=t.vid,this.color=t.color,this.label=t.label,this.comments=t.comments,this.arguments=t.arguments,this.hideScore=t.hideScore)}};var Ct=class{constructor(t){t&&(this.document=t.document,this.layer=t.layer,this.vid=t.vid,this.offsets=t.offsets,this.color=t.color,this.label=t.label,this.comments=t.comments,this.clippingFlags=t.clippingFlags,this.hideScore=t.hideScore)}};var fi="i7n-annotation-over",Tt=class extends Event{constructor(t,e){super(fi,{bubbles:!0}),this.originalEvent=e,this.annotation=t}};Tt.eventType=fi;var hi="i7n-annotation-out",Gt=class extends Event{constructor(t,e){super(hi,{bubbles:!0}),this.originalEvent=e,this.annotation=t}};Gt.eventType=hi;function Sr(r,t){let e=document.createRange();if(document.caretPositionFromPoint){let s=document.caretPositionFromPoint(r,t);if(!s)return console.error(`Unable to determine caret position from point: ${r},${t}`),null;e.setEnd(s.offsetNode,s.offset)}else if(document.caretRangeFromPoint){let s=document.caretRangeFromPoint(r,t);if(!s)return null;e.setEnd(s.startContainer,s.startOffset)}else return null;return e.collapse(),e}function $l(r){$.each(["attributes","comments","entities","equivs","events","relations","triggers"],(t,e)=>{r[e]===void 0&&(r[e]=[])}),r.text===void 0&&(r.text=""),r.sentence_offsets===void 0&&(r.sentence_offsets=Ll(r.text)),r.token_offsets===void 0&&(r.token_offsets=Xl(r.text))}function jl(r){let t=["entity_attribute_types","entity_types","event_attribute_types","event_types","relation_attribute_types","relation_types"];for(let e of t)r[e]===void 0&&(r[e]=[])}var Ze=class{constructor(t,e){c(this,"dispatcher");c(this,"rtlmode",!1);c(this,"fontZoom",100);c(this,"svg");c(this,"svgContainer");c(this,"highlightGroup");c(this,"baseCanvasWidth",0);c(this,"canvasWidth",0);c(this,"data");c(this,"sourceData");c(this,"requestedData",null);c(this,"args",{});c(this,"selectionInProgress",!1);c(this,"dataChangedButNotRendered",!1);c(this,"isRenderRequested",!1);c(this,"drawing",!1);c(this,"redraw",!1);c(this,"entityTypes",{});c(this,"relationTypes",{});c(this,"entityAttributeTypes",{});c(this,"eventAttributeTypes",{});c(this,"isCollectionLoaded",!1);c(this,"markedText",[]);c(this,"highlight",[]);c(this,"highlightArcs");c(this,"collapseArcs",!1);c(this,"collapseArcSpace",!1);c(this,"roundCoordinates",!0);c(this,"boxTextMargin",{x:0,y:1.5});c(this,"highlightRounding",{x:3,y:3});c(this,"spaceWidths",{" ":4,"\xA0":4,"\u200B":0,"\u3000":8,"	":12,"\n":4});c(this,"coloredCurlies",!0);c(this,"arcSlant",15);c(this,"minArcSlant",8);c(this,"arcHorizontalSpacing",10);c(this,"rowSpacing",-5);c(this,"sentNumMargin",40);c(this,"smoothArcCurves",!0);c(this,"smoothArcSteepness",.5);c(this,"reverseArcControlx",5);c(this,"rectShadowSize",3);c(this,"rectShadowRounding",2.5);c(this,"arcLabelShadowSize",1);c(this,"arcLabelShadowRounding",5);c(this,"shadowStroke",2.5);c(this,"markedSpanSize",6);c(this,"markedArcSize",2);c(this,"markedArcStroke",7);c(this,"rowPadding",2);c(this,"nestingAdjustYStepSize",2);c(this,"nestingAdjustXStepSize",1);c(this,"shadowClassPattern","True_positive|False_positive|False_negative|AnnotationError|AnnotationWarning|AnnotatorNotes|Normalized|AnnotationIncomplete|AnnotationUnconfirmed|rectEditHighlight|EditHighlight_arc|MissingAnnotation|ChangedAnnotation");c(this,"highlightSpanSequence");c(this,"highlightArcSequence");c(this,"highlightTextSequence");c(this,"highlightMatchSequence","#FFFF00");c(this,"fragmentConnectorDashArray","1,3,3,3");c(this,"fragmentConnectorColor","#000000");c(this,"commentPrioLevels",["Unconfirmed","Incomplete","Warning","Error","AnnotatorNotes","AddedAnnotation","MissingAnnotation","ChangedAnnotation"]);c(this,"renderErrors",{unableToReadTextFile:!0,annotationFileNotFound:!0,isDirectoryError:!0});console.debug("Setting up brat visualizer module..."),this.dispatcher=t;let s=document.getElementById(e);if(!s)throw Error('Could not find container with id="'+e+'"');this.svgContainer=s;let n="#FF9632;#FFCC00;#FF9632";this.highlightSpanSequence=n,this.highlightArcSequence=n,this.highlightTextSequence=n,this.svgContainer.style.visibility="hidden",this.svg=Tr().addTo(this.svgContainer),this.triggerRender(),this.registerHandlers(this.svgContainer,["mouseover","mouseout","mousemove","mouseup","mousedown","dragstart","dblclick","click","contextmenu"]),this.registerHandlers(document,["keydown","keypress","touchstart","touchend"]),this.registerHandlers(window,["resize"]),this.dispatcher.on("collectionChanged",this,this.collectionChanged).on("collectionLoaded",this,this.collectionLoaded).on("renderData",this,this.renderData).on("rerender",this,this.rerender).on("renderDataPatch",this,this.renderDataPatch).on("triggerRender",this,this.triggerRender).on("requestRenderData",this,this.requestRenderData).on("isReloadOkay",this,this.isReloadOkay).on("resetData",this,this.resetData).on("abbrevs",this,this.setAbbrevs).on("textBackgrounds",this,this.setTextBackgrounds).on("layoutDensity",this,this.setLayoutDensity).on("svgWidth",this,this.setSvgWidth).on("loadAnnotations",this,this.loadAnnotations).on("mouseover",this,this.onMouseOver).on("mouseout",this,this.onMouseOut).on("selectionStarted",this,this.onSelectionStarted).on("selectionEnded",this,this.onSelectionEnded)}scrollTo(t){var n,i,o,a;let e=this.getChunkAtOffset(t.offset-(((n=this.sourceData)==null?void 0:n.windowBegin)||0));if(!e){console.warn("Could not find chunk at offset",t.offset);return}let s=this.getChunkElementWithId(e.index);if(s){s.scrollIntoView({behavior:"smooth",block:"center"}),this.svg.node.querySelectorAll(".ping").forEach(g=>g.remove());let l=this.svg.rect((i=this.data)==null?void 0:i.sizes.texts.widths[e.text],(o=this.data)==null?void 0:o.sizes.texts.height).addClass("ping").move(e.textX,e.row.textY+(((a=this.data)==null?void 0:a.sizes.texts.y)||0)).addTo(this.highlightGroup);l.animate(5e3,0,"now").attr({opacity:0}).after(()=>l.remove())}}commentPriority(t){if(t===void 0)return-1;let e=this.commentPrioLevels.length;for(let s=0;s<e;s++)if(t.indexOf(this.commentPrioLevels[s])!==-1)return s;return 0}setMarked(t,e,s){if(this.args[s])for(let n of this.args[s]){if(n[0]==="sent"){t.markedSent[n[1]]=!0;continue}if(n[0]==="equiv"){for(let a of e.equivs)if(a[1]===n[1]){let l=a.length;for(let g=2;g<l;g++)if(a[g]===n[2]){l-=3;for(let v=1;v<=l;v++){let d=t.eventDescs[a[0]+"*"+v].equivArc;d.marked=s}continue}}continue}if(n.length===2){this.markedText.push([parseInt(n[0],10),parseInt(n[1],10),s]);continue}let i=this.data.spans[n[0]];if(i){n.length===3?$.each(i.outgoing,(a,l)=>{l.target===n[2]&&l.type===n[1]&&(l.marked=s)}):i.marked=s;continue}let o=this.data.eventDescs[n[0]];if(o){for(let a of this.data.spans[o.triggerId].outgoing)a.eventDescId===n[0]&&(a.marked=s);continue}for(let a of Object.values(this.data.eventDescs))a.triggerId===n[0]&&(this.data.spans[a.id].marked=s)}}findArcHeight(t,e,s){let n=0;for(let i=t;i<=e;i++)s[i]>n&&(n=s[i]);return n+=y.visual.arcSpacing*(this.fontZoom/50),n}adjustFragmentHeights(t,e,s,n){for(let i=t;i<=e;i++)s[i]<n&&(s[i]=n)}applyHighlighting(t,e){this.markedText=[],this.setMarked(t,e,Tn),this.setMarked(t,e,Fn),this.setMarked(t,e,Sn),this.setMarked(t,e,Rn)}calculateAverageArcDistances(t){for(let e of t)e.avgDist=e.numArcs?e.totalDist/e.numArcs:0}collectFragmentTextsIntoSpanTexts(t){for(let e of t){let s=[];for(let n of e.fragments||[])s.push(n.text);e.text=s.join("")}}determineDrawOrder(t){let e=Object.keys(t);return e.sort((s,n)=>{let i=t[s],o=t[n],a=i.headFragment.drawOrder-o.headFragment.drawOrder;return a?a<0?-1:1:0}),e}organizeFragmentsIntoTowers(t){let e,s=-1;for(let n of t)(!e||e.from!==n.from||e.to!==n.to)&&s++,n.towerId=s,e=n}applyMarkedTextToChunks(t,e){let s=e.length,n=0,i;$.each(t,(o,a)=>{let l=a[0],g=a[1],v=a[2];for(l<0&&(l=0),g<0&&(g=0),g>=this.data.text.length&&(g=this.data.text.length-1),l>g&&(l=g);n<s;){let d=e[n];if(l<=d.to){d.markedTextStart.push([o,!0,l-d.from,null,v]);break}n++}if(n===s){this.dispatcher.post("messages",[[["Wrong text offset","error"]]]);return}for(i=n;i<s;){let d=e[i];if(g<=d.to){d.markedTextEnd.push([o,!1,g-d.from]);break}i++}if(i===s){this.dispatcher.post("messages",[[["Wrong text offset","error"]]]);let d=e[e.length-1];d.markedTextEnd.push([o,!1,d.text.length])}})}buildSpansFromEntities(t,e){if(!e)return{};let s={};for(let n of e){let i=n[0],o=n[1],a=n[2],l=new Re(i,o,a,Cn);if(n[3]){let g=n[3];Object.prototype.hasOwnProperty.call(g,"l")&&(l.labelText=g.l),Object.prototype.hasOwnProperty.call(g,"c")&&(l.color=g.c),Object.prototype.hasOwnProperty.call(g,"h")&&(l.hovertext=g.h),Object.prototype.hasOwnProperty.call(g,"a")&&(l.actionButtons=!!g.a),Object.prototype.hasOwnProperty.call(g,"cl")&&g.cl&&(l.clippedAtStart=g.cl.startsWith("s"),l.clippedAtEnd=g.cl.endsWith("e"))}l.splitMultilineOffsets(t),s[i]=l}return s}buildSpansFromTriggers(t){if(!t||!this.data)return{};let e={};for(let s of t){let n=new Re(s[0],s[1],s[2],In);n.splitMultilineOffsets(this.data.text),e[s[0]]=[n,[]]}return e}buildEventDescsFromTriggers(t,e,s){if(s)for(let n of e.events){let i=n[0],o=n[1],a=n[2],l=t.eventDescs[i]=new Ee(i,o,a),g=s[l.triggerId],v=g[0].copy(l.id);g[1].push(v),t.spans[l.id]=v}}splitSpansIntoFragments(t){t&&t.map(e=>e.buildFragments())}buildEventDescsFromEquivs(t,e,s){t&&$.each(t,(n,i)=>{i[0]="*"+n;let o=i.slice(2),a=[];for(let g of o)e[g]&&a.push(g);a.sort((g,v)=>Re.compare(e,g,v));let l=a.length;for(let g=1;g<l;g++){let v=a[g-1],d=a[g-1],p=[[parseInt(i[1]),a[g]]],u=s[i[0]+"*"+g]=new Ee(v,d,p,Ts);u.leftSpans=a.slice(0,g),u.rightSpans=a.slice(g)}})}buildEventDescsFromRelations(t,e){if(t)for(let s of t){let n=this.relationTypes[s[1]];n=n&&n.args;let i,o;if(n){let a={};a[s[2][0][0]]=s[2][0][1],a[s[2][1][0]]=s[2][1][1],i=a[n[0].role],o=a[n[1].role]}else i=s[2][0][1],o=s[2][1][1];e[s[0]]=new Ee(i,i,[[s[1],o]],Fs),s[3]&&(e[s[0]].labelText=s[3]),s[4]&&(e[s[0]].color=s[4])}}assignAttributesToSpans(t,e){if(t)for(let s of t){let n=s[0],i=s[1],o=s[2],a=s[3],l=this.eventAttributeTypes[i]||this.entityAttributeTypes[i],g=l&&l.values[l.bool||a],v=e[o];if(!v){this.dispatcher.post("messages",[[["Annotation "+o+", referenced from attribute "+n+", does not exist.","error"]]]);continue}let d=g&&g.name||a,p=l?l.bool?l.name:l.name+": "+d:a?i:i+": "+a;v.attributeText.push(p),v.attributes[i]=a,Object.assign(v.attributeMerge,g)}}assignComments(t,e,s){if(e)for(let n of e){if(n[0]instanceof Array&&n[0][0]==="sent"){let l=n[0][1],g=n[0][2],v=n[2];t.sentComment[l]&&(v=t.sentComment[l].text+"<br/>"+v),t.sentComment[l]={id:g,type:n[1],text:v};continue}let i=n[0],o=s[i],a=o?o[1]:i in t.spans?[t.spans[i]]:i in t.eventDescs?[t.eventDescs[i]]:[];for(let l of a)l.comment?(l.comment.type=n[1],l.comment.text+=`
`+n[2]):l.comment={type:n[1],text:n[2]},n[1]==="AnnotatorNotes"&&(l.annotatorNotes=n[2]),this.commentPriority(n[1])>this.commentPriority(l.shadowClass)&&(l.shadowClass=n[1])}}buildSortedFragments(t){if(!t)return[];let e=[];return Object.values(t).map(s=>s.fragments.map(n=>e.push(n))),e.sort(function(s,n){let i=s.from,o=n.from;return i===o&&(i=s.to,o=n.to),i<o?-1:i>o?1:0}),e}buildChunksFromTokenOffsets(t,e,s){if(!e)return[];let n=0,i=0,o=s.length,a=0,l=null,g=0,v,d,p=[];return e.forEach(u=>{let m=u[0],f=u[1];if(l===null&&(l=m),i&&f>s[i-1].to)for(;i<o&&f>s[i].from;)i++;for(n=i;n<o&&f>=s[n].to;)n++;if(n<o&&f>s[n].from)return;v=t.text.substring(a,l);let b=t.text.substring(l,f);d&&(d.nextSpace=v),d=new Xr(g++,b,l,f,v),d.lastSpace=v,p.push(d),a=f,l=null}),p}assignSentenceNumbersToChunks(t,e,s){if(!e)return;let n=s.length,i=0,o=t;for(let a of e){let l=a[0],g=a[1],v;for(;i<n&&(v=s[i]).from<l;)i++;if(i>=n)break;if(s[i].from>=g){o++;continue}o++,v&&(v.sentence=o),i++}}assignFragmentsToChunks(t,e){if(!e)return;let s=0,n;for(let i of e){for(;i.to>(n=t[s]).to;)s++;n.fragments.push(i),i.text=n.text.substring(i.from-n.from,i.to-n.from),i.chunk=n}}assignArcsToSpans(t,e,s){if(!e||!s)return[];let n=[];for(let[i,o]of Object.entries(e)){let a=s[o.id];if(!a){this.dispatcher.post("messages",[[['<strong>ERROR</strong><br/>Trigger for event "'+o.id+'" not found <br/>(please correct the source data)',"error",5]]]);continue}let l=a.headFragment.from+a.headFragment.to;for(let g of o.roles){let v=s[g.targetId];if(!v){this.dispatcher.post("messages",[[['<strong>ERROR</strong><br/>"'+g.targetId+'" (referenced from "'+o.id+'") not found <br/>(please correct the source data)',"error",5]]]);continue}let d=v.headFragment.from+v.headFragment.to,p=Math.abs(l-d),u=new Lr(o,g,p,i);a.totalDist+=p,a.numArcs++,a.outgoing.push(u),v.totalDist+=p,v.numArcs++,v.incoming.push(u),n.push(u),t.arcById[u.eventDescId]=u}}return n}setData(t){var n;this.sourceData=t,this.rtlmode=this.sourceData.rtl_mode,this.fontZoom=this.sourceData.font_zoom,this.args=(n=this.sourceData.args)!=null?n:{},this.dispatcher.post("newSourceData",[this.sourceData]),this.data=new Wr(this.sourceData.text),this.data.spans=this.buildSpansFromEntities(this.data.text,this.sourceData.entities);let e=this.buildSpansFromTriggers(this.sourceData.triggers);this.buildEventDescsFromTriggers(this.data,this.sourceData,e),this.splitSpansIntoFragments(Object.values(this.data.spans)),this.buildEventDescsFromEquivs(this.sourceData.equivs,this.data.spans,this.data.eventDescs),this.buildEventDescsFromRelations(this.sourceData.relations,this.data.eventDescs),this.assignAttributesToSpans(this.sourceData.attributes,this.data.spans),this.assignComments(this.data,this.sourceData.comments,e);let s=this.buildSortedFragments(this.data.spans);this.data.chunks=this.buildChunksFromTokenOffsets(this.data,this.sourceData.token_offsets,s),this.assignSentenceNumbersToChunks(this.sourceData.sentence_number_offset-1,this.sourceData.sentence_offsets,this.data.chunks),this.assignFragmentsToChunks(this.data.chunks,s),this.data.arcs=this.assignArcsToSpans(this.data,this.data.eventDescs,this.data.spans),this.applyHighlighting(this.data,this.sourceData),this.data.spans&&(this.calculateAverageArcDistances(Object.values(this.data.spans)),this.collectFragmentTextsIntoSpanTexts(Object.values(this.data.spans))),this.calculateFragmentDrawingOrder(this.data,s),this.dispatcher.post("dataReady",[this.data])}renderText(t){let e={};for(let s of t.chunks){s.markedTextStart=[],s.markedTextEnd=[];for(let n of s.fragments){s.firstFragmentIndex===void 0&&(s.firstFragmentIndex=n.towerId),s.lastFragmentIndex=n.towerId,this.updateFragmentLabelText(n);let i=this.svg.plain("").build(!0),o=[],a="",l="",g=!1;for(let[d,p]of Object.entries(n.span.attributes)){let u=this.eventAttributeTypes[d]||this.entityAttributeTypes[d];if(!u){g=!0;continue}let m=u.values[u.bool||p];if(!m){g=!0;continue}if($.isEmptyObject(m)){g=!0;continue}if(m.glyph)if(m.position==="left"){a=m.glyph+a;let f=i.tspan(m.glyph);f.addClass("glyph"),m.glyphColor&&f.fill(m.glyphColor)}else o.push([u,m]),l+=m.glyph}let v=n.labelText;if(a!==""&&(v=a+" "+v,i.plain(" ")),i.plain(n.labelText),o.length){v+=" "+l,i.plain(" ");for(let d of o){let p=i.tspan(d[1].glyph);p.addClass("glyph"),d[1].glyphColor&&p.fill(d[1].glyphColor)}}g&&(i.tspan("#").addClass("glyph").addClass("attribute_warning"),v+=" #"),n.glyphedLabelText=v,e[v]||(e[v]=!0,t.spanAnnTexts[v]=i)}}}updateFragmentLabelText(t){let e=I.getSpanLabels(this.entityTypes,t.span.type);if(t.labelText=I.spanDisplayForm(this.entityTypes,t.span.type),y.abbrevsOn&&e){let s=1,n=(t.to-t.from)/.8;for(;t.labelText.length>n&&e[s];)t.labelText=e[s],s++}t.labelText="("+t.labelText+")",t.span.labelText&&(t.labelText=t.span.labelText)}calculateFragmentDrawingOrder(t,e){for(let s=0;s<2;s++){for(let n of t.chunks){n.fragments.sort(At.compare);for(let[i,o]of n.fragments.entries())o.indexNumber=i}for(let n of Object.values(t.spans))n.refedIndexSum=0;for(let n of t.arcs)t.spans[n.origin].refedIndexSum+=t.spans[n.target].headFragment.indexNumber}for(let s of t.chunks){s.fragments.sort(At.compare);for(let[n,i]of s.fragments.entries())i.drawOrder=n}t.spanDrawOrderPermutation=this.determineDrawOrder(t.spans),e.sort(At.midpointComparator),this.organizeFragmentsIntoTowers(e);for(let s of t.spanDrawOrderPermutation){let n=t.spans[s];for(let i of n.fragments)t.towers[i.towerId]||(t.towers[i.towerId]=[],i.drawCurly=!0,i.span.drawCurly=!0),t.towers[i.towerId].push(i)}}resetData(){this.sourceData&&this.setData(this.sourceData),this.renderData(void 0)}fastTranslateGroup(t,e,s){t.attr("transform","translate("+e+", "+s+")")}fastTranslate(t,e,s){this.fastTranslateGroup(t.group,e,s),t.translation={x:e,y:s}}addHeaderAndDefs(){let t=this.svg.defs(),e=t.filter();return e.id("Gaussian_Blur"),e.gaussianBlur(2,2),e.addTo(t),this.renderDragArcMarker(t),t}getTextMeasurements(t,e,s){let n=this.svg.group().addTo(this.svg);e&&n.addClass(e);for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&this.svg.plain(a).addTo(n);let i={};for(let a of n.children()){let l=a.text();i[l]=a.node.getComputedTextLength(),s&&t[l].map(g=>s(g,a.node))}let o=n.bbox();return n.remove(),new Vr(i,o.height,o.y)}calculateTextMeasurements(t){let e=this.calculateChunkTextMeasures(t),s=this.calculateFragmentTextMeasures(t),n=this.calculateArcTextMeasurements(t);return new jr(e,n,s)}calculateChunkTextMeasures(t){let e={};for(let s of t.chunks){s.row=void 0,Object.prototype.hasOwnProperty.call(e,s.text)||(e[s.text]=[]);let n=e[s.text];n.push(...s.fragments),n.push(...s.markedTextStart),n.push(...s.markedTextEnd)}return this.getTextMeasurements(e,void 0,(s,n)=>this.calculateChunkTextElementMeasure(s,n))}calculateChunkTextElementMeasure(t,e){if(!(t instanceof At)){t[2]<0&&(t[2]=0);let d=!0,p=0;for(let u=0;u<t[2];u++){let m=e.textContent[u];/\s/.test(m)?(d&&p++,d=!0):d=!1}t[2]-=p,t[2]?t[3]=e.getEndPositionOfChar(t[2]-1).x+1:t[3]=e.getStartPositionOfChar(t[2]).x;return}let s=t.from-t.chunk.from;s<0&&(s=0,this.dispatcher.post("messages",[[["<strong>WARNING</strong><br/> The fragment ["+t.from+", "+t.to+"] ("+t.text+") is not contained in its designated chunk ["+t.chunk.from+", "+t.chunk.to+"] most likely due to the fragment starting or ending with a space, please verify the sanity of your data since we are unable to visualise this fragment correctly and will drop leading space characters","warning",15]]]));let n=t.to-t.chunk.from-1,i=t.chunk.text.substring(0,s),o=t.chunk.text.substring(0,n),a=i.replace(/\s\s+/g," "),l=o.replace(/\s\s+/g," ");s-=i.length-a.length,n-=o.length-l.length;let g,v;this.rtlmode?([g,v]=this.calculateSubstringWidthRobust(t,e,s,n),g=-g,v=-v):[g,v]=this.calculateSubstringWidthFast(e,s,n),t.curly={from:Math.min(g,v),to:Math.max(g,v)}}calculateSubstringWidthRobust(t,e,s,n){let i,o,a=1;if(t.chunk.rtlsizes)i=t.chunk.rtlsizes.charDirection,o=t.chunk.rtlsizes.charAttrs,a=t.chunk.rtlsizes.corrFactor;else{if(i=[],o=[],e.textContent!==null)for(let p=0;p<e.getNumberOfChars();p++){let u=e.getEndPositionOfChar(p).x-e.getStartPositionOfChar(p).x,m=Vl(e.textContent.charCodeAt(p))?"rtl":"ltr";o.push({order:p,width:Math.abs(u),direction:m}),i.push(m)}if(o.length>1){let u=0,m=0;for(;m<o.length;){for(;i[u]===i[m];)m++;i[u]===(this.rtlmode?"ltr":"rtl")&&(o=o.slice(0,u).concat(o.slice(u,m).reverse()).concat(o.slice(m))),u=m}}let d=0;for(let p=0;p<o.length;p++)d+=o[p].width;a=e.getComputedTextLength()/d,t.chunk.rtlsizes={charDirection:i,charAttrs:o,corrFactor:a}}let l=0;for(let d=0;d<o.length&&d<s;d++)(i[d]==="ltr"||o[d].order!==s)&&(l+=o[d].width);let g=0,v=0;for(;o[v].order!==n&&v<o.length;v++)g+=o[v].width;return i[v]===(this.rtlmode?"rtl":"ltr")&&(g+=o[v].width),l=l*a,g=g*a,[l,g]}calculateSubstringWidthFast(t,e,s){let n;e<t.getNumberOfChars()?n=t.getStartPositionOfChar(e).x:n=t.getComputedTextLength();let i=s<e?n:t.getEndPositionOfChar(s).x;return[n,i]}calculateFragmentTextMeasures(t){let e={},s=!0;if(t.spans){for(let n of Object.values(t.spans))if(n.fragments)for(let i of n.fragments)e[i.glyphedLabelText]=!0,s=!1}return s&&(e.$=!0),this.getTextMeasurements(e,"span")}calculateArcTextMeasurements(t){let e=t.arcs,s=t.spans,n=t.eventDescs,i={};return e&&e.forEach(o=>{let a=I.getArcLabels(this.entityTypes,s[o.origin].type,o.type,this.relationTypes);a.length||(a=[o.type]),o.eventDescId&&n[o.eventDescId]&&n[o.eventDescId].labelText&&(a=[n[o.eventDescId].labelText]),a.forEach(l=>{i[l]=!0})}),this.getTextMeasurements(i,"arcs")}adjustTowerAnnotationSizes(t){let e=t.sizes.fragments.widths;Object.values(t.towers).forEach(s=>{let n=0;s.forEach(i=>{n=Math.max(n,e[i.glyphedLabelText])}),s.forEach(i=>{i.width=n})})}makeArrow(t){let e=t.split(","),s=e[0];if(s==="none")return;let n=5,i=5,o="black";$.isNumeric(e[1])&&e[2]?$.isNumeric(e[2])&&e[3]?(n=parseFloat(e[1]),i=parseFloat(e[2]),o=e[3]||"black"):(n=i=parseFloat(e[1]),o=e[2]||"black"):o=e[1]||"black";let a="arrow_"+t.replace(/#/g,"").replace(/,/g,"_");if(s==="triangle"){let l=this.svg.marker(n,i).id(a).ref(n,i/2).orient("auto").attr({markerUnits:"strokeWidth",fill:o}).addTo(this.svg.defs());this.svg.polygon([[0,0],[n,i/2],[0,i],[n/12,i/2]]).addTo(l)}return a}calculateMaxTextWidth(t){let e=0;for(let s in t.texts.widths)Object.prototype.hasOwnProperty.call(t.texts.widths,s)&&(e=Math.max(e,t.texts.widths[s]));return e}renderLayoutFloorsAndCurlies(t,e){let s=[],n=[];$.each(e,(o,a)=>{let l=t.spans[a],g=this.entityTypes[l.type];if((g&&g.bgColor||"#ffffff")==="hidden"){l.hidden=!0;return}let d=l.fragments[0],p=l.fragments[l.fragments.length-1],u=(d.curly.from+d.curly.to-d.width)/2-y.visual.margin.x-t.sizes.fragments.height/2,m=d.chunk.index,f=(p.curly.from+p.curly.to+p.width)/2+y.visual.margin.x+t.sizes.fragments.height/2,b=p.chunk.index,x=0,k=l.drawCurly?y.visual.curlyHeight:0,h=t.sizes.fragments.height+k+y.visual.boxSpacing+2*y.visual.margin.y-3;$.each(s,(N,A)=>{let G=!0;for(let F=m;F<=b;F++){if(!(n[F]&&n[F][A]))continue;let Q=F===m?u:-1/0,W=F===b?f:1/0;$.each(n[F][A],(rt,P)=>{if(P[0]<W&&Q<P[1])return G=!1,!1})}if(G){if(x===null)x=A;else if(h+x<=A)return!1}else x=null});let S=n.length,w=function(N){let A=$.inArray(N,s);if(A===-1&&(s.push(N),s.sort(I.cmp),A=$.inArray(N,s),A!==0)){let G=s[A-1];for(let F=0;F<=S;F++)if(n[F]){n[F][G]||(n[F][G]=[]);let Q=N-G;for(let W of n[F][G])W[2]>Q&&(n[F][N]||(n[F][N]=[]),n[F][N].push([W[0],W[1],W[2]-Q]))}}return A},_=x+h;w(_);let T=w(x),D,E;for(E=T;(D=s[E])!==void 0&&D<_;E++){let N=_-D;for(let A=m;A<=b;A++){let G=A===m?u:0,F=A===b?f:1/0;n[A]||(n[A]=[]),n[A][D]||(n[A][D]=[]),n[A][D].push([G,F,N])}}l.floor=x+k})}renderChunks(t,e,s,n){let i;this.rtlmode?i=this.canvasWidth-(y.visual.margin.x+this.sentNumMargin+this.rowPadding):i=y.visual.margin.x+this.sentNumMargin+this.rowPadding;let o=[],a=[],l={},g=0,v=e.sentence_number_offset,d=new le(this.svg);d.sentence=v,d.backgroundIndex=g,d.index=0;let p=[],u=0;for(s.forEach(m=>{let f=0;if(m.lastSpace){let R=m.lastSpace.length||0,C;if(m.sentence){let M=e.sentence_offsets[m.sentence-e.sentence_number_offset][0];C=R-(m.from-M)}else C=0;for(let M=C;M<R;M++)f+=this.spaceWidths[m.lastSpace[M]]*(this.fontZoom/100)||0;i+=this.rtlmode?-f:f}m.group=this.svg.group().addTo(d.group),m.highlightGroup=this.svg.group().addClass("chunk-highlights").addTo(m.group);let b=0,x=!1,k=!1,h=!1,S=!1,w=1/0,_=0,T=0,D=0,E,N=0;m.fragments.forEach(R=>{let C=R.span;if(C.hidden||C.id==="rel:0-before"||C.id==="rel:1-after")return;let M=this.entityTypes[C.type],gt=M&&M.bgColor||"#ffffff",Br=M&&M.fgColor||"#000000",$t=M&&M.borderColor||"#000000";C.color&&(gt=C.color,Br=Wl(gt),$t="darken"),$t==="darken"&&($t=I.adjustColorLightness(gt,-.6)),R.group=this.svg.group().addTo(m.group).addClass("span"),b||(b=-t.sizes.texts.height);let jt=(R.curly.from+R.curly.to)/2,ht=b+t.sizes.fragments.y,Kt=t.sizes.fragments.height,Vt=R.width,er=jt-Vt/2;ht+=this.boxTextMargin.y,Kt-=2*this.boxTextMargin.y,er+=this.boxTextMargin.x,Vt-=2*this.boxTextMargin.x;let Te="span_"+(C.cue||C.type)+" span_default";C.comment&&C.comment.type&&(Te+=" "+C.comment.type);let tt=er-y.visual.margin.x-this.boxTextMargin.x,Fe=ht-y.visual.margin.y,St=Vt+2*y.visual.margin.x,st=Kt+2*y.visual.margin.y;this.roundCoordinates&&(jt=(jt|0)+.5,tt=(tt|0)+.5),C.marked&&this.renderSpanMarkedRect(ht,tt,Fe,St,st,R),w=Math.min(tt-this.markedSpanSize,w),_=Math.max(tt+St+this.markedSpanSize,_);let vt=st+2*this.markedSpanSize;C.shadowClass&&C.shadowClass.match(this.shadowClassPattern)&&(this.renderFragmentShadowRect(ht,tt,Fe,St,st,R),w=Math.min(tt-this.rectShadowSize,w),_=Math.max(tt+St+this.rectShadowSize,_),vt=Math.max(st+2*this.rectShadowSize,vt)),R.rect=this.renderFragmentRect(tt,Fe,St,st,ht,R,Te,gt,$t),R.left=tt,R.right=tt+St,C.shadowClass||C.marked||(w=Math.min(tt,w),_=Math.max(tt+St,_),vt=Math.max(st,vt)),R.rectBox=new Ur(tt,Fe-C.floor,St,st),R.height=C.floor+Kt+3*y.visual.margin.y+y.visual.curlyHeight+y.visual.arcSpacing*(this.fontZoom/100);let ks=R.towerId*2;if((!a[ks]||a[ks]<R.height)&&(a[ks]=R.height),C.attributeMerge.box==="crossed"&&this.renderFragmentCrossOut(er,ht,Kt,R),R.group.add(t.spanAnnTexts[R.glyphedLabelText].clone().amove(jt,b-C.floor).fill(Br)),R.drawCurly&&(this.renderCurly(R,jt,ht,Kt),w=Math.min(R.curly.from,w),_=Math.max(R.curly.to,_),vt=Math.max(y.visual.curlyHeight,vt)),R===C.headFragment){let kn=(mt,te,As)=>{let Mr=As.headFragment.chunk;if(!Mr.row){k=!0;return}let Nr;Mr.row.index===u?Nr=Mr.translation.x+As.fragments[As.fragments.length-1].right:this.rtlmode?Nr=0:Nr=y.visual.margin.x+this.sentNumMargin+this.rowPadding;let rr=I.getArcLabels(this.entityTypes,te.type,mt.type,this.relationTypes);rr.length||(rr=[mt.type]),mt.eventDescId&&t.eventDescs[mt.eventDescId]&&t.eventDescs[mt.eventDescId].labelText&&(rr=[t.eventDescs[mt.eventDescId].labelText]);let ro=y.abbrevsOn?rr.length-1:0,An=t.sizes.arcs.widths[rr[ro]]+2*this.minArcSlant,so=Math.abs(i+(this.rtlmode?-tt:tt)-Nr),sr=An-so;(!x||D<sr)&&(D=sr,E=Mr.index+1),sr=An-tt,(!x||N<sr)&&(N=sr),x=!0};for(let mt of C.incoming){let te=t.spans[mt.origin];kn(mt,te,te)}for(let mt of C.outgoing){let te=t.spans[mt.target];kn(mt,C,te)}for(let mt of C.incoming){let te=t.spans[mt.origin].headFragment.chunk;m.index===te.index&&(h=!0)}}vt+=C.floor||y.visual.curlyHeight,vt>T&&(T=vt),S=!0}),m.right=_;let A=t.sizes.texts.widths[m.text];T+=t.sizes.texts.height;let G=this.rtlmode?_:-Math.min(w,0),F;this.rtlmode?F=Math.max(A,-w)-Math.min(0,-_):F=Math.max(A,_)-Math.min(0,w),D>0&&(i+=this.rtlmode?-D:D);let Q=k?this.arcHorizontalSpacing:h?this.arcSlant:0,W=x?this.arcHorizontalSpacing:h?this.arcSlant:0,rt=i,P=d;if(m.sentence)for(;v<m.sentence-1;)v++,d.arcs=this.svg.group().addTo(d.group).addClass("arcs"),o.push(d),d=new le(this.svg),d.sentence=v,g=1-g,d.backgroundIndex=g,d.index=++u;let lt;if(this.rtlmode?lt=i-F-W<=2*y.visual.margin.x:lt=i+F+Q>=this.canvasWidth-2*y.visual.margin.x,m.sentence>e.sentence_number_offset||lt){d.arcs=this.svg.group().addTo(d.group).addClass("arcs");let R=0;if(m.lastSpace){let C=m.lastSpace.length||0,M;if(m.sentence){let gt=e.sentence_offsets[m.sentence-e.sentence_number_offset][0];M=C-(m.from-gt)}else M=0;for(let gt=M;gt<C;gt++)R+=this.spaceWidths[m.lastSpace[gt]]*(this.fontZoom/100)||0}if(this.rtlmode?i=this.canvasWidth-(y.visual.margin.x+this.sentNumMargin+this.rowPadding+(k?this.arcHorizontalSpacing:h?this.arcSlant:0)-R):i=y.visual.margin.x+this.sentNumMargin+this.rowPadding+(x?this.arcHorizontalSpacing:h?this.arcSlant:0)+R,x){let C=t.sizes.texts.widths[m.text]+this.arcHorizontalSpacing;C>n&&(n=C)}N>0&&(i+=this.rtlmode?-N:N,D=0),o.push(d),m.group.remove(),d=new le(this.svg),m.sentence&&(g=1-g),d.backgroundIndex=g,d.index=++u,m.group.addTo(d.group),m.group=Tr(d.group.node.lastElementChild),$(m.group).children("g[class='span']").each((C,M)=>{m.fragments[C].group=Tr(M)}),$(m.group).find("rect[data-span-id]").each((C,M)=>{m.fragments[C].rect=Tr(M)})}if(d.index!==P.index&&$.each(l,(R,C)=>{if(C[3]!==rt){let M;this.rtlmode?M=[P,C[3],rt-G,C[4]]:M=[P,C[3],rt+G,C[4]],p.push(M)}C[3]=i}),$.each(m.markedTextStart,(R,C)=>{C[3]+=i+(this.rtlmode?-G:G),l[C[0]]=C}),$.each(m.markedTextEnd,(R,C)=>{C[3]+=i+(this.rtlmode?-G:G);let M=l[C[0]];delete l[C[0]],p.push([d,M[3],C[3],M[4]])}),S&&(d.hasAnnotations=!0),m.sentence>e.sentence_number_offset&&(d.sentence=++v),D>0){D/=2;let R=d.chunks[d.chunks.length-1];if(R===void 0)console.log("warning: firstChunkInRow undefined, chunk:",m);else{E<R.index&&(E=R.index+1);for(let C=E;C<m.index;C++){let M=t.chunks[C];this.fastTranslate(M,M.translation.x+D,0),M.textX+=D}}}d.chunks.push(m),m.row=d,this.fastTranslate(m,i+(this.rtlmode?-G:G),0),m.textX=i+(this.rtlmode?-G:G),i+=this.rtlmode?-F:F});v<e.sentence_offsets.length+e.sentence_number_offset-1;)v++,d.arcs=this.svg.group().addTo(d.group).addClass("arcs"),o.push(d),d=new le(this.svg),d.sentence=v,g=1-g,d.backgroundIndex=g,d.index=++u;return d.arcs=this.svg.group().addTo(d.group).addClass("arcs"),o.push(d),[o,a,p]}renderChunksPass2(t,e,s){let n,i=(g,v)=>{let d=n.fragments[g],p=n.fragments[v],u=I.cmp(d.from,p.from);return u!==0?u:I.cmp(p.to-p.from,d.to-d.from)},o=(g,v)=>{let d=n.fragments[g],p=n.fragments[v],u=I.cmp(p.to,d.to);return u!==0?u:I.cmp(p.to-p.from,d.to-d.from)},a,l;$.each(t.chunks,(g,v)=>{n=v,(!l||a.row!==v.row)&&(l&&this.horizontalSpacer(l,0,a.row.textY,1,{"data-chunk-id":a.index,class:"row-final spacing"}),l=this.svg.group().addTo(e).addClass("text-row")),a=v;let d=t.chunks[g+1];if(this.rtlmode){if(l.node.firstChild||this.horizontalSpacer(l,0,v.row.textY,1,{class:"row-initial spacing","data-chunk-id":v.index}),v.renderText(this.svg,l),d){let p=v.textX-t.sizes.texts.widths[v.text],u=v.textX-t.sizes.texts.widths[v.text]-d.textX;this.horizontalSpacer(l,p,v.row.textY,u,{"data-chunk-id":v.index})}}else if(l.node.firstChild||this.horizontalSpacer(l,0,v.row.textY,1,{class:"row-initial spacing","data-chunk-id":v.index}),v.renderText(this.svg,l),d){let p=v.textX+t.sizes.texts.widths[v.text],u=d.textX-p;this.horizontalSpacer(l,p,v.row.textY,u,{"data-chunk-id":v.index})}if(v.fragments.length){let p=[];for(let u=v.fragments.length-1;u>=0;u--)p.push(u);p.sort(i);{let u=[];for(let m=0;m<p.length;m++){let f=v.fragments[p[m]];f.nestingHeightLR=0,f.nestingDepthLR=0;let b=[];for(let x=0;x<u.length;x++)u[x].to>f.from&&(b.push(u[x]),u[x].nestingHeightLR++);u=b,f.nestingDepthLR=u.length,u.push(f)}}p.sort(o);{let u=[];for(let m=0;m<p.length;m++){let f=v.fragments[p[m]];f.nestingHeightRL=0,f.nestingDepthRL=0;let b=[];for(let x=0;x<u.length;x++)u[x].from<f.to&&(b.push(u[x]),u[x].nestingHeightRL++);u=b,f.nestingDepthRL=u.length,u.push(f)}}for(let u=0;u<p.length;u++){let m=v.fragments[p[u]];m.nestingHeight=m.nestingHeightLR>m.nestingHeightRL?m.nestingHeightLR:m.nestingHeightRL,m.nestingDepth=m.nestingDepthLR>m.nestingDepthRL?m.nestingDepthLR:m.nestingDepthRL}p.sort(function(u,m){return I.cmp(v.fragments[m].nestingHeight,v.fragments[u].nestingHeight)});for(let u=0;u<v.fragments.length;u++){let m=v.fragments[p[u]];if(m.span.hidden)continue;let f=this.entityTypes[m.span.type],b=f&&f.bgColor||"#ffffff";m.span.color&&(b=m.span.color);let x=0;m.nestingDepth>1&&m.nestingHeight===0?x=1:m.nestingDepth===0&&m.nestingHeight>0&&(x=-1);let k=x*this.nestingAdjustYStepSize,h=x*this.nestingAdjustXStepSize,S=I.adjustColorLightness(b,.8),w=1;m.highlightPos={x:v.textX+(this.rtlmode?m.curly.from-h:m.curly.from+h),y:v.row.textY+t.sizes.texts.y+k+w,w:m.curly.to-m.curly.from-2*h,h:t.sizes.texts.height-2*k-w},m.highlightPos.w<=0&&(m.highlightPos.w=1),this.svg.rect(m.highlightPos.w,m.highlightPos.h).addClass("chunk-highlight").move(m.highlightPos.x,m.highlightPos.y).attr({fill:S,rx:this.highlightRounding.x,ry:this.highlightRounding.y}).addTo(this.highlightGroup)}}}),l&&n&&this.horizontalSpacer(l,0,n.row.textY,1,{"data-chunk-id":n.index,class:"row-final spacing"});for(let g of s)this.svg.rect(g[2]-g[1]+4,t.sizes.fragments.height+4).translate(g[1]-2,g[0].textY-t.sizes.fragments.height).addClass(g[3]).addTo(this.highlightGroup)}renderBumpFragmentHeightsMinimumToArcStartHeight(t){let e=y.visual.arcStartHeight*(this.fontZoom/100);for(let s=0;s<t.length;s++)(!t[s]||t[s]<e)&&(t[s]=e)}renderCalculateArcJumpHeight(t,e){for(let s of t.arcs){s.jumpHeight=0;let n=t.spans[s.origin].headFragment,i=t.spans[s.target].headFragment;if(n.span.hidden||i.span.hidden){s.hidden=!0;return}if(n.towerId>i.towerId){let l=n;n=i,i=l}let o,a;n.chunk.index===i.chunk.index?(o=n.towerId,a=i.towerId):(o=n.towerId+1,a=i.towerId-1);for(let l=o;l<=a;l++){let g=e[l*2];s.jumpHeight<g&&(s.jumpHeight=g)}}}renderSortArcs(t){t.arcs.sort((e,s)=>{let n=e.jumpHeight-s.jumpHeight;return n||(n=e.dist-s.dist,n)||(n=t.spans[e.origin].headFragment.height+t.spans[e.target].headFragment.height-t.spans[s.origin].headFragment.height-t.spans[s.target].headFragment.height,n)||(n=t.spans[e.origin].headFragment.height-t.spans[s.origin].headFragment.height,n)?n<0?-1:1:0})}renderAssignFragmentsToRows(t,e){let s=y.visual.arcStartHeight*(this.fontZoom/100),n=0,i=0;$.each(t,(o,a)=>{let l=!1;a.heightsStart=a.heightsEnd=n,$.each(a.chunks,(g,v)=>{if(v.lastFragmentIndex!==void 0){l=!0;let d=v.lastFragmentIndex*2+i;a.heightsEnd<d&&(a.heightsEnd=d);let p=v.firstFragmentIndex*2+i;a.heightsStart>p&&(a.heightsStart=p)}}),e.splice(a.heightsStart,0,s),i++,a.heightsAdjust=i,l&&(a.heightsEnd+=2),n=a.heightsEnd+1})}renderDragArcMarker(t){let e=this.svg.marker(5,5).id("drag_arrow").ref(5,2.5).orient("auto").addClass("drag_fill").attr("markerUnits","strokeWidth").addTo(t);this.svg.polyline([[0,0],[5,2.5],[0,5],[.2,2.5]]).addTo(e)}renderArcs(t,e,s){let n={},i=this.makeArrow("none");i&&(n.none=i);let o={};for(let a of t.arcs)this.renderArc(t,a,n,e,s,o)}renderArc(t,e,s,n,i,o){if(e.hidden)return;let a=t.spans[e.origin],l=t.spans[e.target],g=a.headFragment.towerId<l.headFragment.towerId,v=g?a.headFragment:l.headFragment,d=g?l.headFragment:a.headFragment,p=this.relationTypes[e.type],u=this.entityTypes[a.type];if(!p&&u&&u.arcs)for(let F of u.arcs)F.type===e.type&&(p=F);let m=p&&p.color||"#000000";if(m==="hidden")return;e.eventDescId&&t.eventDescs[e.eventDescId]&&t.eventDescs[e.eventDescId].color&&(m=t.eventDescs[e.eventDescId].color);let f=p&&p.properties&&p.properties.symmetric,b=p&&p.dashArray,x=(p&&p.arrowHead||"triangle,5")+","+m,k=(p&&p.labelArrow||"triangle,5")+","+m,h=v.rowBBox(),S=d.rowBBox(),w=v.chunk.row.index,_=d.chunk.row.index;if(!s[x]){let F=this.makeArrow(x);F&&(s[x]=F)}if(!s[k]){let F=this.makeArrow(k);F&&(s[k]=F)}let T=0,D,E;v.chunk.index===d.chunk.index?(D=v.towerId*2+v.chunk.row.heightsAdjust,E=d.towerId*2+d.chunk.row.heightsAdjust):(D=v.towerId*2+1+v.chunk.row.heightsAdjust,E=d.towerId*2-1+d.chunk.row.heightsAdjust),this.collapseArcSpace||(T=this.findArcHeight(D,E,i),this.adjustFragmentHeights(D,E,i,T),T+=.5);let N=!1,A=a.headFragment.chunk.index===l.headFragment.chunk.index;A&&(this.rtlmode?N=h.x+h.width/2>S.x+S.width/2:N=h.x+h.width/2<S.x+S.width/2);let G=A?N?-.5:.5:1;for(let F=w;F<=_;F++){let Q=n[F];if(!Q.chunks.length)continue;Q.hasAnnotations=!0;let W=F===w?D:Q.heightsStart,rt=F===_?E:Q.heightsEnd;this.collapseArcSpace&&(T=this.findArcHeight(W,rt,i));let P=this.svg.group().attr("data-from",e.origin).attr("data-to",e.target).attr("data-id",e.eventDescId).addTo(Q.arcs),lt;F===w&&v.span.id!=="rel:0-before"?this.rtlmode?lt=h.x+(N?h.width:0):lt=h.x+(N?0:h.width):lt=this.rtlmode?this.canvasWidth-2*y.visual.margin.y-this.sentNumMargin:this.sentNumMargin;let R;F===_&&d.span.id!=="rel:1-after"?this.rtlmode?R=S.x+(N?0:S.width):R=S.x+(N?S.width:0):R=this.rtlmode?0:this.canvasWidth-2*y.visual.margin.y;let C=!0;if(this.collapseArcs){let st=e.type+" "+F+" "+lt+" "+R;F===w&&(st=v.span.id+" "+st),F===_&&(st+=" "+d.span.id);let vt=o[st];vt!==void 0?(T=vt,C=!1):o[st]=T}this.collapseArcSpace&&C&&(this.adjustFragmentHeights(W,rt,i,T),T+=.5);let M;(e.shadowClass||e.marked)&&(M=this.svg.group().addTo(P));let{textStart:gt,textEnd:Br}=this.renderArcLabel(t,e,R,lt,T,P,M);this.roundCoordinates&&(T=(T|0)+.5),T>Q.maxArcHeight&&(Q.maxArcHeight=T);let $t=p&&p.arrowHead,jt=(f?$t||"none":g?"none":$t||"triangle,5")+","+m,ht=s[jt],Kt=ht&&"url(#"+ht+")",Vt=0,er=null,Te=p&&p.labelArrow;if(Te){let vt=((g?f&&Te||"none":Te||"triangle,5")+","+m).split(",");Vt=vt[0]!=="none"&&parseInt(vt[1],10)||0,A&&(Vt=-Vt)}let tt=st=>{this.svg.path(st).css("stroke",m).stroke({dasharray:b}).attr({"marker-start":er,"marker-end":Kt}).addTo(P),e.marked&&M&&this.svg.path(st).addClass("shadow_EditHighlight_arc").stroke({width:this.markedArcStroke,dasharray:b}).addTo(M),e.shadowClass&&M&&this.svg.path(st).addClass(`shadow_${e.shadowClass}`).stroke({width:this.shadowStroke,dasharray:b}).addTo(M)},Fe=this.makeLeftArcSegmentPath(v,gt,Vt,T,F,w,lt,G,A,h,g,e);tt(Fe),f||($t=p&&p.arrowHead,jt=(g?$t||"triangle,5":"none")+","+m),ht=s[jt],Kt=ht&&"url(#"+ht+")";let St=this.makeRightArcSegmentPath(d,Br,Vt,T,F,_,R,G,A,S,g,e);tt(St)}}makeRightArcSegmentPath(t,e,s,n,i,o,a,l,g,v,d,p){let u=e+s,m=[["M",u,-n]];if(i!==o||t.span.id==="rel:1-after")return m.push(["L",a,-n]),m;let f=a-(this.rtlmode?-1:1)*l*this.arcSlant;if(this.rtlmode?!g&&f>u-1&&(f=u-1):!g&&f<u+1&&(f=u+1),this.smoothArcCurves){let b,x;this.rtlmode?(b=g?f+2*l*this.reverseArcControlx:this.smoothArcSteepness*a+(1-this.smoothArcSteepness)*f,x=v.y+(d&&!p.equiv?y.visual.margin.y:v.height/2)):(b=g?f-2*l*this.reverseArcControlx:this.smoothArcSteepness*a+(1-this.smoothArcSteepness)*f,x=v.y+(d&&!p.equiv?y.visual.margin.y:v.height/2)),Math.abs(-n-x)<2&&Math.abs(f-a)<5&&(x=-n),m.push(["L",f,-n]),m.push(["Q",b,-n,a,x])}else m.push(["L",f,-n]),m.push(["L",a,v.y+(d&&!p.equiv?y.visual.margin.y:v.height/2)]);return m}makeLeftArcSegmentPath(t,e,s,n,i,o,a,l,g,v,d,p){let u=e-s;if(isNaN(u))debugger;let m=[["M",u,-n]];if(i!==o||t.span.id==="rel:0-before")return m.push(["L",a,-n]),m;let f=a+(this.rtlmode?-1:1)*l*this.arcSlant;if(this.rtlmode?!g&&f<u+1&&(f=u+1):!g&&f>u-1&&(f=u-1),this.smoothArcCurves){let b,x;this.rtlmode?(b=g?f-2*l*this.reverseArcControlx:this.smoothArcSteepness*a+(1-this.smoothArcSteepness)*f,x=v.y+(d&&!p.equiv?y.visual.margin.y:v.height/2)):(b=g?f+2*l*this.reverseArcControlx:this.smoothArcSteepness*a+(1-this.smoothArcSteepness)*f,x=v.y+(d||p.equiv?v.height/2:y.visual.margin.y)),Math.abs(-n-x)<2&&Math.abs(f-a)<5&&(x=-n),m.push(["L",f,-n]),m.push(["Q",b,-n,a,x])}else m.push(["L",f,-n]),m.push(["L",a,v.y+(d||p.equiv?v.height/2:y.visual.margin.y)]);return m}renderArcLabel(t,e,s,n,i,o,a){let l=t.spans[e.origin].type,g=I.getArcLabels(this.entityTypes,l,e.type,this.relationTypes),v=I.arcDisplayForm(this.entityTypes,l,e.type,this.relationTypes);if(y.abbrevsOn&&g){let b=1,x=s-n-this.arcSlant;for(;t.sizes.arcs.widths[v]>x&&g[b];)v=g[b],b++}e.eventDescId&&t.eventDescs[e.eventDescId]&&t.eventDescs[e.eventDescId].labelText&&(v=t.eventDescs[e.eventDescId].labelText);let d=t.sizes.arcs.height/4;this.svg.plain(v).amove((n+s)/2,-i+d).attr({fill:"#000000","data-arc-role":e.type,"data-arc-origin":e.origin,"data-arc-target":e.target,"data-arc-ed":e.eventDescId}).addTo(o);let p=t.sizes.arcs.widths[v],u={x:(n+s-p)/2,width:p,y:-i-t.sizes.arcs.height/2,height:t.sizes.arcs.height};e.marked&&a&&this.svg.rect().move(u.x-this.markedArcSize,u.y-this.markedArcSize).width(u.width+2*this.markedArcSize).height(u.height+2*this.markedArcSize).attr({filter:"url(#Gaussian_Blur)",class:"shadow_EditHighlight",rx:this.markedArcSize,ry:this.markedArcSize}).addTo(a),e.shadowClass&&a&&this.renderArcShadow(e,a,u);let m=u.x,f=u.x+u.width;if(m-=y.visual.arcTextMargin*(this.fontZoom/100),f+=y.visual.arcTextMargin*(this.fontZoom/100),n>s){let b=m;m=f,f=b}return{textStart:m,textEnd:f}}renderFragmentConnectors(t,e){for(let s of Object.values(t.spans)){let n=s.fragments.length-1;for(let i=0;i<n;i++){let o=s.fragments[i],a=s.fragments[i+1],l=o.rowBBox(),g=a.rowBBox(),v=o.chunk.row.index,d=a.chunk.row.index;for(let p=v;p<=d;p++){let u=e[p];if(u.chunks.length){u.hasAnnotations=!0;let m;p===v?m=this.rtlmode?l.x:l.x+l.width:m=this.rtlmode?this.canvasWidth-2*y.visual.margin.y-this.sentNumMargin:this.sentNumMargin;let f;p===d?f=this.rtlmode?g.x+g.width:g.x:f=this.rtlmode?0:this.canvasWidth-2*y.visual.margin.y;let b=l.y+l.height-y.visual.margin.y;this.roundCoordinates&&(b=(b|0)+.5),this.svg.path([["M",m,b],["L",f,b]]).css("stroke",this.fragmentConnectorColor).stroke({dasharray:this.fragmentConnectorDashArray}).addTo(u.arcs)}}}}}renderResizeSvg(t,e,s,n){let i=n+this.sentNumMargin+2*y.visual.margin.x+1;for(let a of s.children().filter(l=>l.hasClass("text-row"))){let l=a.children().filter(d=>d.hasClass("row-final"))[0],g=t.sizes.texts.widths[l.prev().node.textContent],v=parseFloat(l.prev().node.getAttribute("x"));this.rtlmode||v+g>i&&(i=v+g)}let o=Math.max(i-this.canvasWidth,0);return o>0&&(this.svg.attr("width",`${this.baseCanvasWidth}`),this.canvasWidth=i,this.canvasWidth+=32,o+=32),this.svg.attr("width",`${this.canvasWidth}`),I.profileStart("height"),this.svg.attr("height",`${e}`),I.profileEnd("height"),this.svg.attr("viewBox",`0 0 ${this.canvasWidth} ${e}`),this.svg.attr("height",`${e+4}`),o}renderRows(t,e,s,n){let i=y.visual.margin.y,o=0;for(let a of e){a.updateFragmentHeight(),a.updateRowBoxHeight(this.rowSpacing,this.rowPadding),a.sentence&&(o=a.sentence),this.renderRowBackground(t,n,a,i,o),i+=a.boxHeight,i+=t.sizes.texts.height,a.textY=i-this.rowPadding,this.renderRowNumber(t,s,a,i);let l=i-this.rowPadding;this.roundCoordinates&&(l=l|0),this.fastTranslate(a,0,l),i+=y.visual.margin.y}return i+=y.visual.margin.y,i}renderRowBackground(t,e,s,n,i){let o;y.textBackgrounds==="striped"?o="background"+s.backgroundIndex:o="background0";let a=t.sizes.texts;this.svg.rect(this.canvasWidth,s.boxHeight+a.height+1).move(0,n+a.y+a.height).addClass(o).addTo(e),s.sentence&&t.markedSent[i]&&this.svg.rect().move(this.rtlmode?this.canvasWidth-this.sentNumMargin:0,n+a.y+a.height).width(this.sentNumMargin).height(s.boxHeight+a.height+1).addClass("backgroundHighlight").addTo(e)}renderRowNumber(t,e,s,n){if(s.sentence){let i;this.rtlmode?i=this.canvasWidth-this.sentNumMargin+y.visual.margin.x:i=this.sentNumMargin-y.visual.margin.x;let o=this.svg.plain(`${s.sentence}`).attr("data-sent",s.sentence).css("cursor","pointer");o.node.setAttribute("x",`${i}`),o.node.setAttribute("y",`${n-this.rowPadding}`),o.addTo(e);let a=t.sentComment[s.sentence];if(a){let l=o.rbox(e),g=this.svg.rect().move(this.rtlmode?l.x-this.rectShadowSize:l.x-this.rectShadowSize,l.y-this.rectShadowSize).width(l.width+2*this.rectShadowSize).height(l.height+2*this.rectShadowSize).attr({class:"shadow_"+a.type,filter:"url(#Gaussian_Blur)",rx:this.rectShadowRounding,ry:this.rectShadowRounding,"data-sent":s.sentence}).addTo(e);o.insertAfter(g),o.css("fill","#000")}}}renderAdjustLayoutForScriptDirection(t,e,s,n){if(t<=0)return;let i=bi(this.svg.node);this.rtlmode?(e.map(o=>this.fastTranslate(o,t,o.translation.y)),this.fastTranslateGroup(this.highlightGroup,t,0),this.fastTranslateGroup(s,t,0),this.fastTranslateGroup(n,t,0),i&&(i.scrollLeft=t+4)):i&&(i.scrollLeft=0)}renderAdjustBackgroundsForOversize(t,e){if(!(t<=0)){e.width(this.canvasWidth);for(let s of e.children())s.hasClass("backgroundHighlight")?this.rtlmode&&s.translate(t,0):s.width(this.canvasWidth)}}renderAdjustLayoutRowSpacing(t,e){for(let s of e.children().filter(n=>n.hasClass("text-row"))){let n=s.children().filter(l=>l.hasClass("row-initial"))[0],i=s.children().filter(l=>l.hasClass("row-final"))[0],o=t.sizes.texts.widths[i.prev().node.textContent],a=parseFloat(i.prev().node.getAttribute("x"));if(this.rtlmode){let l=y.visual.margin.x+this.rowPadding+1,g=this.canvasWidth-this.sentNumMargin-l;n.attr("x",g),n.attr("textLength",l);let v=Math.max(a-o,0),d=v;i.attr("x",v),i.attr("textLength",d)}else{let l=this.sentNumMargin,g=y.visual.margin.x+this.rowPadding+1;n.attr("x",l),n.attr("textLength",g);let v=a+o+1,d=this.canvasWidth-v;i.attr("x",v),i.attr("textLength",d)}}}renderAdjustLayoutInterRowSpacers(t,e,s){let n={y:0,height:0},i=$(s.node).children(".text-row");i.each((o,a)=>{let l={y:parseFloat($(a).children()[0].getAttribute("y"))+2,height:t.sizes.texts.height},g=l.y-(n.y+l.height)+2,v=this.verticalSpacer(Math.floor(n.y),Math.ceil(g));if(v&&a.before(v),n=l,o===i.length-1){let d=Math.floor(l.y+l.height),p=this.verticalSpacer(Math.floor(l.y+l.height),Math.ceil(e-d)+1);p&&a.after(p)}})}renderDataReal(t){if(!this.svgContainer.ownerDocument.contains(this.svg.node)){console.trace("Recieved render request for stale SVG that is no longer on the page. Ignoring.");return}try{if(I.profileEnd("before render"),I.profileStart("render"),this.dispatcher.post("startedRendering",[this.args]),!t&&!this.data){this.dispatcher.post("doneRendering",[this.args]);return}if(this.svgContainer.style.visibility="visible",this.drawing){this.redraw=!0,this.dispatcher.post("doneRendering",[this.args]);return}if(t&&this.setData(t),this.selectionInProgress){this.dataChangedButNotRendered=!0;return}if(this.redraw=!1,this.drawing=!0,this.data&&(this.renderText(this.data),this.markedText.sort((u,m)=>I.cmp(u[0],m[0])),this.applyMarkedTextToChunks(this.markedText,this.data.chunks)),this.svg.clear(),this.svg.attr("direction",null),!this.data||!this.sourceData)return;I.profileStart("init"),this.rtlmode&&this.svg.attr("direction","rtl"),this.svg.attr("style",`font-size: ${this.fontZoom}%;`),this.sentNumMargin=40*(this.fontZoom/100);let e=xi(this.svg.node),s=$(this.svgContainer).width();this.baseCanvasWidth=s,this.canvasWidth=s-(e?0:Dn()),this.addHeaderAndDefs();let n=this.svg.group().addClass("background").attr("pointer-events","none"),i=this.svg.group().addClass("sentnum").addClass("unselectable");this.highlightGroup=this.svg.group().addClass("highlights");let o=this.svg.group().addClass("text").addClass("contain-selection");I.profileEnd("init"),I.profileStart("measures"),this.data.sizes=this.calculateTextMeasurements(this.data),this.adjustTowerAnnotationSizes(this.data);let a=this.calculateMaxTextWidth(this.data.sizes);I.profileEnd("measures"),I.profileStart("chunks"),this.renderLayoutFloorsAndCurlies(this.data,this.data.spanDrawOrderPermutation);let[l,g,v]=this.renderChunks(this.data,this.sourceData,this.data.chunks,a);I.profileEnd("chunks"),I.profileStart("arcsPrep"),this.renderBumpFragmentHeightsMinimumToArcStartHeight(g),this.renderCalculateArcJumpHeight(this.data,g),this.renderSortArcs(this.data),this.renderAssignFragmentsToRows(l,g),I.profileEnd("arcsPrep"),I.profileStart("arcs"),this.renderArcs(this.data,l,g),I.profileEnd("arcs"),I.profileStart("fragmentConnectors"),this.renderFragmentConnectors(this.data,l),I.profileEnd("fragmentConnectors"),I.profileStart("rows");let d=this.renderRows(this.data,l,i,n);I.profileEnd("rows"),I.profileStart("chunkFinish"),this.renderChunksPass2(this.data,o,v),I.profileEnd("chunkFinish"),I.profileStart("finish"),I.profileStart("adjust margin"),this.renderAdjustMargin(d,i),I.profileEnd("adjust margin"),I.profileStart("resize SVG");let p=this.renderResizeSvg(this.data,d,o,a);I.profileEnd("resize SVG"),I.profileStart("adjust for oversize depending on script"),this.renderAdjustLayoutForScriptDirection(p,l,o,i),I.profileEnd("adjust for oversize depending on script"),I.profileStart("adjust backgrounds"),this.renderAdjustBackgroundsForOversize(p,n),I.profileEnd("adjust backgrounds"),I.profileStart("row-spacing-adjust"),this.renderAdjustLayoutRowSpacing(this.data,o),I.profileEnd("row-spacing-adjust"),I.profileStart("inter-row space"),this.renderAdjustLayoutInterRowSpacers(this.data,d,o),I.profileEnd("inter-row space"),I.profileEnd("finish"),I.profileEnd("render"),I.profileReport(),this.drawing=!1,this.redraw&&(this.redraw=!1),this.dispatcher.post("doneRendering",[this.args])}catch(e){this.drawing=!1,console.error("Rendering terminated due to: "+e,e.stack)}}renderAdjustMargin(t,e){let s;this.rtlmode?s=[["M",this.canvasWidth-this.sentNumMargin,0],["L",this.canvasWidth-this.sentNumMargin,t]]:s=[["M",this.sentNumMargin,0],["L",this.sentNumMargin,t]],this.svg.path(s).addTo(e)}renderData(t){I.profileEnd("invoke getDocument"),t&&$l(t),this.renderDataReal(t)}rerender(){this.renderDataReal(this.sourceData)}renderDataPatch(t){I.profileEnd("invoke getDocument");try{this.sourceData=De(this.sourceData,t).newDocument,this.rerender()}catch(e){console.warn("Error applying patch - reloading annotations",e),this.dispatcher.post("loadAnnotations",[])}}renderDocument(){I.profileStart("invoke getDocument"),this.dispatcher.post("ajax",[{action:"getDocument"},"renderData"])}triggerRender(){if(this.svg&&(this.isRenderRequested&&this.isCollectionLoaded||this.requestedData)){if(this.isRenderRequested=!1,this.requestedData){I.profileClear(),I.profileStart("before render"),this.renderData(this.requestedData);return}I.profileClear(),I.profileStart("before render"),this.renderDocument()}}requestRenderData(t){this.requestedData=t,this.triggerRender()}collectionChanged(){this.isCollectionLoaded=!1}loadAnnotations(){this.isRenderRequested=!0,this.triggerRender()}onMouseOutSpan(t){if(!this.data)return;let s=$(t.target).attr("data-span-id"),n=this.data.spans[s];n.hidden||t.target&&t.target.dispatchEvent(new Gt({vid:s,layer:{id:n.type,name:I.spanDisplayForm(this.entityTypes,n.type)}},t.originalEvent))}onMouseOverSpan(t){if(!this.data)return;let e=$(t.target),s=e.attr("data-span-id"),n=this.data.spans[s];if(n.hidden)return;if(t.target){let v=new Ct;v.vid=s,v.document={text:this.data.text},v.layer={id:n.type,name:I.spanDisplayForm(this.entityTypes,n.type)},n.comment&&(n.comment.type==="AnnotationError"?v.comments=[{type:"error",comment:n.comment.text}]:v.comments=[{type:"info",comment:n.comment.text}]),t.target.dispatchEvent(new Tt(v,t.originalEvent))}n.actionButtons&&this.dispatcher.post("displaySpanButtons",[t,e]),this.renderHighlightBoxes(n);let i={},o={};o[s]=!0;let a=v=>{if(v.equiv){i[v.eventDescId.substr(0,v.eventDescId.indexOf("*",2)+1)]=!0;let d=this.data.eventDescs[v.eventDescId];for(let p of d.leftSpans.concat(d.rightSpans))o[p]=!0}else o[v.origin]=!0};n.incoming.map(v=>a(v)),n.outgoing.map(v=>a(v)),this.highlightArcs=this.svg.find(`g[data-from="${s}"], g[data-to="${s}"]`).map(v=>v.addClass("highlight"));let l=Object.keys(i).map(v=>`[data-arc-ed^="${v}"]`);l.length&&this.highlightArcs.push(...this.svg.find(l.join(", ")).map(v=>{var d;return(d=v.parent())==null||d.addClass("highlight"),v}));let g=Object.keys(o).map(v=>`[data-span-id="${v}"]`);g.length&&this.svg.find(g.join(", ")).map(v=>{var d;return(d=v.parent())==null||d.addClass("highlight"),v})}renderHighlightBoxes(t){if(t.hidden)return;let e=this.entityTypes[t.type],s=t.color||e&&e.bgColor||"#ffffff";this.highlight=[];for(let n of t.fragments)this.renderHighlightBox(n,s)}renderHighlightBox(t,e){if(!t.highlightPos)return;let s=this.svg.rect(t.highlightPos.w,t.highlightPos.h).translate(t.highlightPos.x,t.highlightPos.y).fill(e).opacity(.75).attr({rx:this.highlightRounding.x,ry:this.highlightRounding.y}).addTo(this.highlightGroup);this.highlight.push(s)}onMouseOutArc(t){if(!this.data)return;let e=$(t.target),s=e.attr("data-arc-origin"),n=e.attr("data-arc-role"),i=e.attr("data-arc-ed"),o;i&&this.data.eventDescs[i].relation&&(o=i);let a=this.data.spans[s].type||"";if(o&&t.target){let l=I.arcDisplayForm(this.entityTypes,a,n,this.relationTypes);t.target.dispatchEvent(new Gt({vid:o,layer:{id:n,name:l}},t.originalEvent))}}onMouseOverArc(t){if(!this.data)return;let e=$(t.target),s=e.attr("data-arc-origin"),n=e.attr("data-arc-target"),i=e.attr("data-arc-role"),o=this.relationTypes&&this.relationTypes[i]&&this.relationTypes[i].properties&&this.relationTypes[i].properties.symmetric,a=e.attr("data-arc-ed"),l="",g="",v;if(a){let p=this.data.eventDescs[a],u=p.comment;u&&(l=u.text,g=u.type,l===""&&g&&(l=g)),p.relation&&(v=a)}let d=this.data.spans[s].type||"";if(v){if(t.target){let p=new Dt;p.vid=v;let u=I.arcDisplayForm(this.entityTypes,d,i,this.relationTypes);p.layer={id:i,name:u},l&&(g==="AnnotationError"?p.comments=[{type:"error",comment:l}]:p.comments=[{type:"info",comment:l}]),t.target.dispatchEvent(new Tt(p,t.originalEvent))}this.highlightArcs=this.svg.find(`g[data-id="${v}"]`).map(p=>p.addClass("highlight"))}else this.highlightArcs=this.svg.find(`g[data-from="${s}"][data-to="${n}"]`).map(p=>p.addClass("highlight"));this.svg.find(`[data-span-id="${s}"], [data-span-id="${n}"]`).map(p=>{var u;return(u=p.parent())==null||u.addClass("highlight"),p})}onMouseOverSentence(t){if(!this.data||!(t.target instanceof Element))return;let e=t.target.getAttribute("data-sent");if(e){let s=this.data.sentComment[e];if(s&&t.target){let n=new Ct;n.vid=s.id,n.document={text:this.data.text},n.layer={id:0,name:I.spanDisplayForm(this.entityTypes,s.type)},t.target.dispatchEvent(new Tt(n,t.originalEvent))}}}onMouseOver(t){if(!(t.target instanceof Element))return;let e=t.target;if(e.getAttribute("data-span-id")){this.onMouseOverSpan(t);return}if(e.getAttribute("data-arc-role")){this.onMouseOverArc(t);return}e.getAttribute("data-sent")&&this.onMouseOverSentence(t)}onMouseOut(t){if(!(t.target instanceof Element))return;let e=t.target;if(e.classList.remove("badTarget"),this.highlight&&(this.highlight.map(s=>s.remove()),this.highlight=[]),this.svg.node.querySelectorAll(".highlight").forEach(s=>s.classList.remove("highlight")),this.highlightArcs=void 0,e.getAttribute("data-span-id")){this.onMouseOutSpan(t);return}e.getAttribute("data-arc-role")&&this.onMouseOutArc(t)}onSelectionStarted(){this.selectionInProgress=!0}onSelectionEnded(){this.selectionInProgress=!1,this.dataChangedButNotRendered&&(this.dataChangedButNotRendered=!1,setTimeout(()=>this.rerender(),50))}setAbbrevs(t){y.abbrevsOn=t,this.dispatcher.post("configurationChanged")}setTextBackgrounds(t){y.textBackgrounds=t,this.dispatcher.post("configurationChanged")}setLayoutDensity(t){t<2?(y.visual.margin={x:1,y:0},y.visual.boxSpacing=1,y.visual.curlyHeight=1,y.visual.arcSpacing=7,y.visual.arcStartHeight=18):t>2?(y.visual.margin={x:2,y:1},y.visual.boxSpacing=3,y.visual.curlyHeight=6,y.visual.arcSpacing=12,y.visual.arcStartHeight=23):(y.visual.margin={x:2,y:1},y.visual.boxSpacing=1,y.visual.curlyHeight=4,y.visual.arcSpacing=9,y.visual.arcStartHeight=19),this.dispatcher.post("configurationChanged")}setSvgWidth(t){this.svg.attr("width",`${t}`),y.svgWidth!==t&&(y.svgWidth=t,this.dispatcher.post("configurationChanged"))}registerHandlers(t,e){let s=$(t);for(let n of e)s.bind(n,i=>this.dispatcher.post(n,[i],"all"))}loadSpanTypes(t){for(let e of t)if(e){this.entityTypes[e.type]=e;let s=e.children;s&&s.length&&this.loadSpanTypes(s)}}loadAttributeTypes(t){let e={};return $.each(t,(s,n)=>{e[n.type]=n;let i=[];for(let o in n.values)Object.prototype.hasOwnProperty.call(n.values,o)&&i.push(o);i.length===1&&(n.bool=i[0])}),e}loadRelationTypes(t){for(let e of t)if(e){this.relationTypes[e.type]=e;let s=e.children;s&&s.length&&this.loadRelationTypes(s)}}collectionLoaded(t){jl(t),this.entityTypes={},this.loadSpanTypes(t.entity_types),this.relationTypes={},this.loadRelationTypes(t.relation_types);let e=(t.visual_options||{}).arc_bundle||"none";this.collapseArcs=e==="all",this.collapseArcSpace=e!=="none",this.dispatcher.post("spanAndAttributeTypesLoaded",[this.entityTypes,this.entityAttributeTypes,this.eventAttributeTypes,this.relationTypes]),this.isCollectionLoaded=!0,this.triggerRender()}isReloadOkay(){return!this.drawing}verticalSpacer(t,e){if(e>0){let s=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),n=document.createElement("span");return $(n).addClass("unselectable").css("display","inline-block").css("width","100%").css("height","100%").text("\xA0"),$(s).attr("x",this.rtlmode?0:this.sentNumMargin).attr("y",t).attr("width",this.rtlmode?this.canvasWidth-this.sentNumMargin:this.canvasWidth).attr("height",e).append(n),s}}horizontalSpacer(t,e,s,n,i){n<=0||this.svg.plain(this.rtlmode?"\u200F\xA0":"\xA0").amove(e,s).addClass("spacing").attr({textLength:n,lengthAdjust:"spacingAndGlyphs"}).attr(i).addTo(t)}renderArcShadow(t,e,s){return this.svg.rect().move(s.x-this.arcLabelShadowSize,s.y-this.arcLabelShadowSize).width(s.width+2*this.arcLabelShadowSize).height(s.height+2*this.arcLabelShadowSize).attr({class:"shadow_"+t.shadowClass,filter:"url(#Gaussian_Blur)",rx:this.arcLabelShadowRounding,ry:this.arcLabelShadowRounding}).addTo(e)}renderSpanMarkedRect(t,e,s,n,i,o){return this.svg.rect(n+2*this.markedSpanSize,i+2*this.markedSpanSize).addClass("marked-rect").move(e-this.markedSpanSize,t-this.markedSpanSize-y.visual.margin.y-o.span.floor).attr({filter:"url(#Gaussian_Blur)",class:"shadow_EditHighlight",rx:this.markedSpanSize,ry:this.markedSpanSize}).addTo(o.chunk.highlightGroup)}renderFragmentShadowRect(t,e,s,n,i,o){return this.svg.rect().addClass("fragment-shadow").move(e-this.rectShadowSize,t-this.rectShadowSize-y.visual.margin.y-o.span.floor).width(n+2*this.rectShadowSize).height(i+2*this.rectShadowSize).attr({class:"shadow_"+o.span.shadowClass,filter:"url(#Gaussian_Blur)",rx:this.rectShadowRounding,ry:this.rectShadowRounding}).addTo(o.group)}renderFragmentRect(t,e,s,n,i,o,a,l,g){let v=o.span,d=t,p=d+s,u=i-y.visual.margin.y-v.floor,m=u+n,f=[];return v.clippedAtStart&&v.fragments[0]===o?(f.push([d,m]),f.push([d-n/2,(u+m)/2]),f.push([d,u])):(f.push([d,m]),f.push([d,u])),v.clippedAtEnd&&v.fragments[v.fragments.length-1]===o?(f.push([p,u]),f.push([p+n/2,(u+m)/2]),f.push([p,m])):(f.push([p,u]),f.push([p,m])),this.svg.polygon(f).addClass(a).addClass("fragment").fill(l).stroke({color:g,dasharray:v.attributeMerge.dashArray}).attr({rx:y.visual.margin.x,ry:y.visual.margin.y,"data-span-id":v.id,"data-fragment-id":v.segmentedOffsetsMap[o.id]}).addTo(o.group)}renderFragmentCrossOut(t,e,s,n){let i=n.span;this.svg.path([["M",t,e-y.visual.margin.y-i.floor],["L",t+n.width,e+s+y.visual.margin.y-i.floor]]).addClass("boxcross").addTo(n.group),this.svg.path([["M",t+n.width,e-y.visual.margin.y-i.floor],["L",t,e+s+y.visual.margin.y-i.floor]]).addClass("boxcross").addTo(n.group)}renderCurly(t,e,s,n){let i=t.span,o="grey";if(this.coloredCurlies){let g=this.entityTypes[i.type],v;i.color?v=i.color:v=g&&g.bgColor||"#000000",o=I.adjustColorLightness(v,-.6)}let a=s+n+y.visual.margin.y-i.floor+1,l=y.visual.curlyHeight;this.svg.path([["M",t.curly.from,a+l],["C",t.curly.from,a,e,a+l,e,a],["C",e,a+l,t.curly.to,a,t.curly.to,a+l]]).attr({class:"curly",stroke:o}).addTo(t.group)}getChunkAtOffset(t){var e,s;return((s=(e=this.data)==null?void 0:e.chunks)==null?void 0:s.find(n=>n.from<=t&&t<n.to))||null}getChunkElementWithId(t){return this.svg.node.querySelector(`text:not(.spacing)[data-chunk-id="${t}"]`)}getHighlightElementsForSpan(t){return this.svg.node.querySelectorAll(`[data-span-id="${t}"]`)}selectionToOffsets(t){if(!t||!t.rangeCount)return null;let e=t.getRangeAt(0).startContainer,s=t.getRangeAt(0).startOffset,n=t.getRangeAt(t.rangeCount-1).endContainer,i=t.getRangeAt(t.rangeCount-1).endOffset;if(!e||!n)return null;let o=new Range;return o.setStart(e,s),o.setEnd(n,i),this.rangeToOffsets(o)}rangeToOffsets(t){var p,u,m;if(!t||!this.data)return null;let e=we(t.startContainer),s=t.startOffset,n=we(t.endContainer),i=t.endOffset;if(!e||!n)return null;let o=e.getAttribute("data-chunk-id"),a=n.getAttribute("data-chunk-id");if(n===e&&n.classList.contains("spacing")?s===0?(e=n=e.previousElementSibling,s=i=((p=e==null?void 0:e.textContent)==null?void 0:p.length)||0,o=a=(e==null?void 0:e.getAttribute("data-chunk-id"))||null):(e=n=e.nextElementSibling,s=i=0,o=a=(e==null?void 0:e.getAttribute("data-chunk-id"))||null):(e.classList.contains("spacing")&&(Number(o)<Number(a)?(e=e.nextElementSibling||null,s=0,o=(e==null?void 0:e.getAttribute("data-chunk-id"))||null):e.classList.contains("row-initial")?(e=e.nextElementSibling||null,s=0):(e=e.previousElementSibling||null,s=((u=e==null?void 0:e.textContent)==null?void 0:u.length)||0)),n.classList.contains("spacing")&&(Number(o)>Number(a)?(n=n.nextElementSibling||null,i=0,a=(n==null?void 0:n.getAttribute("data-chunk-id"))||null):n.classList.contains("row-initial")?(n=n.nextElementSibling||null,i=0):(n=n.previousElementSibling||null,i=((m=n==null?void 0:n.textContent)==null?void 0:m.length)||0))),o===null||a===null)return null;let l=this.data.chunks[Number(o)],g=this.data.chunks[Number(a)],v=l.from+s,d=g.from+i;if(v>d){let f=v;v=d,d=f}for(;v<d&&` 
	`.indexOf(this.data.text.substr(v,1))!==-1;)v++;for(;v<d&&` 
	`.indexOf(this.data.text.substr(d-1,1))!==-1;)d--;return[v,d]}};function we(r){return r instanceof Text&&(r=r.parentElement),r instanceof Element?r.closest("[data-chunk-id]"):null}function Vl(r){let t=r>=1425&&r<=2047,e=r===8207,s=r===8238,n=r>=64285&&r<=65021,i=r>=65136&&r<=65276;return t||e||s||n||i}function Wl(r){let t=parseInt(r.substr(1,2),16),e=parseInt(r.substr(3,2),16),s=parseInt(r.substr(5,2),16);return(t*299+e*587+s*114)/1e3>=128?"#000000":"#ffffff"}function bi(r){return r===null||r.tagName==="HTML"?null:r instanceof HTMLElement&&(r.style.overflowX==="auto"&&r.scrollWidth>r.clientWidth||r.style.overflowX==="scroll")?r:r.classList.contains("scrollable")?null:bi(r.parentElement)}function xi(r){return r===null||r.tagName==="HTML"?null:r instanceof HTMLElement&&(r.style.overflowY==="auto"&&r.scrollHeight>r.clientHeight||r.style.overflowY==="scroll")?r:r.classList.contains("scrollable")?null:xi(r.parentElement)}function Xl(r){let t=[],e=null,s=null;for(let n=0;n<r.length;n++){let i=r[n];e==null&&!/\s/.test(i)?(e=n,s=n):/\s/.test(i)&&e!=null?(t.push([e,n]),e=null):/\s/.test(i)||(s=n)}return e!==null&&s!==null&&t.push([e,s+1]),t}function Ll(r){let t=[],e=null,s=-1;for(let n=0;n<r.length;n++){let i=r[n];e==null&&!/\s/.test(i)?(e=n,s=n):i===`
`&&e!=null?(t.push([e,n]),e=null):/\s/.test(i)||(s=n)}return e!=null&&t.push([e,s+1]),t}var Qe=class{constructor(t,e){c(this,"spanTypes",{});c(this,"relationTypesHash",{});c(this,"data",null);c(this,"dispatcher");c(this,"ajax");c(this,"displayButtonsTimer");c(this,"buttonsShown",!1);c(this,"resizerTimeout");console.debug("Setting up brat visualizer-ui module..."),this.ajax=e,this.dispatcher=t,this.dispatcher.on("init",this,this.init).on("dataReady",this,this.rememberData).on("resize",this,this.onResize).on("spanAndAttributeTypesLoaded",this,this.spanAndAttributeTypesLoaded).on("doneRendering",this,this.onDoneRendering).on("displaySpanButtons",this,this.displaySpanButtons).on("acceptButtonClicked",this,this.acceptAction).on("rejectButtonClicked",this,this.rejectAction).on("contextmenu",this,this.contextMenu)}acceptAction(t,e,s,n){t.preventDefault(),this.dispatcher.post("ajax",[{action:"acceptAction",offsets:JSON.stringify(e),id:n,labelText:s.labelText,type:s.type}])}rejectAction(t,e,s,n){t.preventDefault(),this.dispatcher.post("ajax",[{action:"rejectAction",offsets:JSON.stringify(e),id:n,labelText:s.labelText,type:s.type}])}displaySpanButtons(t,e){let s=e.attr("data-span-id");if(!s)return;let n=e.position(),i=e.width(),o=e.height(),a=this.data.spans[s],l=[];$.each(a.fragments,(p,u)=>{l.push([u.from,u.to])});let g=$('<button class="span_accept_btn">Accept</button>').css({top:0,left:0,width:45,height:o}).on("click",p=>{this.dispatcher.post("acceptButtonClicked",[p,l,a,s])}),v=$('<button class="span_reject_btn">Reject</button>').css({top:0,right:0,width:45,height:o}).on("click",p=>{this.dispatcher.post("rejectButtonClicked",[p,l,a,s])}),d=$("#span_btns_wrapper").css({top:n.top,left:n.left-g.width(),width:g.width()*2+i}).mouseleave(this.hideSpanButtons);clearTimeout(this.displayButtonsTimer),this.displayButtonsTimer=setTimeout(()=>{d.empty().append(g).append(v),this.buttonsShown=!0,d.show()},100)}hideSpanButtons(){$("#span_btns_wrapper:hover").length==0&&(clearTimeout(this.displayButtonsTimer),this.buttonsShown&&($("#span_btns_wrapper").empty().hide(),this.buttonsShown=!1))}onDoneRendering(t){if(t&&!t.edited){let e=$('#svg animate[data-type="focus"]:first').parent();if(e.length){let s=$("svg").offset().top;$("html,body").animate({scrollTop:e.offset().top-s-window.innerHeight/2},{duration:"slow",easing:"swing"})}}}onResize(t){(!t||t.target===window)&&(clearTimeout(this.resizerTimeout),this.resizerTimeout=setTimeout(()=>this.dispatcher.post("rerender"),300))}init(){this.dispatcher.post("ajax",[{action:"loadConf"},t=>{t.config!==void 0&&(Object.assign(y,t.config),this.dispatcher.post("svgWidth",[y.svgWidth])),this.dispatcher.post("configurationUpdated")}])}spanAndAttributeTypesLoaded(t,e,s,n){this.spanTypes=t,this.relationTypesHash=n}isReloadOkay(){return!0}rememberData(t){t&&!t.exception&&(this.data=t)}contextMenu(t){if(t.shiftKey)return;let e=$(t.target),s,n;e.attr("data-arc-ed")&&(s=e.attr("data-arc-ed"),n=e.attr("data-arc-role")),e.attr("data-span-id")&&(s=e.attr("data-span-id"),n=this.data.spans[s].type),s&&(t.preventDefault(),this.dispatcher.post("ajax",[{action:"contextMenu",id:s,type:n,clientX:t.clientX,clientY:t.clientY}]))}};var Ks=class{constructor(){c(this,"colors",{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgrey:[211,211,211],lightgreen:[144,238,144],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,216],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[216,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]});c(this,"rgbNumRE",/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/);c(this,"rgbPercRE",/rgb\(\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*,\s*([0-9]+(?:\.[0-9]+)?)%\s*\)/);c(this,"rgbHash6RE",/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/);c(this,"rgbHash3RE",/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/);c(this,"adjustLightnessCache",{});c(this,"keyValRE",/^([^=]+)=(.*)$/);c(this,"isDigitsRE",/^[0-9]+$/);c(this,"profiles",{});c(this,"profileStarts",{});c(this,"profileOn",!1)}cmp(t,e){return t<e?-1:t>e?1:0}cmpArrayOnFirstElement(t,e){let s=t[0],n=e[0];return s<n?-1:s>n?1:0}realBBox(t){let e=t.rect.bbox(),s=t.chunk.translation,n=t.chunk.row.translation;return e.x+=s.x+n.x,e.y+=s.y+n.y,e}escapeHTML(t){return t===null?null:t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}escapeHTMLandQuotes(t){return t===null?null:t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}escapeHTMLwithNewlines(t){return t===null?null:t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>")}escapeQuotes(t){return t===null?null:t.replace(/"/g,"&quot;")}getSpanLabels(t,e){let s=t[e];return s&&s.labels||[]}spanDisplayForm(t,e){let s=this.getSpanLabels(t,e);if(s[0])return s[0];let n=e.indexOf("_");return n>=0?e.substring(n+1):e}getArcLabels(t,e,s,n){let i=t[e],o=i&&i.arcs||[],a=null,l;s&&(l=s.match(/^(.*?)(\d*)$/)[1]);for(let g of o)if(g.type===s||g.type===l){a=g;break}return!a&&l&&(a=Object.assign({},n[s]||n[l])),a&&a.labels.map(g=>"("+g+")")||[]}arcDisplayForm(t,e,s,n){return this.getArcLabels(t,e,s,n)[0]||s}strToRgb(t){let e;return e=this.rgbNumRE.exec(t),e?[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]:(e=this.rgbPercRE.exec(t),e?[parseFloat(e[1])*2.55,parseFloat(e[2])*2.55,parseFloat(e[3])*2.55]:(e=this.rgbHash6RE.exec(t),e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:(e=this.rgbHash3RE.exec(t),e?[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]:this.colors[t&&t.trim().toLowerCase()||""])))}rgbToStr(t){let e=Math.floor(t[0]).toString(16),s=Math.floor(t[1]).toString(16),n=Math.floor(t[2]).toString(16);return e=e.length<2?"0"+e:e,s=s.length<2?"0"+s:s,n=n.length<2?"0"+n:n,"#"+e+s+n}rgbToHsl(t){let e=t[0]/255,s=t[1]/255,n=t[2]/255,i=Math.max(e,s,n),o=Math.min(e,s,n),a=(i+o)/2,l,g;if(i===o)l=g=0;else{let v=i-o;switch(g=a>.5?v/(2-i-o):v/(i+o),i){case e:l=(s-n)/v+(s<n?6:0);break;case s:l=(n-e)/v+2;break;default:l=(e-s)/v+4;break}l/=6}return[l,g,a]}hue2rgb(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+(e-t)*6*s:s<1/2?e:s<2/3?t+(e-t)*(2/3-s)*6:t}hslToRgb(t){let e=t[0],s=t[1],n=t[2],i,o,a;if(s===0)i=o=a=n;else{let l=n<.5?n*(1+s):n+s-n*s,g=2*n-l;i=this.hue2rgb(g,l,e+1/3),o=this.hue2rgb(g,l,e),a=this.hue2rgb(g,l,e-1/3)}return[i*255,o*255,a*255]}adjustColorLightness(t,e){if(t in this.adjustLightnessCache||(this.adjustLightnessCache[t]={}),!(e in this.adjustLightnessCache[t])){let s=this.strToRgb(t);if(s===void 0)this.adjustLightnessCache[t][e]=t;else{let n=this.rgbToHsl(s);e>0?n[2]=1-(1-n[2])*(1-e):n[2]=(1+e)*n[2];let i=this.hslToRgb(n);this.adjustLightnessCache[t][e]=this.rgbToStr(i)}}return this.adjustLightnessCache[t][e]}profileEnable(t){t===void 0&&(t=!0),this.profileOn=t}profileClear(){this.profileOn&&(this.profiles={},this.profileStarts={})}profileStart(t){this.profileOn&&(this.profileStarts[t]=new Date)}profileEnd(t){if(!this.profileOn)return;if(!this.profileStarts[t]){console.log(`profileEnd(${t}) called without profileStart`);return}let e=new Date().valueOf()-this.profileStarts[t].valueOf();this.profiles[t]||(this.profiles[t]=0),this.profiles[t]+=e}profileReport(){this.profileOn&&window.console&&($.each(this.profiles,(t,e)=>{console.log("profile "+t,e)}),console.log("-------"))}embed(t,e,s,n,i){let o=new Se;return new Ze(o,t),new Qe(o,e),n.collection=null,i&&i(o),o.post("collectionLoaded",[s]),o.post("requestRenderData",[n]),o}embedByURL(t,e,s,n,i){let o,a,l=()=>{o&&a&&this.embed(t,e,o,a,i)};typeof t=="string"?$.getJSON(s,g=>{o=g,l()}):o=s,$.getJSON(n,g=>{a=g,l()})}},I=new Ks;var ls=class{constructor(t,e,s){c(this,"data");c(this,"arcDragOrigin");c(this,"arcDragOriginBox");c(this,"arcDragOriginGroup");c(this,"arcDragArc");c(this,"arcDragJustStarted",!1);c(this,"spanDragJustStarted",!1);c(this,"dragStartedAt");c(this,"selectionInProgress",!1);c(this,"arcOptions");c(this,"spanTypes");c(this,"selRect",null);c(this,"lastStartRec",null);c(this,"lastEndRec",null);c(this,"draggedArcHeight",30);c(this,"svg");c(this,"dispatcher");c(this,"svgPosition");c(this,"clickCount",0);c(this,"clickTimer",null);c(this,"CLICK_DELAY",300);c(this,"ajax");c(this,"visualizer");console.debug("Setting up annotator-ui editor..."),this.dispatcher=t,this.svg=e.svg,this.visualizer=e,this.ajax=s,t.on("dataReady",this,this.rememberData).on("spanAndAttributeTypesLoaded",this,this.spanAndAttributeTypesLoaded).on("isReloadOkay",this,this.isReloadOkay).on("keydown",this,this.onKeyDown).on("click",this,this.onClick).on("dragstart",this,n=>n.preventDefault()).on("mousedown",this,this.onMouseDown).on("mouseup",this,this.onMouseUp).on("mousemove",this,this.onMouseMove).on("contextmenu",this,this.contextMenu)}clearSelection(){var t;(t=window.getSelection())==null||t.removeAllRanges(),this.selRect&&(this.selRect.forEach(e=>e.remove()),this.selRect=null,this.lastStartRec=null,this.lastEndRec=null)}makeSelRect(t,e,s,n,i){let o=document.createElementNS("http://www.w3.org/2000/svg","rect");return o.setAttributeNS(null,"width",s.toString()),o.setAttributeNS(null,"height",n.toString()),o.setAttributeNS(null,"x",t.toString()),o.setAttributeNS(null,"y",e.toString()),o.setAttributeNS(null,"fill",i===void 0?"lightblue":i),o}onKeyDown(t){t.code==="Escape"&&this.stopArcDrag()}onClick(t){this.clickCount++;let e=y.singleClickEdit?this.selectAnnotation:this.handleExtensionAction,s=y.singleClickEdit?this.handleExtensionAction:this.selectAnnotation;if(this.clickCount===1)this.clickTimer=window.setTimeout(()=>{try{e.call(this,t)}finally{this.clickCount=0}},this.CLICK_DELAY);else{this.clickTimer!==null&&clearTimeout(this.clickTimer);try{s.call(this,t)}finally{this.clickCount=0}}}handleExtensionAction(t){if(!(t.target instanceof Element))return;let e=t.target.getAttribute("data-span-id")||t.target.getAttribute("data-arc-ed");e&&(t.preventDefault(),this.ajax.triggerExtensionAction(e))}selectAnnotation(t){if(!this.arcDragOrigin){if(t.target.getAttribute("data-arc-role")){this.selectRelation(t);return}t.target.getAttribute("data-span-id")&&this.selectSpan(t)}}selectRelation(t){this.clearSelection();let e=t.target.getAttribute("data-arc-origin"),s=t.target.getAttribute("data-arc-target"),n=t.target.getAttribute("data-arc-role");this.arcOptions={origin:e!==null?e:void 0,target:s!==null?s:void 0,old_target:s!==null?s:void 0,type:n!==null?n:void 0};let i=t.target.getAttribute("data-arc-ed");i&&this.ajax.selectAnnotation(i)}selectSpan(t){if(!(t.target instanceof Element))return;let e=t.target.getAttribute("data-span-id");e&&(this.clearSelection(),this.ajax.selectAnnotation(e))}startArcDrag(t){if(this.clearSelection(),!t)return;let e=this.data.spans[t];if(!e){console.warn(`Unable to find origin entity with id ${t}`);return}if(!e.headFragment.group){console.warn("Origin entity has no head-fragment group",e);return}this.svg.addClass("unselectable"),this.svgPosition=$(this.svg.node).offset(),this.arcDragOrigin=t,this.arcDragArc=this.svg.path().fill("none").attr("marker-end","url(#drag_arrow)").addClass("drag_stroke"),this.arcDragOriginGroup=e.headFragment.group,this.arcDragOriginGroup.addClass("highlight"),this.arcDragOriginBox=I.realBBox(e.headFragment),this.arcDragJustStarted=!0}onMouseDown(t){return t.button===2||!(t.target instanceof Element)||this.arcDragOrigin?!0:t.target.getAttribute("data-span-id")?(this.dragStartedAt=t,this.selectionInProgress=!0,this.dispatcher.post("selectionStarted"),!1):(t.target.getAttribute("data-chunk-id")&&(this.spanDragJustStarted=!0,this.selectionInProgress=!0,this.dispatcher.post("selectionStarted")),!0)}onMouseMove(t){if(!t.buttons&&this.selectionInProgress&&this.dispatcher.post("selectionEnded"),this.arcDragOrigin&&!t.buttons){this.stopArcDrag(),this.arcDragJustStarted=!1;return}if(!this.arcDragOrigin&&this.dragStartedAt){let e=Math.abs(this.dragStartedAt.pageX-t.pageX),s=Math.abs(this.dragStartedAt.pageY-t.pageY);if(e>5||s>5){this.arcOptions=void 0;let n=this.dragStartedAt.target;this.startArcDrag(n.getAttribute("data-span-id"))}}this.arcDragOrigin?this.onMouseMoveArcCreation(t):this.onMouseMoveSpanSelection(t),this.arcDragJustStarted=!1,this.spanDragJustStarted=!1}onMouseMoveArcCreation(t){this.arcDragJustStarted&&this.initializeArcDragTargets(t),this.clearSelection();let e=t.pageX-this.svgPosition.left,s=t.pageY-this.svgPosition.top,n=Math.min(this.arcDragOriginBox.y,s)-this.draggedArcHeight,i=this.arcDragOriginBox.x+this.arcDragOriginBox.width/2,o=(i-e)/4;this.arcDragArc.plot([["M",i,this.arcDragOriginBox.y],["C",i-o,n,e+o,n,e,s]])}initializeArcDragTargets(t){if(!this.arcDragOrigin)return;let e=this.data.spans[this.arcDragOrigin],s=this.spanTypes[e.type];if(!s||!s.arcs||s.arcs.length===0)return;let n=this.arcOptions&&this.arcOptions.type;s.arcs.map(i=>{(this.arcOptions&&i.type===n||!(this.arcOptions&&this.arcOptions.old_target))&&(!i.targets||i.targets.length===0||i.targets.map(o=>{this.svg.find(".span_"+o).filter(a=>t.shiftKey||!a.hasClass(`[data-span-id="${this.arcDragOrigin}"]`)).map(a=>a.addClass("reselectTarget"))}))})}onMouseMoveSpanSelection(t){var g,v,d,p,u;this.spanDragJustStarted&&this.svg.find(".row, .sentnum").map(m=>m.attr("pointer-events","none"));let e=window.getSelection();if(e===null)return;let s=(g=we(e.anchorNode))==null?void 0:g.getAttribute("data-chunk-id"),n=(v=we(e.focusNode))==null?void 0:v.getAttribute("data-chunk-id"),i=-1,o=-1,a,l;if(s===void 0&&n===void 0&&e.anchorNode instanceof Element&&e.focusNode instanceof Element&&e.anchorNode.getAttribute("data-chunk-id")&&e.focusNode.getAttribute("data-chunk-id")){let m=e.getRangeAt(0),f=$(this.svg.node).offset(),b=!1,x=0;for(;x<2&&(a=this.svg.point((b?t.pageX:this.dragStartedAt.pageX)-f.left,(b?t.pageY:this.dragStartedAt.pageY)-(f.top+8)),l=m.startContainer,i=l.getCharNumAtPosition(a),s=l&&$(l).attr("data-chunk-id"),i===-1);)b=!0,x++;a.x=(b?this.dragStartedAt.pageX:t.pageX)-f.left,a.y=(b?this.dragStartedAt.pageY:t.pageY)-(f.top+8);let k=m.endContainer;if(o=k.getCharNumAtPosition(a),i===-1||o===-1)return;if(m.startContainer===m.endContainer&&i>o){let w=i;i=o,o=w,b=!1}n=k&&k.getAttribute("data-chunk-id");let h=l.getExtentOfChar(i);h.y+=2;let S=k.getExtentOfChar(o);if(S.y+=2,this.lastStartRec!=null&&this.lastStartRec.x===h.x&&this.lastStartRec.y==h.y&&this.lastEndRec!=null&&this.lastEndRec.x==S.x&&this.lastEndRec.y==S.y)return;if(this.selRect==null){let w=h.x,_=h.y,T=S.x+S.width-h.x;T<0&&(w+=T,T=-T);let D=Math.max(h.height,S.height);this.selRect=[];let E=this.makeSelRect(w,_,T,D);this.selRect.push(E),l.parentNode.parentNode.parentNode.insertBefore(E,l.parentNode.parentNode)}else{h.x!=this.lastStartRec.x&&S.x!=this.lastEndRec.x&&(h.y!=this.lastStartRec.y||S.y!=this.lastEndRec.y)&&(h.y<this.lastStartRec.y?(this.selRect[0].setAttributeNS(null,"width",this.lastStartRec.width),this.lastEndRec=this.lastStartRec):S.y>this.lastEndRec.y&&(this.selRect[this.selRect.length-1].setAttributeNS(null,"x",parseFloat(this.selRect[this.selRect.length-1].getAttributeNS(null,"x"))+parseFloat(this.selRect[this.selRect.length-1].getAttributeNS(null,"width"))-this.lastEndRec.width),this.selRect[this.selRect.length-1].setAttributeNS(null,"width",0),this.lastStartRec=this.lastEndRec));let w=!(h.x===((d=this.lastStartRec)==null?void 0:d.x)&&h.y===this.lastStartRec.y);if(S.y!==((p=this.lastEndRec)==null?void 0:p.y)||h.y!==((u=this.lastStartRec)==null?void 0:u.y)){let _=0;for(;_!==this.selRect.length&&!(h.y<=parseFloat(this.selRect[_].getAttributeNS(null,"y")));_++);let T=this.selRect.length-1;for(;T!==-1&&!(S.y>=parseFloat(this.selRect[T].getAttributeNS(null,"y")));T--);let D=!1;if(_<this.selRect.length){for(let E=0;E!==_;E++)this.selRect[E].remove(),T--,D=!0;this.selRect=this.selRect.slice(_)}if(T>-1){for(let E=this.selRect.length-1;E!==T;E--)this.selRect[E].remove(),D=!0;this.selRect=this.selRect.slice(0,T+1)}if(D){let E=w?this.selRect[0]:this.selRect[this.selRect.length-1];if(w){let N=0;h.y===S.y?N=S.x+S.width-h.x:N=parseFloat(E.getAttributeNS(null,"x"))+parseFloat(E.getAttributeNS(null,"width"))-h.x,E.setAttributeNS(null,"x",h.x),E.setAttributeNS(null,"y",h.y),E.setAttributeNS(null,"width",N.toString())}else{let N=S.x+S.width-parseFloat(E.getAttributeNS(null,"x"));E.setAttributeNS(null,"width",N.toString())}}else{let E=w?this.selRect[0]:this.selRect[this.selRect.length-1],N=l.parentNode.getBBox(),A=k.parentNode.getBBox();w?(E.setAttributeNS(null,"width",parseFloat(E.getAttributeNS(null,"x"))+parseFloat(E.getAttributeNS(null,"width"))-A.x),E.setAttributeNS(null,"x",A.x)):E.setAttributeNS(null,"width",N.x+N.width-parseFloat(E.getAttributeNS(null,"x")));let G=0,F=0,Q=0,W=0;w?(G=h.x,F=h.y,Q=$(this.svg.node).width()-h.x,W=h.height):(G=A.x,F=S.y,Q=S.x+S.width-A.x,W=S.height);let rt=this.makeSelRect(G,F,Q,W);w?this.selRect.unshift(rt):this.selRect.push(rt),l.parentNode.parentNode.parentNode.insertBefore(rt,l.parentNode.parentNode)}}else{let _=w?this.selRect[0]:this.selRect[this.selRect.length-1];if(w){let T=parseFloat(_.getAttributeNS(null,"x"))+parseFloat(_.getAttributeNS(null,"width"))-h.x;_.setAttributeNS(null,"x",h.x),_.setAttributeNS(null,"y",h.y),_.setAttributeNS(null,"width",T)}else{let T=S.x+S.width-parseFloat(_.getAttributeNS(null,"x"));_.setAttributeNS(null,"width",T)}}}this.lastStartRec=h,this.lastEndRec=S}}stopArcDrag(t){var e,s;this.dragStartedAt=void 0,this.svg.removeClass("unselectable"),this.svg.removeClass("reselect"),this.svg.node.querySelectorAll(".reselectTarget").forEach(n=>n.classList.remove("reselectTarget")),this.arcDragOrigin&&(t?(t.classList.remove("badTarget"),(e=t==null?void 0:t.parentElement)==null||e.classList.remove("highlight")):this.svg.node.querySelectorAll(".badTarget").forEach(n=>{var i;(i=n.parentElement)==null||i.classList.remove("highlight"),n.classList.remove("badTarget")}),this.arcDragOriginGroup.removeClass("highlight"),(s=this.arcDragArc)==null||s.remove(),this.arcDragOrigin=void 0,this.arcOptions&&$('g[data-from="'+this.arcOptions.origin+'"][data-to="'+this.arcOptions.target+'"]').removeClass("reselect"))}onMouseUp(t){if(!t.buttons&&this.selectionInProgress&&this.dispatcher.post("selectionEnded"),this.svg.find(".row, .sentnum").map(a=>a.attr("pointer-events",null)),!(t.target instanceof Element))return;let e=t.target.getAttribute("data-span-id"),s=t.target.getAttribute("data-chunk-id"),n=t.target.getAttribute("data-arc-role");if(!(e||s)||n){this.clearSelection(),this.stopArcDrag(t.target);return}if(this.arcDragOrigin){this.endArcCreation(t,e);return}if(t.ctrlKey)return;let i=window.getSelection(),o=this.visualizer.selectionToOffsets(i);this.clearSelection(),this.stopArcDrag(t.target),!(!o||o[0]===o[1]&&!t.shiftKey)&&(this.spanDragJustStarted=!1,this.ajax.createSpanAnnotation([o]))}endArcCreation(t,e){if(!(!(t.target instanceof Element)||!this.arcDragOrigin))try{let s=t.target.classList.contains("reselectTarget"),n;if((n=e)&&s&&(t.shiftKey||this.arcDragOrigin!==n)){let i=this.data.spans[this.arcDragOrigin],o=this.data.spans[n];this.arcOptions&&this.arcOptions.old_target?(this.arcOptions.target=o.id,this.dispatcher.post("ajax",[this.arcOptions,"edited"])):(this.arcOptions={origin:i.id,target:o.id},this.ajax.createRelationAnnotation(i.id,o.id,t))}}finally{this.stopArcDrag(t.target)}}rememberData(t){t&&!t.exception&&(this.data=t)}spanAndAttributeTypesLoaded(t,e,s,n){this.spanTypes=t}contextMenu(t){if(t.target instanceof Element){if(t.shiftKey)return;this.stopArcDrag();let e=t.target.getAttribute("data-span-id");e&&(t.preventDefault(),this.ajax.openContextMenu(e,t))}}isReloadOkay(){return this.arcDragOrigin==null}};function Bt(){}function tn(r){return r()}function gs(){return Object.create(null)}function Ht(r){r.forEach(tn)}function vs(r){return typeof r=="function"}function yi(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function wi(r){return Object.keys(r).length===0}var en=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var cs=class r{constructor(t){c(this,"_listeners","WeakMap"in en?new WeakMap:void 0);c(this,"_observer");c(this,"options");this.options=t}observe(t,e){return this._listeners.set(t,e),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){var t;return(t=this._observer)!=null?t:this._observer=new ResizeObserver(e=>{var s;for(let n of e)r.entries.set(n.target,n),(s=this._listeners.get(n.target))==null||s(n)})}};cs.entries="WeakMap"in en?new WeakMap:void 0;var _i=!1;function ki(){_i=!0}function Ai(){_i=!1}function rn(r,t){r.appendChild(t)}function _e(r,t,e){r.insertBefore(t,e||null)}function Zt(r){r.parentNode&&r.parentNode.removeChild(r)}function Ye(r){return document.createElement(r)}function Zl(r){return document.createTextNode(r)}function Ii(){return Zl(" ")}function sn(r,t,e,s){return r.addEventListener(t,e,s),()=>r.removeEventListener(t,e,s)}function Qt(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function Ci(r){return Array.from(r.childNodes)}function Y(r,t,e,s){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,s?"important":"")}function ds(r,t,{bubbles:e=!1,cancelable:s=!1}={}){return new CustomEvent(r,{detail:t,bubbles:e,cancelable:s})}function Ti(r){let t={};return r.childNodes.forEach(e=>{t[e.slot||"default"]=!0}),t}var ie;function Yt(r){ie=r}function nn(){if(!ie)throw new Error("Function called outside component initialization");return ie}function on(r){nn().$$.on_mount.push(r)}function an(){let r=nn();return(t,e,{cancelable:s=!1}={})=>{let n=r.$$.callbacks[t];if(n){let i=ds(t,e,{cancelable:s});return n.slice().forEach(o=>{o.call(r,i)}),!i.defaultPrevented}return!0}}var ke=[];var Rr=[],Je=[],Fi=[],Kl=Promise.resolve(),gn=!1;function Si(){gn||(gn=!0,Kl.then(Mt))}function Er(r){Je.push(r)}var ln=new Set,Pe=0;function Mt(){if(Pe!==0)return;let r=ie;do{try{for(;Pe<ke.length;){let t=ke[Pe];Pe++,Yt(t),tg(t.$$)}}catch(t){throw ke.length=0,Pe=0,t}for(Yt(null),ke.length=0,Pe=0;Rr.length;)Rr.pop()();for(let t=0;t<Je.length;t+=1){let e=Je[t];ln.has(e)||(ln.add(e),e())}Je.length=0}while(ke.length);for(;Fi.length;)Fi.pop()();gn=!1,ln.clear(),Yt(r)}function tg(r){if(r.fragment!==null){r.update(),Ht(r.before_update);let t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Er)}}function Ri(r){let t=[],e=[];Je.forEach(s=>r.indexOf(s)===-1?t.push(s):e.push(s)),e.forEach(s=>s()),Je=t}var eg=new Set;function ps(r,t){r&&r.i&&(eg.delete(r),r.i(t))}var sg=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],ng=new Set([...sg]);function ag(r,t,e){let{fragment:s,after_update:n}=r.$$;s&&s.m(t,e),Er(()=>{let i=r.$$.on_mount.map(tn).filter(vs);r.$$.on_destroy?r.$$.on_destroy.push(...i):Ht(i),r.$$.on_mount=[]}),n.forEach(Er)}function lg(r,t){let e=r.$$;e.fragment!==null&&(Ri(e.after_update),Ht(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function gg(r,t){r.$$.dirty[0]===-1&&(ke.push(r),Si(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Ei(r,t,e,s,n,i,o=null,a=[-1]){let l=ie;Yt(r);let g=r.$$={fragment:null,ctx:[],props:i,update:Bt,not_equal:n,bound:gs(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:gs(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(g.root);let v=!1;if(g.ctx=e?e(r,t.props||{},(d,p,...u)=>{let m=u.length?u[0]:p;return g.ctx&&n(g.ctx[d],g.ctx[d]=m)&&(!g.skip_bound&&g.bound[d]&&g.bound[d](m),v&&gg(r,d)),p}):[],g.update(),v=!0,Ht(g.before_update),g.fragment=s?s(g.ctx):!1,t.target){if(t.hydrate){ki();let d=Ci(t.target);g.fragment&&g.fragment.l(d),d.forEach(Zt)}else g.fragment&&g.fragment.c();t.intro&&ps(r.$$.fragment),ag(r,t.target,t.anchor),Ai(),Mt()}Yt(l)}var vg;typeof HTMLElement=="function"&&(vg=class extends HTMLElement{constructor(t,e,s){super();c(this,"$$ctor");c(this,"$$s");c(this,"$$c");c(this,"$$cn",!1);c(this,"$$d",{});c(this,"$$r",!1);c(this,"$$p_d",{});c(this,"$$l",{});c(this,"$$l_u",new Map);this.$$ctor=t,this.$$s=e,s&&this.attachShadow({mode:"open"})}addEventListener(t,e,s){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let n=this.$$c.$on(t,e);this.$$l_u.set(e,n)}super.addEventListener(t,e,s)}removeEventListener(t,e,s){if(super.removeEventListener(t,e,s),this.$$c){let n=this.$$l_u.get(e);n&&(n(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(i){return()=>{let o;return{c:function(){o=Ye("slot"),i!=="default"&&Qt(o,"name",i)},m:function(g,v){_e(g,o,v)},d:function(g){g&&Zt(o)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},s=Ti(this);for(let i of this.$$s)i in s&&(e[i]=[t(i)]);for(let i of this.attributes){let o=this.$$g_p(i.name);o in this.$$d||(this.$$d[o]=vn(o,i.value,this.$$p_d,"toProp"))}for(let i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let i in this.$$p_d)if(this.$$d[i]=this.$$c.$$.ctx[this.$$c.$$.props[i]],this.$$p_d[i].reflect){let o=vn(i,this.$$d[i],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[i].attribute||i):this.setAttribute(this.$$p_d[i].attribute||i,o)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let i in this.$$l)for(let o of this.$$l[i]){let a=this.$$c.$on(i,o);this.$$l_u.set(o,a)}this.$$l={}}}attributeChangedCallback(t,e,s){var n;this.$$r||(t=this.$$g_p(t),this.$$d[t]=vn(t,s,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function vn(r,t,e,s){var i;let n=(i=e[r])==null?void 0:i.type;if(t=n==="Boolean"&&typeof t!="boolean"?t!=null:t,!s||!e[r])return t;if(s==="toAttribute")switch(n){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t==null?null:t;default:return t}else switch(n){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var Or=class{constructor(){c(this,"$$");c(this,"$$set")}$destroy(){lg(this,1),this.$destroy=Bt}$on(t,e){if(!vs(e))return Bt;let s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{let n=s.indexOf(e);n!==-1&&s.splice(n,1)}}$set(t){this.$$set&&!wi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var Oi="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Oi);function cg(r){let t,e,s,n=`${r[3]}px`,i=`${r[4]}px`,o=`${r[4]}px`,a=`${dg}px`,l=`${r[6]}px`,g=`${r[5]}px`,v=`${r[7]}px`,d,p,u=`${r[9]}px`,m=`${r[8]}px`,f=`${r[10]}px`,b,x;return{c(){t=Ye("span"),e=Ye("span"),d=Ii(),p=Ye("span"),Qt(e,"class",s="inner-handle "+r[2]+" svelte-1jn6leu"),Y(e,"--border-radius",n),Y(e,"--border-width",i),Qt(t,"class","handle svelte-1jn6leu"),Qt(t,"role","button"),Y(t,"visibility",r[12]),Y(t,"opacity",r[11]),Y(t,"--border-width",o),Y(t,"--handle-width",a),Y(t,"top",l),Y(t,"left",g),Y(t,"height",v),Qt(p,"class","marker svelte-1jn6leu"),Y(p,"visibility",r[13]),Y(p,"top",u),Y(p,"left",m),Y(p,"height",f)},m(k,h){_e(k,t,h),rn(t,e),r[18](t),_e(k,d,h),_e(k,p,h),r[19](p),b||(x=sn(t,"mousedown",r[14]),b=!0)},p(k,[h]){h&4&&s!==(s="inner-handle "+k[2]+" svelte-1jn6leu")&&Qt(e,"class",s),h&8&&n!==(n=`${k[3]}px`)&&Y(e,"--border-radius",n),h&16&&i!==(i=`${k[4]}px`)&&Y(e,"--border-width",i),h&4096&&Y(t,"visibility",k[12]),h&2048&&Y(t,"opacity",k[11]),h&16&&o!==(o=`${k[4]}px`)&&Y(t,"--border-width",o),h&64&&l!==(l=`${k[6]}px`)&&Y(t,"top",l),h&32&&g!==(g=`${k[5]}px`)&&Y(t,"left",g),h&128&&v!==(v=`${k[7]}px`)&&Y(t,"height",v),h&8192&&Y(p,"visibility",k[13]),h&512&&u!==(u=`${k[9]}px`)&&Y(p,"top",u),h&256&&m!==(m=`${k[8]}px`)&&Y(p,"left",m),h&1024&&f!==(f=`${k[10]}px`)&&Y(p,"height",f)},i:Bt,o:Bt,d(k){k&&(Zt(t),Zt(d),Zt(p)),r[18](null),r[19](null),b=!1,x()}}}var dg=6;function pg(r,t,e){let{highlight:s=void 0}=t,{position:n}=t,{handle:i}=t,{marker:o}=t,{dragging:a=!1}=t,l=0,g=0,v=0,d=0,p=0,u=0,m=0,f=0,b=1,x="hidden",k="hidden",h,S=an();on(()=>{e(17,h=i.parentElement)});function w(A){A.preventDefault(),e(15,a=!0),h.addEventListener("mousemove",_,{capture:!0}),h.addEventListener("mouseup",T,{capture:!0})}function _(A){if(!a)return;if(A.buttons===0){D();return}let G=Sr(A.clientX,A.clientY),F=we(G.startContainer);if(!G||!F){e(13,k="hidden");return}let Q=h.getBoundingClientRect(),W=G.getBoundingClientRect(),rt=G.commonAncestorContainer instanceof Element?G.commonAncestorContainer:G.commonAncestorContainer.parentElement,P=rt.getBoundingClientRect();if(!(P.left<=W.x&&W.x<=P.right&&P.top<=W.y&&W.y<=P.bottom)){W.x=W.x-Q.left+P.left,W.y=W.y-Q.top+P.top;let R=P.width/rt.textContent.length,C=rt.closest('svg[direction="rtl"]')!==null,M=5,gt=C?P.right-R*G.startOffset:P.left+R*G.startOffset;Math.abs(W.x-gt)>M&&(W.x=gt)}e(8,u=W.left+h.scrollLeft-Q.left),e(9,m=W.top+h.scrollTop-Q.top),e(10,f=W.height||P.height),e(13,k="visible")}function T(A){A.stopPropagation(),A.preventDefault();let G=k==="visible";D(),G&&S("resize-handle-released",{position:n,event:A})}function D(){h.removeEventListener("mousemove",_,{capture:!0}),h.removeEventListener("mouseup",T,{capture:!0}),e(15,a=!1),e(13,k="hidden")}function E(A){Rr[A?"unshift":"push"](()=>{i=A,e(0,i)})}function N(A){Rr[A?"unshift":"push"](()=>{o=A,e(1,o)})}return r.$$set=A=>{"highlight"in A&&e(16,s=A.highlight),"position"in A&&e(2,n=A.position),"handle"in A&&e(0,i=A.handle),"marker"in A&&e(1,o=A.marker),"dragging"in A&&e(15,a=A.dragging)},r.$$.update=()=>{if(r.$$.dirty&229404){let A=s?s.getClientRects():[];if(e(12,x=A.length>0?"visible":"hidden"),e(11,b=a?0:1),s&&h&&A.length>0){let G=A[0],F=A[A.length-1],Q=h.getBoundingClientRect(),W=window.getComputedStyle(s);e(4,g=0),W.borderWidth.split(" ").forEach(lt=>e(4,g=Math.max(g,parseInt(lt))));let rt=n==="begin"?G.left:F.right-g;rt+=h.scrollLeft-Q.left,e(5,v=rt);let P=n==="begin"?G.top:F.top;P+=h.scrollTop-Q.top,e(6,d=P),e(7,p=n==="begin"?G.height:F.height),a?e(3,l=0):(e(3,l=0),W.borderRadius.split(" ").forEach(lt=>e(3,l=Math.max(l,parseInt(lt)))))}}},[i,o,n,l,g,v,d,p,u,m,f,b,x,k,w,a,s,h,E,N]}var cn=class extends Or{constructor(t){super(),Ei(this,t,pg,cg,yi,{highlight:16,position:2,handle:0,marker:1,dragging:15})}get highlight(){return this.$$.ctx[16]}set highlight(t){this.$$set({highlight:t}),Mt()}get position(){return this.$$.ctx[2]}set position(t){this.$$set({position:t}),Mt()}get handle(){return this.$$.ctx[0]}set handle(t){this.$$set({handle:t}),Mt()}get marker(){return this.$$.ctx[1]}set marker(t){this.$$set({marker:t}),Mt()}get dragging(){return this.$$.ctx[15]}set dragging(t){this.$$set({dragging:t}),Mt()}},dn=cn;var ms=class{constructor(t,e,s){c(this,"visualizer");c(this,"ajax");c(this,"dispatcher");c(this,"id");c(this,"beginHandle");c(this,"endHandle");c(this,"hideTimer");c(this,"mouseOverHandler");this.visualizer=e,this.ajax=s,this.dispatcher=t,t.on("doneRendering",this,this.hide),this.beginHandle=new dn({target:this.visualizer.svgContainer,props:{position:"begin"}}),this.endHandle=new dn({target:this.visualizer.svgContainer,props:{position:"end"}}),this.beginHandle.$on("resize-handle-released",n=>this.handleResizeHandleReleased(n)),this.endHandle.$on("resize-handle-released",n=>this.handleResizeHandleReleased(n)),this.hide(),this.visualizer.svgContainer.addEventListener("mouseover",n=>this.showResizer(n))}showResizer(t){var s,n;if(!(t instanceof MouseEvent)||!(t.target instanceof Element))return;if((s=this.beginHandle)!=null&&s.dragging||(n=this.endHandle)!=null&&n.dragging){console.debug("Resizer is dragging, don't show resizer");return}let e=t.target.getAttribute("data-span-id");e&&!(String(e).indexOf(":")>=0)&&this.show(e)}show(t){if(this.id===t)return;this.id&&this.hide(),this.id=t;let e=Array.from(this.visualizer.getHighlightElementsForSpan(t));e.length&&(this.beginHandle.highlight=e[0],this.endHandle.highlight=e[e.length-1],this.mouseOverHandler=s=>this.handleMouseOver(s),this.visualizer.svgContainer.addEventListener("mouseover",this.mouseOverHandler))}handleResizeHandleReleased(t){var o,a,l,g,v;if(!(t instanceof CustomEvent)||!(((o=t.detail)==null?void 0:o.event)instanceof MouseEvent)||!this.id)return;let e=t.detail.position,s=t.detail.event,n=null,i=null;if(e==="begin"){let d=Sr(s.clientX,s.clientY),p=this.visualizer.rangeToOffsets(d);n=p?p[0]:null;let u=(l=(a=this.visualizer.data)==null?void 0:a.spans[this.id])==null?void 0:l.offsets;i=u?u[u.length-1][1]:null}else{let d=(v=(g=this.visualizer.data)==null?void 0:g.spans[this.id])==null?void 0:v.offsets;n=d?d[0][0]:null;let p=Sr(s.clientX,s.clientY),u=this.visualizer.rangeToOffsets(p);i=u?u[0]:null}n===null||i===null||(this.ajax.moveSpanAnnotation(this.id,[[n,i]]),this.hide())}handleMouseOver(t){var e,s;if(!(!(t instanceof MouseEvent)||!(t.target instanceof Element))){if(this.id===t.target.getAttribute("data-span-id")){this.cancelAutoHide();return}if((e=this.beginHandle)!=null&&e.handle.contains(t.target)||(s=this.endHandle)!=null&&s.handle.contains(t.target)){this.cancelAutoHide();return}this.autoHide()}}cancelAutoHide(){this.hideTimer!==void 0&&(window.clearTimeout(this.hideTimer),this.hideTimer=void 0)}autoHide(){function t(e){var s,n;(s=e.beginHandle)!=null&&s.dragging||(n=e.endHandle)!=null&&n.dragging?e.hideTimer=window.setTimeout(()=>t(e),1e3):e.hide()}this.cancelAutoHide(),this.hideTimer=window.setTimeout(()=>t(this),1e3)}hide(){this.cancelAutoHide(),this.mouseOverHandler&&(this.visualizer.svgContainer.removeEventListener("mouseover",this.mouseOverHandler),this.mouseOverHandler=void 0),this.id=void 0,this.beginHandle&&(this.beginHandle.highlight=void 0),this.endHandle&&(this.endHandle.highlight=void 0)}};function Nt(){}function pn(r){return r()}function us(){return Object.create(null)}function Pt(r){r.forEach(pn)}function fs(r){return typeof r=="function"}function Di(r,t){return r!=r?t==t:r!==t||r&&typeof r=="object"||typeof r=="function"}function Gi(r){return Object.keys(r).length===0}var mn=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var hs=class r{constructor(t){c(this,"_listeners","WeakMap"in mn?new WeakMap:void 0);c(this,"_observer");c(this,"options");this.options=t}observe(t,e){return this._listeners.set(t,e),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){var t;return(t=this._observer)!=null?t:this._observer=new ResizeObserver(e=>{var s;for(let n of e)r.entries.set(n.target,n),(s=this._listeners.get(n.target))==null||s(n)})}};hs.entries="WeakMap"in mn?new WeakMap:void 0;var Bi=!1;function Mi(){Bi=!0}function Ni(){Bi=!1}function J(r,t){r.appendChild(t)}function xt(r,t,e){r.insertBefore(t,e||null)}function pt(r){r.parentNode&&r.parentNode.removeChild(r)}function bs(r,t){for(let e=0;e<r.length;e+=1)r[e]&&r[e].d(t)}function nt(r){return document.createElement(r)}function zt(r){return document.createTextNode(r)}function oe(){return zt(" ")}function et(r,t,e){e==null?r.removeAttribute(t):r.getAttribute(t)!==e&&r.setAttribute(t,e)}function zi(r){return Array.from(r.childNodes)}function Ae(r,t){t=""+t,r.data!==t&&(r.data=t)}function Ie(r,t,e,s){e==null?r.style.removeProperty(t):r.style.setProperty(t,e,s?"important":"")}function yt(r,t,e){r.classList.toggle(t,!!e)}function $i(r){let t={};return r.childNodes.forEach(e=>{t[e.slot||"default"]=!0}),t}var ae;function Jt(r){ae=r}function un(){if(!ae)throw new Error("Function called outside component initialization");return ae}function fn(r){un().$$.on_mount.push(r)}function hn(r){un().$$.on_destroy.push(r)}var Ce=[];var xs=[],Ke=[],Vi=[],wg=Promise.resolve(),xn=!1;function Wi(){xn||(xn=!0,wg.then(Ft))}function Dr(r){Ke.push(r)}var bn=new Set,qe=0;function Ft(){if(qe!==0)return;let r=ae;do{try{for(;qe<Ce.length;){let t=Ce[qe];qe++,Jt(t),_g(t.$$)}}catch(t){throw Ce.length=0,qe=0,t}for(Jt(null),Ce.length=0,qe=0;xs.length;)xs.pop()();for(let t=0;t<Ke.length;t+=1){let e=Ke[t];bn.has(e)||(bn.add(e),e())}Ke.length=0}while(Ce.length);for(;Vi.length;)Vi.pop()();xn=!1,bn.clear(),Jt(r)}function _g(r){if(r.fragment!==null){r.update(),Pt(r.before_update);let t=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,t),r.after_update.forEach(Dr)}}function Xi(r){let t=[],e=[];Ke.forEach(s=>r.indexOf(s)===-1?t.push(s):e.push(s)),e.forEach(s=>s()),Ke=t}var kg=new Set;function ys(r,t){r&&r.i&&(kg.delete(r),r.i(t))}function qt(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}var Ig=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Cg=new Set([...Ig]);function Fg(r,t,e){let{fragment:s,after_update:n}=r.$$;s&&s.m(t,e),Dr(()=>{let i=r.$$.on_mount.map(pn).filter(fs);r.$$.on_destroy?r.$$.on_destroy.push(...i):Pt(i),r.$$.on_mount=[]}),n.forEach(Dr)}function Sg(r,t){let e=r.$$;e.fragment!==null&&(Xi(e.after_update),Pt(e.on_destroy),e.fragment&&e.fragment.d(t),e.on_destroy=e.fragment=null,e.ctx=[])}function Rg(r,t){r.$$.dirty[0]===-1&&(Ce.push(r),Wi(),r.$$.dirty.fill(0)),r.$$.dirty[t/31|0]|=1<<t%31}function Li(r,t,e,s,n,i,o=null,a=[-1]){let l=ae;Jt(r);let g=r.$$={fragment:null,ctx:[],props:i,update:Nt,not_equal:n,bound:us(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(l?l.$$.context:[])),callbacks:us(),dirty:a,skip_bound:!1,root:t.target||l.$$.root};o&&o(g.root);let v=!1;if(g.ctx=e?e(r,t.props||{},(d,p,...u)=>{let m=u.length?u[0]:p;return g.ctx&&n(g.ctx[d],g.ctx[d]=m)&&(!g.skip_bound&&g.bound[d]&&g.bound[d](m),v&&Rg(r,d)),p}):[],g.update(),v=!0,Pt(g.before_update),g.fragment=s?s(g.ctx):!1,t.target){if(t.hydrate){Mi();let d=zi(t.target);g.fragment&&g.fragment.l(d),d.forEach(pt)}else g.fragment&&g.fragment.c();t.intro&&ys(r.$$.fragment),Fg(r,t.target,t.anchor),Ni(),Ft()}Jt(l)}var Eg;typeof HTMLElement=="function"&&(Eg=class extends HTMLElement{constructor(t,e,s){super();c(this,"$$ctor");c(this,"$$s");c(this,"$$c");c(this,"$$cn",!1);c(this,"$$d",{});c(this,"$$r",!1);c(this,"$$p_d",{});c(this,"$$l",{});c(this,"$$l_u",new Map);this.$$ctor=t,this.$$s=e,s&&this.attachShadow({mode:"open"})}addEventListener(t,e,s){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(e),this.$$c){let n=this.$$c.$on(t,e);this.$$l_u.set(e,n)}super.addEventListener(t,e,s)}removeEventListener(t,e,s){if(super.removeEventListener(t,e,s),this.$$c){let n=this.$$l_u.get(e);n&&(n(),this.$$l_u.delete(e))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(i){return()=>{let o;return{c:function(){o=nt("slot"),i!=="default"&&et(o,"name",i)},m:function(g,v){xt(g,o,v)},d:function(g){g&&pt(o)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let e={},s=$i(this);for(let i of this.$$s)i in s&&(e[i]=[t(i)]);for(let i of this.attributes){let o=this.$$g_p(i.name);o in this.$$d||(this.$$d[o]=yn(o,i.value,this.$$p_d,"toProp"))}for(let i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:e,$$scope:{ctx:[]}}});let n=()=>{this.$$r=!0;for(let i in this.$$p_d)if(this.$$d[i]=this.$$c.$$.ctx[this.$$c.$$.props[i]],this.$$p_d[i].reflect){let o=yn(i,this.$$d[i],this.$$p_d,"toAttribute");o==null?this.removeAttribute(this.$$p_d[i].attribute||i):this.setAttribute(this.$$p_d[i].attribute||i,o)}this.$$r=!1};this.$$c.$$.after_update.push(n),n();for(let i in this.$$l)for(let o of this.$$l[i]){let a=this.$$c.$on(i,o);this.$$l_u.set(o,a)}this.$$l={}}}attributeChangedCallback(t,e,s){var n;this.$$r||(t=this.$$g_p(t),this.$$d[t]=yn(t,s,this.$$p_d,"toProp"),(n=this.$$c)==null||n.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{this.$$cn||(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(e=>this.$$p_d[e].attribute===t||!this.$$p_d[e].attribute&&e.toLowerCase()===t)||t}});function yn(r,t,e,s){var i;let n=(i=e[r])==null?void 0:i.type;if(t=n==="Boolean"&&typeof t!="boolean"?t!=null:t,!s||!e[r])return t;if(s==="toAttribute")switch(n){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t==null?null:t;default:return t}else switch(n){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var Gr=class{constructor(){c(this,"$$");c(this,"$$set")}$destroy(){Sg(this,1),this.$destroy=Nt}$on(t,e){if(!fs(e))return Nt;let s=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return s.push(e),()=>{let n=s.indexOf(e);n!==-1&&s.splice(n,1)}}$set(t){this.$$set&&!Gi(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var Ui="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ui);function Hi(r,t,e){let s=r.slice();return s[18]=t[e],s}function Zi(r,t,e){let s=r.slice();return s[21]=t[e],s}function Qi(r,t,e){let s=r.slice();return s[24]=t[e],s}function Yi(r){let t,e,s=r[0].comments&&Pi(r);function n(a,l){if(a[6])return Dg;if(a[5])return Og}let i=n(r,-1),o=i&&i(r);return{c(){t=nt("div"),s&&s.c(),e=oe(),o&&o.c(),et(t,"class","popover-body p-0 svelte-1v765g4")},m(a,l){xt(a,t,l),s&&s.m(t,null),J(t,e),o&&o.m(t,null)},p(a,l){a[0].comments?s?s.p(a,l):(s=Pi(a),s.c(),s.m(t,e)):s&&(s.d(1),s=null),i===(i=n(a,l))&&o?o.p(a,l):(o&&o.d(1),o=i&&i(a),o&&(o.c(),o.m(t,null)))},d(a){a&&pt(t),s&&s.d(),o&&o.d()}}}function Pi(r){let t,e=qt(r[0].comments),s=[];for(let n=0;n<e.length;n+=1)s[n]=Ji(Qi(r,e,n));return{c(){t=nt("div");for(let n=0;n<s.length;n+=1)s[n].c();et(t,"class","p-1 svelte-1v765g4")},m(n,i){xt(n,t,i);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(t,null)},p(n,i){if(i&1){e=qt(n[0].comments);let o;for(o=0;o<e.length;o+=1){let a=Qi(n,e,o);s[o]?s[o].p(a,i):(s[o]=Ji(a),s[o].c(),s[o].m(t,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=e.length}},d(n){n&&pt(t),bs(s,n)}}}function Ji(r){let t,e=r[24].comment+"",s,n;return{c(){t=nt("div"),s=zt(e),et(t,"class",n="i7n-marker-"+r[24].type+" svelte-1v765g4")},m(i,o){xt(i,t,o),J(t,s)},p(i,o){o&1&&e!==(e=i[24].comment+"")&&Ae(s,e),o&1&&n!==(n="i7n-marker-"+i[24].type+" svelte-1v765g4")&&et(t,"class",n)},d(i){i&&pt(t)}}}function Og(r){let t,e=qt(r[5]),s=[];for(let n=0;n<e.length;n+=1)s[n]=to(Hi(r,e,n));return{c(){t=nt("ul");for(let n=0;n<s.length;n+=1)s[n].c();et(t,"class","list-group list-group-flush svelte-1v765g4"),yt(t,"border-top",r[0].comments)},m(n,i){xt(n,t,i);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(t,null)},p(n,i){if(i&32){e=qt(n[5]);let o;for(o=0;o<e.length;o+=1){let a=Hi(n,e,o);s[o]?s[o].p(a,i):(s[o]=to(a),s[o].c(),s[o].m(t,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=e.length}i&1&&yt(t,"border-top",n[0].comments)},d(n){n&&pt(t),bs(s,n)}}}function Dg(r){let t;return{c(){t=nt("div"),t.innerHTML='<div class="d-flex flex-row justify-content-center svelte-1v765g4"><div class="spinner-border spinner-border-sm text-muted svelte-1v765g4" role="status"><span class="visually-hidden svelte-1v765g4">Loading...</span></div></div>',et(t,"class","d-flex flex-column justify-content-center svelte-1v765g4"),yt(t,"border-top",r[0].comments)},m(e,s){xt(e,t,s)},p(e,s){s&1&&yt(t,"border-top",e[0].comments)},d(e){e&&pt(t)}}}function qi(r){let t,e=r[18].title+"",s;return{c(){t=nt("div"),s=zt(e),et(t,"class","fw-bold svelte-1v765g4")},m(n,i){xt(n,t,i),J(t,s)},p(n,i){i&32&&e!==(e=n[18].title+"")&&Ae(s,e)},d(n){n&&pt(t)}}}function Ki(r){let t,e,s=r[21].label+"",n,i,o,a=r[21].value+"",l;return{c(){t=nt("div"),e=nt("span"),n=zt(s),i=zt(":"),o=oe(),l=zt(a),et(e,"class","fw-semibold svelte-1v765g4"),et(t,"class","svelte-1v765g4"),yt(t,"ps-2",r[18].title)},m(g,v){xt(g,t,v),J(t,e),J(e,n),J(e,i),J(t,o),J(t,l)},p(g,v){v&32&&s!==(s=g[21].label+"")&&Ae(n,s),v&32&&a!==(a=g[21].value+"")&&Ae(l,a),v&32&&yt(t,"ps-2",g[18].title)},d(g){g&&pt(t)}}}function to(r){let t,e,s,n=r[18].title&&qi(r),i=qt(r[18].details),o=[];for(let a=0;a<i.length;a+=1)o[a]=Ki(Zi(r,i,a));return{c(){t=nt("li"),n&&n.c(),e=oe();for(let a=0;a<o.length;a+=1)o[a].c();s=oe(),et(t,"class","list-group-item p-1 svelte-1v765g4")},m(a,l){xt(a,t,l),n&&n.m(t,null),J(t,e);for(let g=0;g<o.length;g+=1)o[g]&&o[g].m(t,null);J(t,s)},p(a,l){if(a[18].title?n?n.p(a,l):(n=qi(a),n.c(),n.m(t,e)):n&&(n.d(1),n=null),l&32){i=qt(a[18].details);let g;for(g=0;g<i.length;g+=1){let v=Zi(a,i,g);o[g]?o[g].p(v,l):(o[g]=Ki(v),o[g].c(),o[g].m(t,s))}for(;g<o.length;g+=1)o[g].d(1);o.length=i.length}},d(a){a&&pt(t),n&&n.d(),bs(o,a)}}}function Gg(r){var h,S,w;let t,e,s,n,i,o,a=((S=(h=r[0])==null?void 0:h.layer)==null?void 0:S.name)+"",l,g,v,d,p=((w=r[0])==null?void 0:w.vid)+"",u,m,f=`${r[1]}px`,b=`${r[2]}px`,x=`${r[3]}px`,k=r[0]&&Yi(r);return{c(){t=nt("div"),e=nt("div"),s=nt("div"),n=nt("span"),i=oe(),o=nt("div"),l=zt(a),g=oe(),v=nt("div"),d=zt("ID: "),u=zt(p),m=oe(),k&&k.c(),et(n,"class","annotation-type-marker svelte-1v765g4"),yt(n,"i7n-icon-span",r[0]instanceof Ct),yt(n,"i7n-icon-relation",r[0]instanceof Dt),et(s,"class","border-end border-secondary px-1 svelte-1v765g4"),et(o,"class","flex-grow-1 px-1 svelte-1v765g4"),et(v,"class","text-body-secondary px-1 svelte-1v765g4"),et(e,"class","popover-header p-0 d-flex svelte-1v765g4"),et(t,"class","bootstrap popover position-fixed shadow svelte-1v765g4"),yt(t,"d-none",!r[0]),Ie(t,"top",f),Ie(t,"left",b),Ie(t,"--width",x)},m(_,T){xt(_,t,T),J(t,e),J(e,s),J(s,n),J(e,i),J(e,o),J(o,l),J(e,g),J(e,v),J(v,d),J(v,u),J(t,m),k&&k.m(t,null),r[9](t)},p(_,[T]){var D,E,N;T&1&&yt(n,"i7n-icon-span",_[0]instanceof Ct),T&1&&yt(n,"i7n-icon-relation",_[0]instanceof Dt),T&1&&a!==(a=((E=(D=_[0])==null?void 0:D.layer)==null?void 0:E.name)+"")&&Ae(l,a),T&1&&p!==(p=((N=_[0])==null?void 0:N.vid)+"")&&Ae(u,p),_[0]?k?k.p(_,T):(k=Yi(_),k.c(),k.m(t,null)):k&&(k.d(1),k=null),T&1&&yt(t,"d-none",!_[0]),T&2&&f!==(f=`${_[1]}px`)&&Ie(t,"top",f),T&4&&b!==(b=`${_[2]}px`)&&Ie(t,"left",b),T&8&&x!==(x=`${_[3]}px`)&&Ie(t,"--width",x)},i:Nt,o:Nt,d(_){_&&pt(t),k&&k.d(),r[9](null)}}}var Bg=10,Mg=1e3,Ng=500,wn=32;function zg(r,t,e){let{ajax:s}=t,{root:n}=t,{top:i=0}=t,{left:o=0}=t,{width:a=400}=t,{annotation:l=void 0}=t,g,v,d,p=!1;fn(()=>{n.addEventListener(Tt.eventType,f),n.addEventListener(Gt.eventType,b),n.addEventListener("mousemove",u),n.addEventListener("mousedown",m)}),hn(()=>{n.removeEventListener(Tt.eventType,f),n.removeEventListener(Gt.eventType,b),n.removeEventListener("mousemove",u),n.removeEventListener("mousedown",m)});function u(w){l&&h(w)}function m(w){d&&(window.clearTimeout(d),d=void 0),e(0,l=void 0)}function f(w){let _=w.originalEvent;_ instanceof MouseEvent&&(d&&window.clearTimeout(d),d=void 0,l&&l.vid!==w.annotation.vid?(e(0,l=w.annotation),e(5,v=void 0)):(!l||l.vid!==w.annotation.vid)&&x(w.annotation,_))}function b(w){w.originalEvent instanceof MouseEvent&&k()}function x(w,_){d=window.setTimeout(()=>{d=void 0,e(0,l=w),d=window.setTimeout(()=>{h(_),d=void 0},Bg)},Mg)}function k(){d&&(window.clearTimeout(d),d=void 0),d=window.setTimeout(()=>{l&&e(0,l=void 0),d=void 0},Ng)}function h(w){if(!g)return;let _=g.getBoundingClientRect(),T=w.clientX,D=w.clientY;D+_.height+wn>window.innerHeight?e(1,i=D-_.height-wn):e(1,i=D+wn),T+_.width>window.innerWidth?e(2,o=Math.max(0,window.innerWidth-_.width)):e(2,o=T)}function S(w){xs[w?"unshift":"push"](()=>{g=w,e(4,g)})}return r.$$set=w=>{"ajax"in w&&e(7,s=w.ajax),"root"in w&&e(8,n=w.root),"top"in w&&e(1,i=w.top),"left"in w&&e(2,o=w.left),"width"in w&&e(3,a=w.width),"annotation"in w&&e(0,l=w.annotation)},r.$$.update=()=>{r.$$.dirty&129&&l&&(e(6,p=!0),s.loadLazyDetails(l).then(w=>{e(6,p=!1),e(5,v=w)}).catch(()=>{e(6,p=!1),e(5,v=[{title:"Error",details:[{label:"",value:"Unable to load details."}]}])}))},[l,i,o,a,g,v,p,s,n,S]}var _n=class extends Gr{constructor(t){super(),Li(this,t,zg,Gg,Di,{ajax:7,root:8,top:1,left:2,width:3,annotation:0})}get ajax(){return this.$$.ctx[7]}set ajax(t){this.$$set({ajax:t}),Ft()}get root(){return this.$$.ctx[8]}set root(t){this.$$set({root:t}),Ft()}get top(){return this.$$.ctx[1]}set top(t){this.$$set({top:t}),Ft()}get left(){return this.$$.ctx[2]}set left(t){this.$$set({left:t}),Ft()}get width(){return this.$$.ctx[3]}set width(t){this.$$set({width:t}),Ft()}get annotation(){return this.$$.ctx[0]}set annotation(t){this.$$set({annotation:t}),Ft()}},eo=_n;var ws=class{constructor(t,e,s){c(this,"dispatcher");c(this,"visualizer");c(this,"resizer");c(this,"popover");let n=t.getAttribute("id");this.dispatcher=new Se,new $r(this.dispatcher,n,s.diamAjaxCallbackUrl),this.visualizer=new Ze(this.dispatcher,n,e),new Qe(this.dispatcher,e),new ls(this.dispatcher,this.visualizer,e),this.dispatcher.post("init"),t.dispatcher=this.dispatcher,t.visualizer=this.visualizer,t.parentElement&&new ResizeObserver(()=>{this.dispatcher.post("resize")}).observe(t.parentElement),this.resizer=new ms(this.dispatcher,this.visualizer,e),this.popover=new eo({target:document.body,props:{root:t,ajax:e}})}post(t,e){console.log(`post: ${t}`,e),this.dispatcher.post(t,e)}loadAnnotations(){console.log("loadAnnotations"),this.dispatcher.post("loadAnnotations",[])}scrollTo(t){this.visualizer.scrollTo(t)}destroy(){var t;(t=this.popover)!=null&&t.$destroy&&this.popover.$destroy()}};var tr="__editor__",_s=class{async getOrInitialize(t,e,s){if(t[tr]!=null)return t[tr];let n=e.createAjaxClient(s.diamAjaxCallbackUrl),i;if(t.querySelector&&(i=t.querySelector("[data-capture-root]")),!i&&t instanceof HTMLDocument){let o=t.getElementsByTagName("body");o&&o.length>0&&(i=o[0])}return i||(i=t),t[tr]=new ws(i,n,s),t[tr]}destroy(t){t[tr]!=null&&(t[tr].destroy(),console.log("Destroyed editor"))}};var $g=new _s;function jg(){return $g}return go(Vg);})();
/*!
 * jQuery scrollbarWidth - v0.2 - 2/11/2009
 * http://benalman.com/projects/jquery-misc-plugins/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * ---
 *
 * WebAnno: Changed to render test div outside screen area.
 * INCEpTION: turned into a simple function
 */
/*! Bundled license information:

fast-json-patch/module/helpers.mjs:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2022 Joachim Wester
   * MIT licensed
   *)

fast-json-patch/module/duplex.mjs:
  (*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017-2021 Joachim Wester
   * MIT license
   *)

@svgdotjs/svg.js/dist/svg.esm.js:
  (*!
  * @svgdotjs/svg.js - A lightweight library for manipulating and animating SVG.
  * @version 3.2.0
  * https://svgjs.dev/
  *
  * @copyright Wout Fierens <wout@mick-wout.com>
  * @license MIT
  *
  * BUILT: Mon Jun 12 2023 10:34:51 GMT+0200 (Central European Summer Time)
  *)
*/
//# sourceMappingURL=brat.min.js.map
