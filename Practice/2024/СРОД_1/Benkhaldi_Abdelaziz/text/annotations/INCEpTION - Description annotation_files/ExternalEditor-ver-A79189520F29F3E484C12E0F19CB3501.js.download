var ExternalEditor=(()=>{var h=(a,e)=>()=>(a&&(e=a(a=0)),e);var g=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports);var u=(a,e,n)=>new Promise((s,t)=>{var o=l=>{try{d(n.next(l))}catch(m){t(m)}},i=l=>{try{d(n.throw(l))}catch(m){t(m)}},d=l=>l.done?s(l.value):Promise.resolve(l.value).then(o,i);d((n=n.apply(a,e)).next())});var r,c,y=h(()=>{r="__editor__",c=class{getOrInitialize(e,n,s){return u(this,null,function*(){if(e[r]!=null)return e[r];if(e instanceof HTMLIFrameElement){let t=e,o;if(!s.loadingIndicatorDisabled){t.style.display="none",o=document.createElement("div"),o.classList.add("flex-content"),o.style.display="flex",o.style.justifyContent="center",o.style.alignItems="center";let i=document.createElement("div");i.classList.add("spinner-border"),i.classList.add("text-muted"),i.setAttribute("role","status");let d=document.createElement("span");d.classList.add("sr-only"),d.innerText="Loading...",i.appendChild(d),o.appendChild(i),t.before(o)}return e[r]=yield this.loadIFrameContent(t).then(i=>this.loadEditorResources(i,s)).then(i=>this.installKeyEventForwarding(i,e.ownerDocument.defaultView)).then(i=>this.isDocumentJavascriptCapable(i.document)?this.initEditor(i,i.document.getElementsByTagName("body")[0],n,s):this.initEditor(window,i.document,n,s)),s.loadingIndicatorDisabled||(o==null||o.remove(),t.style.display=""),e[r]}return e[r]=yield this.loadEditorResources(window,s).then(t=>this.initEditor(t,e,n,s)),e[r]})}loadIFrameContent(e){return new Promise(n=>{let s=e.src;e.src="about:blank";let t=()=>{var i;e.removeEventListener("load",t);let o=e.contentDocument||((i=e.contentWindow)==null?void 0:i.document);console.debug(`IFrame has loaded: ${o==null?void 0:o.location}`),n(e.contentWindow)};console.debug("Waiting for IFrame content to load..."),e.addEventListener("load",t),e.src=s})}installKeyEventForwarding(e,n){return new Promise(s=>{console.debug("Installing key event forwarding..."),e!==n&&(e.addEventListener("keydown",t=>{console.debug(`Forwarding keydown event: ${t.key}`),(n.document.body||n.document).dispatchEvent(new KeyboardEvent("keydown",t))}),e.addEventListener("keyup",t=>{console.debug(`Forwarding keyup event: ${t.key}`),(n.document.body||n.document).dispatchEvent(new KeyboardEvent("keyup",t))}),e.addEventListener("keypress",t=>{console.debug(`Forwarding keypress event: ${t.key}`),(n.document.body||n.document).dispatchEvent(new KeyboardEvent("kekeypressyup",t))})),s(e)})}loadEditorResources(e,n){return new Promise(s=>{console.debug("Preparing to load editor resources..."),e.document instanceof HTMLDocument&&(document.body||(e.document.body=e.document.getElementsByTagName("body")[0]));let t=this.isDocumentJavascriptCapable(e.document)?e.document:document,o=[];this.isDocumentStylesheetCapable(e.document)&&n.stylesheetSources&&o.push(...n.stylesheetSources.map(i=>this.loadStylesheet(t,i))),n.scriptSources&&o.push(...n.scriptSources.map(i=>this.loadScript(t,i))),Promise.all(o).then(()=>{console.info(`${o.length} editor resources loaded`),s(e)})})}initEditor(e,n,s,t){return new Promise(o=>{console.debug("Preparing to initialize editor..."),e.eval(t.editorFactory).getOrInitialize(n,s,t).then(d=>{console.info("Editor initialized"),o(d)})})}isDocumentJavascriptCapable(e){return e instanceof HTMLDocument||e.documentElement.constructor.name==="HTMLHtmlElement"}isDocumentStylesheetCapable(e){return e instanceof HTMLDocument||e.documentElement.constructor.name==="HTMLHtmlElement"}loadStylesheet(e,n){return new Promise(s=>{console.debug(`Preparing to load stylesheet: ${n} ...`);let t=e.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=n,t.onload=()=>{console.info(`Loaded stylesheet: ${n}`),t.onload=null,s()};let o=e.getElementsByTagName("head");o.length>0&&o[0].appendChild(t)})}loadScript(e,n){return new Promise(s=>{console.debug(`Preparing to load script: ${n} ...`);let t=e.createElement("script");t.src=n,t.onload=()=>{console.info(`Loaded script: ${n}`),t.onload=null,s()},e.getElementsByTagName("head").length>0&&e.getElementsByTagName("head")[0].appendChild(t)})}destroy(e){e[r]!=null&&(e[r].destroy(),console.info("Destroyed editor"))}}});var b=g((D,E)=>{y();var p=new c;E.exports=p});return b();})();

